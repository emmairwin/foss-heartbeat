{"original_position": 25, "diff_hunk": "@@ -82,19 +82,23 @@ this.NormandyApi = {\n     return this.absolutify(url);\n   },\n \n-  async fetchRecipes(filters = {enabled: true}) {\n-    const signedRecipesUrl = await this.getApiUrl(\"recipe-signed\");\n-    const recipesResponse = await this.get(signedRecipesUrl, filters);\n-    const rawText = await recipesResponse.text();\n-    const recipesWithSigs = JSON.parse(rawText);\n+  async fetchSignedObjects(type, filters) {\n+    const signedObjectsUrl = await this.getApiUrl(`${type}-signed`);\n+    const objectsResponse = await this.get(signedObjectsUrl, filters);\n+    const rawText = await objectsResponse.text();\n+    const objectsWithSigs = JSON.parse(rawText);\n+\n+    const verifiedObjects = [];\n \n-    const verifiedRecipes = [];\n+    for (const objectWithSig of objectsWithSigs) {\n+      const {signature, x5u} = objectWithSig.signature;\n+      const object = objectWithSig[type];\n \n-    for (const {recipe, signature: {signature, x5u}} of recipesWithSigs) {\n-      const serialized = CanonicalJSON.stringify(recipe);\n+      const serialized = CanonicalJSON.stringify(object);\n       if (!rawText.includes(serialized)) {", "body_text": "We could leave this check out entirely, and it would be fine because it still wouldn't match the signatures. This is mostly a benefit to give better error messages to developers, especially in tests and QA.\nThe reason it is a substring check is because rawText includes both the object that is signed and the signature for that object. It isn't required that the entire respons be in canonical json format, only the object that is signed, which is what serialized is a representation of.\nI'll add a comment.", "in_reply_to_id": 131361476, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/934", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/131507548", "created_at": "2017-08-05T00:03:13Z", "author_association": "MEMBER", "body": "We could leave this check out entirely, and it would be fine because it still wouldn't match the signatures. This is mostly a benefit to give better error messages to developers, especially in tests and QA.\r\n\r\nThe reason it is a substring check is because `rawText` includes both the object that is signed and the signature for that object. It isn't required that the entire respons be in canonical json format, only the object that is signed, which is what `serialized` is a representation of.\r\n\r\nI'll add a comment.", "updated_at": "2017-08-09T17:29:37Z", "html_url": "https://github.com/mozilla/normandy/pull/934#discussion_r131507548", "pull_request_review_id": 54500821, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/131507548"}, "html": {"href": "https://github.com/mozilla/normandy/pull/934#discussion_r131507548"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/934"}}, "commit_id": "9b11c6f569d0e9e3d25e024a14c775e0184ba9b7", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-client-addon/lib/NormandyApi.jsm", "body_html": "<p>We could leave this check out entirely, and it would be fine because it still wouldn't match the signatures. This is mostly a benefit to give better error messages to developers, especially in tests and QA.</p>\n<p>The reason it is a substring check is because <code>rawText</code> includes both the object that is signed and the signature for that object. It isn't required that the entire respons be in canonical json format, only the object that is signed, which is what <code>serialized</code> is a representation of.</p>\n<p>I'll add a comment.</p>", "original_commit_id": "1245bf4232ce3547293009ad896c8bcecbdd8b33", "id": 131507548}