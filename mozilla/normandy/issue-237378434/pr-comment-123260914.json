{"original_position": 63, "diff_hunk": "@@ -31,38 +25,35 @@ export default class PreferenceExperimentAction extends Action {\n     // Exit early if we're on an incompatible client.\n     if (experiments === undefined) {\n       this.normandy.log('Client does not support preference experiments, aborting.', 'info');\n-      return Promise.resolve();\n+      return;\n     }\n \n     seenExperimentNames.push(slug);\n-    return experiments.has(slug).then(hasSlug => {\n-      // If the experiment doesn't exist yet, enroll!\n-      if (!hasSlug) {\n-        return this.chooseBranch(branches).then(branch =>\n-          experiments.start({\n-            name: slug,\n-            branch: branch.slug,\n-            preferenceName,\n-            preferenceValue: branch.value,\n-            preferenceBranchType,\n-            preferenceType,\n-          })\n-        );\n-      }\n-\n-      // If the experiment exists, and isn't expired, bump the lastSeen date.\n-      return experiments.get(slug).then(experiment => {\n-        if (experiment.expired) {\n-          this.normandy.log(`Experiment ${slug} has expired, aborting.`, 'debug');\n-          return true;\n-        }\n \n-        return experiments.markLastSeen(slug);\n+    // If the experiment doesn't exist yet, enroll!\n+    const hasSlug = await experiments.has(slug);\n+    if (!hasSlug) {\n+      const branch = await this.chooseBranch(branches);\n+      await experiments.start({\n+        name: slug,\n+        branch: branch.slug,\n+        preferenceName,\n+        preferenceValue: branch.value,\n+        preferenceBranchType,\n+        preferenceType,\n       });\n-    });\n+    } else {\n+      // If the experiment exists, and isn't expired, bump the lastSeen date.\n+      const experiment = await experiments.get(slug);\n+      if (experiment.expired) {", "body_text": "Would it be worth it to abstract this section out into its own markExperimentSeen function, to avoid nesting conditionals? I find it easier to read something like:\n} else {\n  await this.markExperimentSeen(slug);\n}\n\nThis may be unnecessary, though.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/822", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/123260914", "created_at": "2017-06-21T14:16:05Z", "author_association": "CONTRIBUTOR", "body": "Would it be worth it to abstract this section out into its own `markExperimentSeen` function, to avoid nesting conditionals? I find it easier to read something like:\r\n\r\n```\r\n} else {\r\n  await this.markExperimentSeen(slug);\r\n}\r\n```\r\n\r\nThis may be unnecessary, though.", "updated_at": "2017-06-27T17:34:54Z", "html_url": "https://github.com/mozilla/normandy/pull/822#discussion_r123260914", "pull_request_review_id": 45446291, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/123260914"}, "html": {"href": "https://github.com/mozilla/normandy/pull/822#discussion_r123260914"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/822"}}, "commit_id": "514c9308346f8b28ab2ae59db2d9ab6810487d3e", "user": {"following_url": "https://api.github.com/users/andymikulski/following{/other_user}", "events_url": "https://api.github.com/users/andymikulski/events{/privacy}", "organizations_url": "https://api.github.com/users/andymikulski/orgs", "url": "https://api.github.com/users/andymikulski", "gists_url": "https://api.github.com/users/andymikulski/gists{/gist_id}", "html_url": "https://github.com/andymikulski", "subscriptions_url": "https://api.github.com/users/andymikulski/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/2767162?v=4", "repos_url": "https://api.github.com/users/andymikulski/repos", "received_events_url": "https://api.github.com/users/andymikulski/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/andymikulski/starred{/owner}{/repo}", "site_admin": false, "login": "andymikulski", "type": "User", "id": 2767162, "followers_url": "https://api.github.com/users/andymikulski/followers"}, "position": 73, "path": "recipe-server/client/actions/preference-experiment/index.js", "body_html": "<p>Would it be worth it to abstract this section out into its own <code>markExperimentSeen</code> function, to avoid nesting conditionals? I find it easier to read something like:</p>\n<pre><code>} else {\n  await this.markExperimentSeen(slug);\n}\n</code></pre>\n<p>This may be unnecessary, though.</p>", "original_commit_id": "e2276bef4d1a6dd0d44d1d5a01f65fc3cbb282e4", "id": 123260914}