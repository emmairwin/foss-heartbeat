{"original_position": 13, "diff_hunk": "@@ -154,7 +154,17 @@ def validate_extra_filter_expression(self, value):\n         jexl.add_transform('preferenceIsUserSet', lambda x: x)\n         jexl.add_transform('preferenceExists', lambda x: x)\n \n-        errors = list(jexl.validate(value))\n+        try:\n+            errors = list(jexl.validate(value))\n+        except Exception as exc:\n+            # The JEXL parser can occasionally throw exceptions when\n+            # called to validate certain invalid inputs.\n+            # Catch them and at least indicate the field that failed,\n+            # even if we can't explain exactly what the problem was.\n+            # See https://github.com/mozilla/normandy/issues/1059.\n+            error = 'The JEXL parser failed to validate {}'.format(value)", "body_text": "Normandy runs with Python 3.6, which means we have access to f-strings. That means you could write this as:\nerror = f'The JEXL parser failed to validate {value}'\nwhich is exactly equivalent.\nNote that this is a style change. Since it is not enforced by the linter, you can write the code however you like. I just mention it because f-strings are a new Python feature that not many projects get to use.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/1207", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/174541128", "created_at": "2018-03-14T17:19:32Z", "author_association": "MEMBER", "body": "Normandy runs with Python 3.6, which means we have access to f-strings. That means you could write this as:\r\n\r\n```python\r\nerror = f'The JEXL parser failed to validate {value}'\r\n```\r\n\r\nwhich is exactly equivalent.\r\n\r\nNote that this is a style change. Since it is not enforced by the linter, you can write the code however you like. I just mention it because f-strings are a new Python feature that not many projects get to use.", "updated_at": "2018-03-14T21:16:24Z", "html_url": "https://github.com/mozilla/normandy/pull/1207#discussion_r174541128", "pull_request_review_id": 103917365, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/174541128"}, "html": {"href": "https://github.com/mozilla/normandy/pull/1207#discussion_r174541128"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/1207"}}, "commit_id": "718fdae242f0cc6fe39f04c437b49711fd8455a9", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/normandy/recipes/api/v2/serializers.py", "body_html": "<p>Normandy runs with Python 3.6, which means we have access to f-strings. That means you could write this as:</p>\n<div class=\"highlight highlight-source-python\"><pre>error <span class=\"pl-k\">=</span> <span class=\"pl-s\">f</span><span class=\"pl-pds\">'</span><span class=\"pl-s\">The JEXL parser failed to validate </span><span class=\"pl-c1\">{</span>value<span class=\"pl-c1\">}</span><span class=\"pl-pds\">'</span></pre></div>\n<p>which is exactly equivalent.</p>\n<p>Note that this is a style change. Since it is not enforced by the linter, you can write the code however you like. I just mention it because f-strings are a new Python feature that not many projects get to use.</p>", "original_commit_id": "b8ed85d0d0f57662f8687eca8434925f9a3f1670", "id": 174541128}