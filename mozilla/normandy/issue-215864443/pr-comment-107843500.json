{"original_position": 24, "diff_hunk": "@@ -65,6 +65,43 @@ this.SandboxManager = class {\n       }\n     });\n   }\n+\n+  /**\n+   * Wraps a function that returns a Promise from a privileged (e.g. chrome)\n+   * context and returns a Promise from this SandboxManager's sandbox. Useful\n+   * for exposing privileged functions to the sandbox, since the sandbox can't\n+   * access properties on privileged objects, e.g. Promise.then on a privileged\n+   * Promise.\n+   * @param {Function} wrappedFunction\n+   * @param {Object} [options]\n+   * @param {boolean} [options.cloneInto=false]\n+   *   If true, the value resolved by the privileged Promise is cloned into the\n+   *   sandbox before being resolved by the sandbox Promise. Without this, the\n+   *   result will be Xray-wrapped.\n+   * @param {boolean} [options.cloneArguments=false]\n+   *   If true, the arguments passed to wrappedFunction will be cloned into the\n+   *   privileged chrome context. If wrappedFunction holds a reference to any of\n+   *   its arguments, you will need this to avoid losing access to the arguments\n+   *   when the sandbox they originate from is nuked.\n+   * @return {Function}\n+   */\n+  wrapAsync(wrappedFunction, options = {cloneInto: false, cloneArguments: false}) {", "body_text": "Thanks! Although I wonder where we'd put it, as AFAICT the sandbox class is in C++ and adding more sandbox functions to Components.utils seems kinda messy.", "in_reply_to_id": 107392196, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/623", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/107843500", "created_at": "2017-03-24T06:49:27Z", "author_association": "MEMBER", "body": "Thanks! Although I wonder where we'd put it, as AFAICT the sandbox class is in C++ and adding more sandbox functions to `Components.utils` seems kinda messy.", "updated_at": "2017-03-25T04:25:33Z", "html_url": "https://github.com/mozilla/normandy/pull/623#discussion_r107843500", "pull_request_review_id": 28838779, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/107843500"}, "html": {"href": "https://github.com/mozilla/normandy/pull/623#discussion_r107843500"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/623"}}, "commit_id": "6bf1456bdc7a171d0c91c246b0cb9906dd2e320e", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "position": 24, "path": "recipe-client-addon/lib/SandboxManager.jsm", "body_html": "<p>Thanks! Although I wonder where we'd put it, as AFAICT the sandbox class is in C++ and adding more sandbox functions to <code>Components.utils</code> seems kinda messy.</p>", "original_commit_id": "7956cfdb98803a4d1a41c4abe5dc29ad6a5755b8", "id": 107843500}