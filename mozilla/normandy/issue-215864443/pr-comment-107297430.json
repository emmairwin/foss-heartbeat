{"original_position": 33, "diff_hunk": "@@ -0,0 +1,95 @@\n+\"use strict\";\n+\n+Cu.import(\"resource://shield-recipe-client/lib/SandboxManager.jsm\");\n+\n+// wrapAsync should wrap privileged Promises with Promises that are usable by\n+// the sandbox.\n+add_task(function* () {\n+  const manager = new SandboxManager();\n+  manager.addHold(\"testing\");\n+\n+  manager.cloneIntoGlobal(\"driver\", {\n+    async privileged() {\n+      return \"privileged\";\n+    },\n+    wrapped: manager.wrapAsync(async function() {\n+      return \"wrapped\";\n+    }),\n+  }, {cloneFunctions: true});\n+\n+  // Assertion helpers\n+  manager.addGlobal(\"ok\", ok);\n+\n+  const wrappedResult = yield new Promise(resolve => {\n+    manager.addGlobal(\"resolve\", result => resolve(result));\n+    manager.evalInSandbox(`\n+      // Unwrapped privileged promises are not accessible in the sandbox\n+      try {\n+        const privilegedResult = driver.privileged().then(() => false);\n+        ok(false, \"The sandbox could not use a privileged Promise\");\n+      } catch (err) { }\n+\n+      // Wrapped functions return promises that the sandbox can access.\n+      const wrappedResult = driver.wrapped();", "body_text": "It is confusing that both this value and the one on line 23 are both called wrappedResult. I tried for a while to see how they were related. Can one of them be a different name?", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/623", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/107297430", "created_at": "2017-03-21T23:01:46Z", "author_association": "MEMBER", "body": "It is confusing that both this value and the one on line 23 are both called `wrappedResult`. I tried for a while to see how they were related. Can one of them be a different name?", "updated_at": "2017-03-25T04:25:33Z", "html_url": "https://github.com/mozilla/normandy/pull/623#discussion_r107297430", "pull_request_review_id": 28256784, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/107297430"}, "html": {"href": "https://github.com/mozilla/normandy/pull/623#discussion_r107297430"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/623"}}, "commit_id": "6bf1456bdc7a171d0c91c246b0cb9906dd2e320e", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": 33, "path": "recipe-client-addon/test/unit/test_SandboxManager.js", "body_html": "<p>It is confusing that both this value and the one on line 23 are both called <code>wrappedResult</code>. I tried for a while to see how they were related. Can one of them be a different name?</p>", "original_commit_id": "f4732714cbf1fbdf2bcd59fc95e1894330d44425", "id": 107297430}