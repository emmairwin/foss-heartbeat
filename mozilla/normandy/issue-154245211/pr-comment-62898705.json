{"original_position": 24, "diff_hunk": "@@ -27,18 +26,20 @@ function loadAction(recipe) {\n     return new Promise((resolve, reject) => {\n         let action_name = recipe.action_name;\n         if (!registeredActions[action_name]) {\n-            xhr.get(`/api/v1/action/${action_name}/`).then(function(response) {\n-                let action = JSON.parse(response.responseText);\n-                let script = document.createElement('script');\n-                script.src = action.implementation_url;\n-                script.onload = () => {\n-                    if (!registeredActions[action.name]) {\n-                        reject(new Error(`Could not find action with name ${action.name}.`));\n-                    } else {\n-                        resolve(registeredActions[action.name]);\n-                    }\n-                };\n-                document.head.appendChild(script);\n+            fetch(`/api/v1/action/${action_name}/`).then(function(response) {\n+                return response.json().then(action => {\n+                    let script = document.createElement('script');", "body_text": "I usually do this like\nfetch(`/api/v1/action/${action_name}/`)\n.then(response => response.json())\n.then(action => {\n  let script = ...\n});\nReturning response.json() directly lets you avoid indenting more.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/143", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/62898705", "created_at": "2016-05-11T18:16:53Z", "author_association": "MEMBER", "body": "I usually do this like\n\n``` js\nfetch(`/api/v1/action/${action_name}/`)\n.then(response => response.json())\n.then(action => {\n  let script = ...\n});\n```\n\nReturning `response.json()` directly lets you avoid indenting more.\n", "updated_at": "2016-05-18T20:45:45Z", "html_url": "https://github.com/mozilla/normandy/pull/143#discussion_r62898705", "pull_request_review_id": null, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/62898705"}, "html": {"href": "https://github.com/mozilla/normandy/pull/143#discussion_r62898705"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/143"}}, "commit_id": "24a2127747adfe1b79fb4313f652e2ba1b0df37a", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "normandy/selfrepair/static/js/self_repair_runner.js", "body_html": "<p>I usually do this like</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-en\">fetch</span>(<span class=\"pl-s\"><span class=\"pl-pds\">`</span>/api/v1/action/<span class=\"pl-s1\"><span class=\"pl-pse\">${</span>action_name<span class=\"pl-pse\">}</span></span>/<span class=\"pl-pds\">`</span></span>)\n.<span class=\"pl-en\">then</span>(<span class=\"pl-smi\">response</span> <span class=\"pl-k\">=&gt;</span> <span class=\"pl-smi\">response</span>.<span class=\"pl-en\">json</span>())\n.<span class=\"pl-en\">then</span>(<span class=\"pl-smi\">action</span> <span class=\"pl-k\">=&gt;</span> {\n  <span class=\"pl-k\">let</span> script <span class=\"pl-k\">=</span> <span class=\"pl-k\">...</span>\n});</pre></div>\n<p>Returning <code>response.json()</code> directly lets you avoid indenting more.</p>", "original_commit_id": "32ea25dd38636b15a0900115b42ef49cc70af6e0", "id": 62898705}