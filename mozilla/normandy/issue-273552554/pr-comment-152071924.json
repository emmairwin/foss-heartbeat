{"original_position": 13, "diff_hunk": "@@ -10,17 +10,17 @@ RUN apt-get update && \\\n RUN curl -s https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - && \\\n     echo 'deb https://deb.nodesource.com/node_8.x jessie main' > /etc/apt/sources.list.d/nodesource.list && \\\n     echo 'deb-src https://deb.nodesource.com/node_8.x jessie main' >> /etc/apt/sources.list.d/nodesource.list && \\\n-    apt-get update && apt-get install -y nodejs\n-RUN npm install -g npm@5\n+    apt-get update && apt-get install -y nodejs && \\\n+    curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - && \\\n+    echo 'deb https://dl.yarnpkg.com/debian/ stable main' > /etc/apt/sources.list.d/yarn.list && \\\n+    apt-get update && apt-get install yarn\n \n-COPY ./requirements /app/requirements\n-COPY ./package.json /app/package.json\n+COPY . /app", "body_text": "Moving app up this far will make the Docker layer cache miss all future steps most of the time, making working with Docker locally a lot slower (though it doesn't affect CircleCI). I think it would be better to continue copying only the things needed (requirements/, package.json, package-lock.json).\nDo we need to keep the vendor post-install step? It can be convenient, but I think it mostly gets in my way personally. Alternatively, we could also include the webpack vendor file in this copy.\nThat being said, since we rarely do local development using Docker, the layer cache isn't actually saving us much work. If this is hard to fix, we can leave it as it is now. It is certainly simpler.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/1132", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/152071924", "created_at": "2017-11-20T18:26:04Z", "author_association": "MEMBER", "body": "Moving app up this far will make the Docker layer cache miss all future steps most of the time, making working with Docker locally a lot slower (though it doesn't affect CircleCI). I think it would be better to continue copying only the things needed (`requirements/`, `package.json`, `package-lock.json`).\r\n\r\nDo we need to keep the vendor post-install step? It can be convenient, but I think it mostly gets in my way personally. Alternatively, we could also include the webpack vendor file in this copy.\r\n\r\nThat being said, since we rarely do local development using Docker, the layer cache isn't actually saving us much work. If this is hard to fix, we can leave it as it is now. It is certainly simpler.", "updated_at": "2017-11-20T19:09:20Z", "html_url": "https://github.com/mozilla/normandy/pull/1132#discussion_r152071924", "pull_request_review_id": 77877401, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/152071924"}, "html": {"href": "https://github.com/mozilla/normandy/pull/1132#discussion_r152071924"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/1132"}}, "commit_id": "6a62deef78f3d67bd32938ca57655f0f9151cc76", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/Dockerfile", "body_html": "<p>Moving app up this far will make the Docker layer cache miss all future steps most of the time, making working with Docker locally a lot slower (though it doesn't affect CircleCI). I think it would be better to continue copying only the things needed (<code>requirements/</code>, <code>package.json</code>, <code>package-lock.json</code>).</p>\n<p>Do we need to keep the vendor post-install step? It can be convenient, but I think it mostly gets in my way personally. Alternatively, we could also include the webpack vendor file in this copy.</p>\n<p>That being said, since we rarely do local development using Docker, the layer cache isn't actually saving us much work. If this is hard to fix, we can leave it as it is now. It is certainly simpler.</p>", "original_commit_id": "980e64e4fbd49cef9e1c3d2186cf308d273236de", "id": 152071924}