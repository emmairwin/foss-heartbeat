{"original_position": 65, "diff_hunk": "@@ -16,35 +19,218 @@ export default class ShowHeartbeatAction extends Action {\n     // 'global' storage\n     // (constant namespace - all heartbeats can access)\n     this.heartbeatStorage = normandy.createStorage('normandy-heartbeat');\n+\n+    // context bindings\n+    this.updateLastInteraction = ::this.updateLastInteraction;\n+    this.updateLastShown = ::this.updateLastShown;\n+  }\n+\n+  /**\n+   * Returns a surveyId value. If recipe calls\n+   * to include the Telemetry UUID value,\n+   * then the UUID is attached to the surveyId\n+   * in `<surveyId>::<userId>` format.\n+   *\n+   * @return {String} Survey ID, possibly with user UUID\n+   */\n+  generateSurveyId() {\n+    const {\n+      includeTelemetryUUID,\n+      surveyId,\n+    } = this.recipe.arguments;\n+    const { userId } = this.normandy;\n+\n+    let value = surveyId;\n+\n+    // should user ID stuff be sent to telemetry?\n+    if (includeTelemetryUUID && !!userId) {\n+      // alter the survey ID to include that UUID\n+      value = `${surveyId}::${userId}`;\n+    }\n+\n+    return value;\n   }\n \n   /**\n-   * Calculates the number of milliseconds since the last heartbeat from any recipe\n-   * was shown. Returns a boolean indicating if a heartbeat has been shown recently.\n+   * Returns a boolean indicating if a heartbeat has been shown recently.\n+   *\n+   * Checks the saved `lastShown` value against the current time\n+   * and returns if the time is under HEARTBEAT_THROTTLE milliseconds.\n+   *\n+   * @async\n+   * @return {Boolean}  Has any heartbeat been shown recently?\n    */\n   async heartbeatShownRecently() {\n     const lastShown = await this.heartbeatStorage.getItem('lastShown');\n-    const timeSince = lastShown ? new Date() - lastShown : Infinity;\n+    const timeSince = !!lastShown ? // eslint-disable-line no-extra-boolean-cast", "body_text": "Not a fan of eslint-disable-line where we can avoid it. I think it is right in this case, and the boolean cast doesn't add anything.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/429", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/96913717", "created_at": "2017-01-19T17:35:12Z", "author_association": "MEMBER", "body": "Not a fan of `eslint-disable-line` where we can avoid it. I think it is right in this case, and the boolean cast doesn't add anything.", "updated_at": "2017-01-25T17:16:54Z", "html_url": "https://github.com/mozilla/normandy/pull/429#discussion_r96913717", "pull_request_review_id": 17512272, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/96913717"}, "html": {"href": "https://github.com/mozilla/normandy/pull/429#discussion_r96913717"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/429"}}, "commit_id": "d5274b2a2f7acd69f4786a61d91518dd6c82ab41", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/client/actions/show-heartbeat/index.js", "body_html": "<p>Not a fan of <code>eslint-disable-line</code> where we can avoid it. I think it is right in this case, and the boolean cast doesn't add anything.</p>", "original_commit_id": "fd8be9d878551e484d9a2439b725c9bb42c436ce", "id": 96913717}