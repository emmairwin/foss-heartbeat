{"original_position": 44, "diff_hunk": "@@ -123,3 +124,65 @@ class MockPreferences {\n     }\n   }\n }\n+\n+this.withPrefEnv = function(inPrefs) {\n+  return function wrapper(testFunc) {\n+    return async function inner(...args) {\n+      await SpecialPowers.pushPrefEnv(inPrefs);\n+      try {\n+        await testFunc(...args);\n+      } finally {\n+        await SpecialPowers.popPrefEnv();\n+      }\n+    };\n+  };\n+};\n+\n+/**\n+ * Wrapper around add_task for declaring tests that use several with-style\n+ * wrappers. The last argument should be your test function; all other arguments\n+ * should be functions that accept a single test function argument.\n+ *\n+ * The arguments are composed together and passed to add_task as a single test\n+ * function.\n+ *\n+ * @param {[Function]} args\n+ * @example\n+ *   compose_task(\n+ *     withMockPreferences,\n+ *     withMockNormandyApi,\n+ *     async function myTest(mockPreferences, mockApi) {\n+ *       // Do a test\n+ *     }\n+ *   );\n+ */\n+this.compose_task = function(...args) {", "body_text": "", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/902", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/128831081", "created_at": "2017-07-21T18:31:26Z", "author_association": "MEMBER", "body": "\r\n![](http://www.reactiongifs.com/r/ib.gif)\r\n", "updated_at": "2017-07-27T19:03:51Z", "html_url": "https://github.com/mozilla/normandy/pull/902#discussion_r128831081", "pull_request_review_id": 51551734, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/128831081"}, "html": {"href": "https://github.com/mozilla/normandy/pull/902#discussion_r128831081"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/902"}}, "commit_id": "237c17d02485073a007bad37482bf9ce3a8123e7", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": 44, "path": "recipe-client-addon/test/browser/head.js", "body_html": "<p><a target=\"_blank\" href=\"https://camo.githubusercontent.com/bfa15a93d1261247378bf8722fa617a7e89b9180/687474703a2f2f7777772e7265616374696f6e676966732e636f6d2f722f69622e676966\"><img src=\"https://camo.githubusercontent.com/bfa15a93d1261247378bf8722fa617a7e89b9180/687474703a2f2f7777772e7265616374696f6e676966732e636f6d2f722f69622e676966\" alt=\"\" data-canonical-src=\"http://www.reactiongifs.com/r/ib.gif\" style=\"max-width:100%;\"></a></p>", "original_commit_id": "0443495dd2f06517a842d6707bfeca9b75e3026e", "id": 128831081}