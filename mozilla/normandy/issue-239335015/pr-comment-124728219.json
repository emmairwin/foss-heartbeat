{"original_position": 43, "diff_hunk": "@@ -0,0 +1,140 @@\n+import { Button, Form, Icon, Input, Upload } from 'antd';\n+import autobind from 'autobind-decorator';\n+import { Map } from 'immutable';\n+import React, { PropTypes as pt } from 'react';\n+import { isEqual } from 'underscore';\n+\n+import BaseAntForm from 'control_new/components/common/BaseAntForm';\n+import FormActions from 'control_new/components/common/FormActions';\n+\n+\n+/**\n+ * Form for editing XPIs uploaded to the service.\n+ *\n+ * The XPI field does not use normal Ant field wrappers due to how the Upload\n+ * component works. Instead, the resulting file is stored in the form state and\n+ * appended to the form values after validation.\n+ */\n+@autobind\n+export class _ExtensionForm extends BaseAntForm {\n+  static propTypes = {\n+    extension: pt.instanceOf(Map),\n+    form: pt.object,\n+  }\n+\n+  constructor(props) {\n+    super(props);\n+    this.state = {\n+      xpiName: null,\n+      xpiUrl: null,\n+      xpiFile: null,\n+    };\n+  }\n+\n+  componentWillMount() {\n+    const { extension } = this.props;\n+    if (extension) {\n+      this.setInitialValues(extension);\n+    }\n+  }\n+\n+  componentWillReceiveProps(newProps) {\n+    // Reset form if the extension changed\n+    if (!isEqual(newProps.extension, this.props.extension)) {", "body_text": "We still want to reset the fields if the extension is undefined or null, and isEqual handles them fine. But yeah, the setState stuff won't work if it's undefined. ?. would be useful here (if we weren't using Immutable, that is).", "in_reply_to_id": 124704520, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/851", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/124728219", "created_at": "2017-06-29T07:23:26Z", "author_association": "MEMBER", "body": "We still want to reset the fields if the extension is undefined or null, and `isEqual` handles them fine. But yeah, the `setState` stuff won't work if it's undefined. `?.` would be useful here (if we weren't using Immutable, that is).", "updated_at": "2017-06-29T22:33:36Z", "html_url": "https://github.com/mozilla/normandy/pull/851#discussion_r124728219", "pull_request_review_id": 47043885, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/124728219"}, "html": {"href": "https://github.com/mozilla/normandy/pull/851#discussion_r124728219"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/851"}}, "commit_id": "85676b2552beebf8a1251c780e3088ba40ed81f6", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "position": null, "path": "recipe-server/client/control_new/components/extensions/ExtensionForm.js", "body_html": "<p>We still want to reset the fields if the extension is undefined or null, and <code>isEqual</code> handles them fine. But yeah, the <code>setState</code> stuff won't work if it's undefined. <code>?.</code> would be useful here (if we weren't using Immutable, that is).</p>", "original_commit_id": "cedae8cd4e56de58a3e453c82f25222c0f485b8c", "id": 124728219}