{"original_position": 62, "diff_hunk": "@@ -0,0 +1,127 @@\n+Architecture\n+============\n+Normandy is a component in a larger system called SHIELD. The end goal of SHIELD\n+is to allow Firefox to perform a variety of actions to aid the user and gather\n+feedback to guide us in developer a better browser for them. To do this, we need\n+a way to instruct Firefox to perform certain actions without having to download\n+an update or wait for a new release.\n+\n+To accomplish this goal, the SHIELD system consists of:\n+\n+Normandy\n+   Service that acts as the source of actions that we wish to perform, and\n+   determines which users receive which recipes.\n+Self-Repair System Addon\n+   Ships with Firefox and handles fetching recipes and action implementations\n+   from Normandy and executing them within Firefox.\n+\n+.. note:: Normandy provides both the names of actions and, separately,\n+   implmentations for them to be used in the self-repair system addon. Other\n+   Firefox features may also query Normandy and implement the actions however\n+   they wish, and are not required to use the implementations that Normandy\n+   provides.\n+\n+Normandy / Self-Repair Protocol\n+-------------------------------\n+The following section describes the protocol used to communicate between\n+Normandy and the Self-Repair system addon. The domain ``shield.mozilla.org``\n+is used as a stand-in domain; the actual domain Normandy is hosted at may be\n+different.\n+\n+.. warning:: The following documentation is still in flux and does not describe\n+   a live system yet. Expect the protocol to change.\n+\n+Retrieving Recipes\n+^^^^^^^^^^^^^^^^^^\n+The Self-Repair addon retrieves a list of recipes by making an HTTP POST request\n+to the URL::\n+\n+   https://shield.mozilla.org/api/v1/fetch_bundle\n+\n+The request should contain a JSON object of the form:\n+\n+.. code-block:: json\n+\n+   {\n+      \"locale\": \"en-US\",\n+      \"firefox_version\": \"42.0.1\"\n+   }\n+\n+The API will respond with a JSON object:\n+\n+.. code-block:: json\n+\n+   {\n+      \"recipes\": [\n+         {\n+            \"name\": \"heartbeat.australis.1\",\n+            \"actions\": [\n+               {\n+                  \"name\": \"show_survey\",\n+                  \"impl_hash\": \"4011cf569f3639b9069fc2c50117d3f8597e83c61be2014081ad06ee0fe427c2\",\n+                  \"arguments\": {", "body_text": "I like that. Perhaps this:\nrecipes: [\n    {\n        name: \"heartbeat.australis.1\"\n        actions: [\n            name: \"show_survey\",\n            selfRepairImpl: {\n                hash: \"4011cf569f3639b9069fc2c50117d3f8597e83c61be2014081ad06ee0fe427c2\",\n                url: \"https://shield.mozilla.org/api/v1/actions/show_survey/\"\n            }\n        ]\n    }\n]", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/2", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/49224627", "created_at": "2016-01-08T19:06:01Z", "author_association": "MEMBER", "body": "I like that. Perhaps this:\n\n``` js\nrecipes: [\n    {\n        name: \"heartbeat.australis.1\"\n        actions: [\n            name: \"show_survey\",\n            selfRepairImpl: {\n                hash: \"4011cf569f3639b9069fc2c50117d3f8597e83c61be2014081ad06ee0fe427c2\",\n                url: \"https://shield.mozilla.org/api/v1/actions/show_survey/\"\n            }\n        ]\n    }\n]\n```\n", "updated_at": "2016-01-08T19:06:01Z", "html_url": "https://github.com/mozilla/normandy/pull/2#discussion_r49224627", "pull_request_review_id": null, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/49224627"}, "html": {"href": "https://github.com/mozilla/normandy/pull/2#discussion_r49224627"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/2"}}, "commit_id": "15f768e18e8d27a602fa6479c461676276a00a3f", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "position": 62, "path": "docs/dev/architecture.rst", "body_html": "<p>I like that. Perhaps this:</p>\n<div class=\"highlight highlight-source-js\"><pre>recipes<span class=\"pl-k\">:</span> [\n    {\n        name<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>heartbeat.australis.1<span class=\"pl-pds\">\"</span></span>\n        actions<span class=\"pl-k\">:</span> [\n            name<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>show_survey<span class=\"pl-pds\">\"</span></span>,\n            selfRepairImpl<span class=\"pl-k\">:</span> {\n                hash<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>4011cf569f3639b9069fc2c50117d3f8597e83c61be2014081ad06ee0fe427c2<span class=\"pl-pds\">\"</span></span>,\n                url<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>https://shield.mozilla.org/api/v1/actions/show_survey/<span class=\"pl-pds\">\"</span></span>\n            }\n        ]\n    }\n]</pre></div>", "original_commit_id": "15f768e18e8d27a602fa6479c461676276a00a3f", "id": 49224627}