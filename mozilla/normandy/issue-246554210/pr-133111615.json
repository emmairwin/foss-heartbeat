{"deletions": 119, "merge_commit_sha": "3d5e41c8f3c1dd9c3e82bdf6abb86d8cee8ef027", "additions": 270, "labels": [], "number": 942, "assignee": null, "mergeable": null, "closed_at": "2017-08-03T20:54:28Z", "requested_reviewers": [], "statuses_url": "https://api.github.com/repos/mozilla/normandy/statuses/903d5c551c05f5682b0304557cfbe6bc94229f74", "id": 133111615, "maintainer_can_modify": false, "title": "Fix #940: Mark studies as ended if their add-ons are uninstalled.", "body_text": "This is based off #919; 3b45b72 is the new commit to review.\n@rhelmer The tests pass on this PR, but when I test it out manually with an XPI, my uninstall listener in AddonStudies.jsm is not called when I uninstall a study add-on via about:addons. Is there a reason why a listener for add-on uninstalls would not be called?\nThe TC run for this PR should have a task for building the XPI; check the artifacts there for a copy of the XPI if you want to test it out for yourself. You can use the following line in the browser console to create a new study entry in about:studies:\n// recipeId must be unique for each new study. \nCu.import(\"resource://shield-recipe-client/lib/AddonStudies.jsm\", {}).AddonStudies.start({recipeId: 9000, name: \"My Study\", description: \"Don't worry about it\", addonUrl: \"https://github.com/Osmose/jsonfile-example/releases/download/v1/jsonfile-example.xpi\"})", "comments": 6, "merged_at": "2017-08-03T20:54:28Z", "state": "closed", "_links": {"review_comment": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments{/number}"}, "commits": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/942/commits"}, "self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/942"}, "review_comments": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/942/comments"}, "html": {"href": "https://github.com/mozilla/normandy/pull/942"}, "comments": {"href": "https://api.github.com/repos/mozilla/normandy/issues/942/comments"}, "issue": {"href": "https://api.github.com/repos/mozilla/normandy/issues/942"}, "statuses": {"href": "https://api.github.com/repos/mozilla/normandy/statuses/903d5c551c05f5682b0304557cfbe6bc94229f74"}}, "changed_files": 10, "diff_url": "https://github.com/mozilla/normandy/pull/942.diff", "issue_url": "https://api.github.com/repos/mozilla/normandy/issues/942", "body": "This is based off #919; 3b45b72 is the new commit to review.\r\n\r\n@rhelmer The tests pass on this PR, but when I test it out manually with an XPI, my uninstall listener in `AddonStudies.jsm` is not called when I uninstall a study add-on via `about:addons`. Is there a reason why a listener for add-on uninstalls would not be called?\r\n\r\nThe TC run for this PR should have a task for building the XPI; check the artifacts there for a copy of the XPI if you want to test it out for yourself. You can use the following line in the browser console to create a new study entry in `about:studies`:\r\n\r\n```js\r\n// recipeId must be unique for each new study. \r\nCu.import(\"resource://shield-recipe-client/lib/AddonStudies.jsm\", {}).AddonStudies.start({recipeId: 9000, name: \"My Study\", description: \"Don't worry about it\", addonUrl: \"https://github.com/Osmose/jsonfile-example/releases/download/v1/jsonfile-example.xpi\"})\r\n```", "head": {"repo": {"issues_url": "https://api.github.com/repos/Osmose/normandy/issues{/number}", "deployments_url": "https://api.github.com/repos/Osmose/normandy/deployments", "stargazers_count": 0, "forks_url": "https://api.github.com/repos/Osmose/normandy/forks", "mirror_url": null, "subscription_url": "https://api.github.com/repos/Osmose/normandy/subscription", "notifications_url": "https://api.github.com/repos/Osmose/normandy/notifications{?since,all,participating}", "collaborators_url": "https://api.github.com/repos/Osmose/normandy/collaborators{/collaborator}", "updated_at": "2017-01-07T01:53:48Z", "private": false, "pulls_url": "https://api.github.com/repos/Osmose/normandy/pulls{/number}", "issue_comment_url": "https://api.github.com/repos/Osmose/normandy/issues/comments{/number}", "labels_url": "https://api.github.com/repos/Osmose/normandy/labels{/name}", "has_wiki": true, "full_name": "Osmose/normandy", "owner": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "statuses_url": "https://api.github.com/repos/Osmose/normandy/statuses/{sha}", "id": 48456654, "keys_url": "https://api.github.com/repos/Osmose/normandy/keys{/key_id}", "description": "Self-Repair 2", "tags_url": "https://api.github.com/repos/Osmose/normandy/tags", "archived": false, "downloads_url": "https://api.github.com/repos/Osmose/normandy/downloads", "assignees_url": "https://api.github.com/repos/Osmose/normandy/assignees{/user}", "contents_url": "https://api.github.com/repos/Osmose/normandy/contents/{+path}", "has_pages": false, "git_refs_url": "https://api.github.com/repos/Osmose/normandy/git/refs{/sha}", "open_issues_count": 0, "has_projects": true, "clone_url": "https://github.com/Osmose/normandy.git", "watchers_count": 0, "git_tags_url": "https://api.github.com/repos/Osmose/normandy/git/tags{/sha}", "milestones_url": "https://api.github.com/repos/Osmose/normandy/milestones{/number}", "languages_url": "https://api.github.com/repos/Osmose/normandy/languages", "size": 5331, "homepage": null, "fork": true, "commits_url": "https://api.github.com/repos/Osmose/normandy/commits{/sha}", "releases_url": "https://api.github.com/repos/Osmose/normandy/releases{/id}", "issue_events_url": "https://api.github.com/repos/Osmose/normandy/issues/events{/number}", "archive_url": "https://api.github.com/repos/Osmose/normandy/{archive_format}{/ref}", "comments_url": "https://api.github.com/repos/Osmose/normandy/comments{/number}", "events_url": "https://api.github.com/repos/Osmose/normandy/events", "contributors_url": "https://api.github.com/repos/Osmose/normandy/contributors", "html_url": "https://github.com/Osmose/normandy", "forks": 0, "compare_url": "https://api.github.com/repos/Osmose/normandy/compare/{base}...{head}", "open_issues": 0, "watchers": 0, "git_url": "git://github.com/Osmose/normandy.git", "svn_url": "https://github.com/Osmose/normandy", "merges_url": "https://api.github.com/repos/Osmose/normandy/merges", "has_issues": false, "ssh_url": "git@github.com:Osmose/normandy.git", "blobs_url": "https://api.github.com/repos/Osmose/normandy/git/blobs{/sha}", "git_commits_url": "https://api.github.com/repos/Osmose/normandy/git/commits{/sha}", "hooks_url": "https://api.github.com/repos/Osmose/normandy/hooks", "has_downloads": true, "license": null, "name": "normandy", "language": "JavaScript", "url": "https://api.github.com/repos/Osmose/normandy", "created_at": "2015-12-22T22:18:41Z", "pushed_at": "2017-10-04T15:41:24Z", "forks_count": 0, "default_branch": "master", "teams_url": "https://api.github.com/repos/Osmose/normandy/teams", "trees_url": "https://api.github.com/repos/Osmose/normandy/git/trees{/sha}", "branches_url": "https://api.github.com/repos/Osmose/normandy/branches{/branch}", "subscribers_url": "https://api.github.com/repos/Osmose/normandy/subscribers", "stargazers_url": "https://api.github.com/repos/Osmose/normandy/stargazers"}, "sha": "903d5c551c05f5682b0304557cfbe6bc94229f74", "ref": "monitor-studies", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "label": "Osmose:monitor-studies"}, "commits_url": "https://api.github.com/repos/mozilla/normandy/pulls/942/commits", "commits": 3, "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/942/comments", "html_url": "https://github.com/mozilla/normandy/pull/942", "rebaseable": null, "updated_at": "2017-08-03T20:54:31Z", "base": {"repo": {"issues_url": "https://api.github.com/repos/mozilla/normandy/issues{/number}", "deployments_url": "https://api.github.com/repos/mozilla/normandy/deployments", "stargazers_count": 24, "forks_url": "https://api.github.com/repos/mozilla/normandy/forks", "mirror_url": null, "subscription_url": "https://api.github.com/repos/mozilla/normandy/subscription", "notifications_url": "https://api.github.com/repos/mozilla/normandy/notifications{?since,all,participating}", "collaborators_url": "https://api.github.com/repos/mozilla/normandy/collaborators{/collaborator}", "updated_at": "2018-03-14T22:20:49Z", "private": false, "pulls_url": "https://api.github.com/repos/mozilla/normandy/pulls{/number}", "issue_comment_url": "https://api.github.com/repos/mozilla/normandy/issues/comments{/number}", "labels_url": "https://api.github.com/repos/mozilla/normandy/labels{/name}", "has_wiki": false, "full_name": "mozilla/normandy", "owner": {"following_url": "https://api.github.com/users/mozilla/following{/other_user}", "events_url": "https://api.github.com/users/mozilla/events{/privacy}", "organizations_url": "https://api.github.com/users/mozilla/orgs", "url": "https://api.github.com/users/mozilla", "gists_url": "https://api.github.com/users/mozilla/gists{/gist_id}", "html_url": "https://github.com/mozilla", "subscriptions_url": "https://api.github.com/users/mozilla/subscriptions", "avatar_url": "https://avatars2.githubusercontent.com/u/131524?v=4", "repos_url": "https://api.github.com/users/mozilla/repos", "received_events_url": "https://api.github.com/users/mozilla/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mozilla/starred{/owner}{/repo}", "site_admin": false, "login": "mozilla", "type": "Organization", "id": 131524, "followers_url": "https://api.github.com/users/mozilla/followers"}, "statuses_url": "https://api.github.com/repos/mozilla/normandy/statuses/{sha}", "id": 48456638, "keys_url": "https://api.github.com/repos/mozilla/normandy/keys{/key_id}", "description": "Firefox recipe server", "tags_url": "https://api.github.com/repos/mozilla/normandy/tags", "archived": false, "downloads_url": "https://api.github.com/repos/mozilla/normandy/downloads", "assignees_url": "https://api.github.com/repos/mozilla/normandy/assignees{/user}", "contents_url": "https://api.github.com/repos/mozilla/normandy/contents/{+path}", "has_pages": false, "git_refs_url": "https://api.github.com/repos/mozilla/normandy/git/refs{/sha}", "open_issues_count": 73, "has_projects": true, "clone_url": "https://github.com/mozilla/normandy.git", "watchers_count": 24, "git_tags_url": "https://api.github.com/repos/mozilla/normandy/git/tags{/sha}", "milestones_url": "https://api.github.com/repos/mozilla/normandy/milestones{/number}", "languages_url": "https://api.github.com/repos/mozilla/normandy/languages", "size": 6015, "homepage": "https://wiki.mozilla.org/Firefox/Recipe_Server", "fork": false, "commits_url": "https://api.github.com/repos/mozilla/normandy/commits{/sha}", "releases_url": "https://api.github.com/repos/mozilla/normandy/releases{/id}", "issue_events_url": "https://api.github.com/repos/mozilla/normandy/issues/events{/number}", "archive_url": "https://api.github.com/repos/mozilla/normandy/{archive_format}{/ref}", "comments_url": "https://api.github.com/repos/mozilla/normandy/comments{/number}", "events_url": "https://api.github.com/repos/mozilla/normandy/events", "contributors_url": "https://api.github.com/repos/mozilla/normandy/contributors", "html_url": "https://github.com/mozilla/normandy", "forks": 39, "compare_url": "https://api.github.com/repos/mozilla/normandy/compare/{base}...{head}", "open_issues": 73, "watchers": 24, "git_url": "git://github.com/mozilla/normandy.git", "svn_url": "https://github.com/mozilla/normandy", "merges_url": "https://api.github.com/repos/mozilla/normandy/merges", "has_issues": true, "ssh_url": "git@github.com:mozilla/normandy.git", "blobs_url": "https://api.github.com/repos/mozilla/normandy/git/blobs{/sha}", "git_commits_url": "https://api.github.com/repos/mozilla/normandy/git/commits{/sha}", "hooks_url": "https://api.github.com/repos/mozilla/normandy/hooks", "has_downloads": true, "license": null, "name": "normandy", "language": "Python", "url": "https://api.github.com/repos/mozilla/normandy", "created_at": "2015-12-22T22:18:19Z", "pushed_at": "2018-03-14T22:20:47Z", "forks_count": 39, "default_branch": "master", "teams_url": "https://api.github.com/repos/mozilla/normandy/teams", "trees_url": "https://api.github.com/repos/mozilla/normandy/git/trees{/sha}", "branches_url": "https://api.github.com/repos/mozilla/normandy/branches{/branch}", "subscribers_url": "https://api.github.com/repos/mozilla/normandy/subscribers", "stargazers_url": "https://api.github.com/repos/mozilla/normandy/stargazers"}, "sha": "7fe743b1a3ea139c3bac306be0dced4948f0f732", "ref": "master", "user": {"following_url": "https://api.github.com/users/mozilla/following{/other_user}", "events_url": "https://api.github.com/users/mozilla/events{/privacy}", "organizations_url": "https://api.github.com/users/mozilla/orgs", "url": "https://api.github.com/users/mozilla", "gists_url": "https://api.github.com/users/mozilla/gists{/gist_id}", "html_url": "https://github.com/mozilla", "subscriptions_url": "https://api.github.com/users/mozilla/subscriptions", "avatar_url": "https://avatars2.githubusercontent.com/u/131524?v=4", "repos_url": "https://api.github.com/users/mozilla/repos", "received_events_url": "https://api.github.com/users/mozilla/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mozilla/starred{/owner}{/repo}", "site_admin": false, "login": "mozilla", "type": "Organization", "id": 131524, "followers_url": "https://api.github.com/users/mozilla/followers"}, "label": "mozilla:master"}, "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "milestone": null, "requested_teams": [], "locked": false, "merged_by": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "url": "https://api.github.com/repos/mozilla/normandy/pulls/942", "mergeable_state": "unknown", "created_at": "2017-07-30T00:42:28Z", "merged": true, "review_comments_url": "https://api.github.com/repos/mozilla/normandy/pulls/942/comments", "review_comments": 5, "assignees": [], "review_comment_url": "https://api.github.com/repos/mozilla/normandy/pulls/comments{/number}", "patch_url": "https://github.com/mozilla/normandy/pull/942.patch", "body_html": "<p>This is based off <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"245568892\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/mozilla/normandy/issues/919\" href=\"https://github.com/mozilla/normandy/pull/919\">#919</a>; <a class=\"commit-link\" href=\"https://github.com/mozilla/normandy/commit/3b45b720cf14081c90c3effb147853d12a9b9795\"><tt>3b45b72</tt></a> is the new commit to review.</p>\n<p><a class=\"user-mention\" href=\"https://github.com/rhelmer\">@rhelmer</a> The tests pass on this PR, but when I test it out manually with an XPI, my uninstall listener in <code>AddonStudies.jsm</code> is not called when I uninstall a study add-on via <code>about:addons</code>. Is there a reason why a listener for add-on uninstalls would not be called?</p>\n<p>The TC run for this PR should have a task for building the XPI; check the artifacts there for a copy of the XPI if you want to test it out for yourself. You can use the following line in the browser console to create a new study entry in <code>about:studies</code>:</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-c\"><span class=\"pl-c\">//</span> recipeId must be unique for each new study. </span>\n<span class=\"pl-smi\">Cu</span>.<span class=\"pl-en\">import</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>resource://shield-recipe-client/lib/AddonStudies.jsm<span class=\"pl-pds\">\"</span></span>, {}).<span class=\"pl-smi\">AddonStudies</span>.<span class=\"pl-c1\">start</span>({recipeId<span class=\"pl-k\">:</span> <span class=\"pl-c1\">9000</span>, name<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>My Study<span class=\"pl-pds\">\"</span></span>, description<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Don't worry about it<span class=\"pl-pds\">\"</span></span>, addonUrl<span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>https://github.com/Osmose/jsonfile-example/releases/download/v1/jsonfile-example.xpi<span class=\"pl-pds\">\"</span></span>})</pre></div>"}