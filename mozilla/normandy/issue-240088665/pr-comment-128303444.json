{"original_position": 6, "diff_hunk": "@@ -62,9 +62,9 @@ export default async function apiFetch(url, options = {}) {\n     throw new ApiError(message, data);\n   }\n \n-  if (response.status !== 204) {\n+  try {\n     return response.json();", "body_text": "Just tested this locally and we have to change how the return works a bit:\nlet json = null;\ntry {\n    json = await response.json();\n} catch (error) {}\nreturn json;\n\nIt seems the try wasn't awaiting for the json call to wrap up before moving on, so when a JSON error comes up after closing a request, the page throws an error and the user isn't redirected. Using the above approach fixed the issue for me.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/858", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/128303444", "created_at": "2017-07-19T16:50:32Z", "author_association": "CONTRIBUTOR", "body": "Just tested this locally and we have to change how the `return` works a bit:\r\n\r\n```\r\nlet json = null;\r\ntry {\r\n    json = await response.json();\r\n} catch (error) {}\r\nreturn json;\r\n```\r\nIt seems the `try` wasn't `await`ing for the json call to wrap up before moving on, so when a JSON error comes up after closing a request, the page throws an error and the user isn't redirected. Using the above approach fixed the issue for me.", "updated_at": "2017-07-19T17:27:53Z", "html_url": "https://github.com/mozilla/normandy/pull/858#discussion_r128303444", "pull_request_review_id": 50970677, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/128303444"}, "html": {"href": "https://github.com/mozilla/normandy/pull/858#discussion_r128303444"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/858"}}, "commit_id": "a01fcec3e56173c666db8178da1bee6718534598", "user": {"following_url": "https://api.github.com/users/andymikulski/following{/other_user}", "events_url": "https://api.github.com/users/andymikulski/events{/privacy}", "organizations_url": "https://api.github.com/users/andymikulski/orgs", "url": "https://api.github.com/users/andymikulski", "gists_url": "https://api.github.com/users/andymikulski/gists{/gist_id}", "html_url": "https://github.com/andymikulski", "subscriptions_url": "https://api.github.com/users/andymikulski/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/2767162?v=4", "repos_url": "https://api.github.com/users/andymikulski/repos", "received_events_url": "https://api.github.com/users/andymikulski/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/andymikulski/starred{/owner}{/repo}", "site_admin": false, "login": "andymikulski", "type": "User", "id": 2767162, "followers_url": "https://api.github.com/users/andymikulski/followers"}, "position": null, "path": "recipe-server/client/control_new/utils/apiFetch.js", "body_html": "<p>Just tested this locally and we have to change how the <code>return</code> works a bit:</p>\n<pre><code>let json = null;\ntry {\n    json = await response.json();\n} catch (error) {}\nreturn json;\n</code></pre>\n<p>It seems the <code>try</code> wasn't <code>await</code>ing for the json call to wrap up before moving on, so when a JSON error comes up after closing a request, the page throws an error and the user isn't redirected. Using the above approach fixed the issue for me.</p>", "original_commit_id": "2ff428ce6cde0365d91d0b06b97cd44b788fa143", "id": 128303444}