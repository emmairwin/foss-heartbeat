{"original_position": 69, "diff_hunk": "@@ -126,6 +142,73 @@ add_task(withMockApiServer(async function test_fetchRecipes() {\n   equal(recipes[0].name, \"system-addon-test\");\n }));\n \n+add_task(async function test_fetchRecipes_canonical_mismatch() {\n+  const getApiUrl = sinon.stub(NormandyApi, \"getApiUrl\").resolves(\"http://localhost/recipes/\");\n+\n+  // Recipe is non-canonical (it has whitespace, properties are out of order)\n+  const response = new MockResponse(`[\n+    {\n+      \"recipe\": {\"b\": 1, \"a\": 2},\n+      \"signature\": {\"signature\": \"\", \"x5u\": \"\"}\n+    }\n+  ]`);\n+  const get = sinon.stub(NormandyApi, \"get\").resolves(response);\n+\n+  try {\n+    await NormandyApi.fetchRecipes();\n+    ok(false, \"fetchRecipes did not throw for canonical JSON mismatch\");\n+  } catch (err) {\n+    ok(err instanceof InvalidSignatureError, \"Error was not an InvalidSignatureError\");", "body_text": "I don't have much of a preference except that we should document a preference. Right now we're inconsistent across the codebase. I'll roll with your suggestion.\n(Well, that's a lie; my preference is the style we use with pytest, where assertions generally use the auto-generated \"blah != foo\" message unless the assertion is tricky enough to need more context, but that relies heavily on the context that comes with pytest's output.)", "in_reply_to_id": 122928722, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/818", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/123014687", "created_at": "2017-06-20T15:42:46Z", "author_association": "MEMBER", "body": "I don't have much of a preference except that we should document a preference. Right now we're inconsistent across the codebase. I'll roll with your suggestion.\r\n\r\n(Well, that's a lie; my preference is the style we use with pytest, where assertions generally use the auto-generated \"blah != foo\" message unless the assertion is tricky enough to need more context, but that relies heavily on the context that comes with pytest's output.)", "updated_at": "2017-07-21T16:50:57Z", "html_url": "https://github.com/mozilla/normandy/pull/818#discussion_r123014687", "pull_request_review_id": 45179624, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/123014687"}, "html": {"href": "https://github.com/mozilla/normandy/pull/818#discussion_r123014687"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/818"}}, "commit_id": "93c2a45d817d55211a5aa0ea6379d3d9f8800a8b", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "position": null, "path": "recipe-client-addon/test/unit/test_NormandyApi.js", "body_html": "<p>I don't have much of a preference except that we should document a preference. Right now we're inconsistent across the codebase. I'll roll with your suggestion.</p>\n<p>(Well, that's a lie; my preference is the style we use with pytest, where assertions generally use the auto-generated \"blah != foo\" message unless the assertion is tricky enough to need more context, but that relies heavily on the context that comes with pytest's output.)</p>", "original_commit_id": "260749b2fb00e039a207680482c91bc975ee972d", "id": 123014687}