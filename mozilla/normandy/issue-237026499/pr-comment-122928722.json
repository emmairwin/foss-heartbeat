{"original_position": 69, "diff_hunk": "@@ -126,6 +142,73 @@ add_task(withMockApiServer(async function test_fetchRecipes() {\n   equal(recipes[0].name, \"system-addon-test\");\n }));\n \n+add_task(async function test_fetchRecipes_canonical_mismatch() {\n+  const getApiUrl = sinon.stub(NormandyApi, \"getApiUrl\").resolves(\"http://localhost/recipes/\");\n+\n+  // Recipe is non-canonical (it has whitespace, properties are out of order)\n+  const response = new MockResponse(`[\n+    {\n+      \"recipe\": {\"b\": 1, \"a\": 2},\n+      \"signature\": {\"signature\": \"\", \"x5u\": \"\"}\n+    }\n+  ]`);\n+  const get = sinon.stub(NormandyApi, \"get\").resolves(response);\n+\n+  try {\n+    await NormandyApi.fetchRecipes();\n+    ok(false, \"fetchRecipes did not throw for canonical JSON mismatch\");\n+  } catch (err) {\n+    ok(err instanceof InvalidSignatureError, \"Error was not an InvalidSignatureError\");", "body_text": "Nitty nit: personally, I prefer phrasing assertion messages as \"X should Y\" rather than \"X is Y\" or \"X is not Y\", because reading passing test messages is confusing in the \"X is not Y\" case (and \"X is Y\" is confusing in the failure case, though less so). That is, if I look at this test passing and it says:\nTEST-PASS | Error was not an InvalidSignatureError\n\nI would assume that the error not being an invalid signature error was the right thing. Especially if there are then failures later in the test, the negations cause me to make wrong assumptions about the state of the program prior to the actual test failures.\nAnyway, I recognize this is potentially mostly personal preference, so if you want to leave it like this that wfm.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/818", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/122928722", "created_at": "2017-06-20T09:45:43Z", "author_association": "CONTRIBUTOR", "body": "Nitty nit: personally, I prefer phrasing assertion messages as \"X should Y\" rather than \"X is Y\" or \"X is not Y\", because reading passing test messages is confusing in the \"X is not Y\" case (and \"X is Y\" is confusing in the failure case, though less so). That is, if I look at this test passing and it says:\r\n\r\n```\r\nTEST-PASS | Error was not an InvalidSignatureError\r\n```\r\nI would assume that the error not being an invalid signature error was the right thing. Especially if there are then failures later in the test, the negations cause me to make wrong assumptions about the state of the program prior to the actual test failures.\r\n\r\nAnyway, I recognize this is potentially mostly personal preference, so if you want to leave it like this that wfm.", "updated_at": "2017-07-21T16:50:57Z", "html_url": "https://github.com/mozilla/normandy/pull/818#discussion_r122928722", "pull_request_review_id": 45082071, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/122928722"}, "html": {"href": "https://github.com/mozilla/normandy/pull/818#discussion_r122928722"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/818"}}, "commit_id": "93c2a45d817d55211a5aa0ea6379d3d9f8800a8b", "user": {"following_url": "https://api.github.com/users/gijsk/following{/other_user}", "events_url": "https://api.github.com/users/gijsk/events{/privacy}", "organizations_url": "https://api.github.com/users/gijsk/orgs", "url": "https://api.github.com/users/gijsk", "gists_url": "https://api.github.com/users/gijsk/gists{/gist_id}", "html_url": "https://github.com/gijsk", "subscriptions_url": "https://api.github.com/users/gijsk/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/375983?v=4", "repos_url": "https://api.github.com/users/gijsk/repos", "received_events_url": "https://api.github.com/users/gijsk/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/gijsk/starred{/owner}{/repo}", "site_admin": false, "login": "gijsk", "type": "User", "id": 375983, "followers_url": "https://api.github.com/users/gijsk/followers"}, "position": null, "path": "recipe-client-addon/test/unit/test_NormandyApi.js", "body_html": "<p>Nitty nit: personally, I prefer phrasing assertion messages as \"X should Y\" rather than \"X is Y\" or \"X is not Y\", because reading passing test messages is confusing in the \"X is not Y\" case (and \"X is Y\" is confusing in the failure case, though less so). That is, if I look at this test passing and it says:</p>\n<pre><code>TEST-PASS | Error was not an InvalidSignatureError\n</code></pre>\n<p>I would assume that the error not being an invalid signature error was the right thing. Especially if there are then failures later in the test, the negations cause me to make wrong assumptions about the state of the program prior to the actual test failures.</p>\n<p>Anyway, I recognize this is potentially mostly personal preference, so if you want to leave it like this that wfm.</p>", "original_commit_id": "260749b2fb00e039a207680482c91bc975ee972d", "id": 122928722}