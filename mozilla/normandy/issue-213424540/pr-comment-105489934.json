{"original_position": 18, "diff_hunk": "@@ -0,0 +1,28 @@\n+def parse_csp(header):\n+    directives = {}\n+    parts = [p.strip() for p in header.split(';')]\n+    for part in parts:\n+        if ' ' in part:\n+            directive, data = part.split(' ', 1)\n+        else:\n+            directive = part\n+            data = True\n+        directives[directive] = data\n+    return directives\n+\n+\n+def test_selfrepair_csp_allows_framing(conf, requests_session):\n+    r = requests_session.get(conf.getoption('server') + '/en-US/repair')\n+    r.raise_for_status()\n+    if 'Content-Security-Policy' not in r.headers:\n+        # no CSP, no problem", "body_text": "I agree that not having CSP should be a test failure. However, this test is very narrowly scoped, only dealing with the bug I'm trying to fix here, which is critical functionality not loading due to an overly aggressive CSP policy.", "in_reply_to_id": 105474281, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/604", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/105489934", "created_at": "2017-03-10T21:12:57Z", "author_association": "MEMBER", "body": "I agree that not having CSP should be a test failure. However, this test is very narrowly scoped, only dealing with the bug I'm trying to fix here, which is critical functionality not loading due to an overly aggressive CSP policy.", "updated_at": "2017-03-14T17:38:28Z", "html_url": "https://github.com/mozilla/normandy/pull/604#discussion_r105489934", "pull_request_review_id": 26378216, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/105489934"}, "html": {"href": "https://github.com/mozilla/normandy/pull/604#discussion_r105489934"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/604"}}, "commit_id": "1348521deb365b6756fff6764eb89af69a56cf40", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/contract-tests/test_selfrepair.py", "body_html": "<p>I agree that not having CSP should be a test failure. However, this test is very narrowly scoped, only dealing with the bug I'm trying to fix here, which is critical functionality not loading due to an overly aggressive CSP policy.</p>", "original_commit_id": "f2c63acc83008f88fb64a60888809507c501a82d", "id": 105489934}