{"body_text": "We found a recipe on staging that had no revisions (latest_revision_id was null). This caused issues with migrations, the recipe listing, etc. In general, the site assumes all recipes have a revision.\n@rehandalal pointed out that the code that creates recipes does so by creating a new empty recipe, and then calling recipe.revise to create the first revision, and if revise fails, the recipe will still stick around. We should wrap this code in a database transaction so that the recipe is rolled back in case creating a revision fails for whatever reason.", "labels": [{"url": "https://api.github.com/repos/mozilla/normandy/labels/bug", "color": "b60205", "default": true, "id": 482996638, "name": "bug"}], "number": 779, "assignee": {"following_url": "https://api.github.com/users/rehandalal/following{/other_user}", "events_url": "https://api.github.com/users/rehandalal/events{/privacy}", "organizations_url": "https://api.github.com/users/rehandalal/orgs", "url": "https://api.github.com/users/rehandalal", "gists_url": "https://api.github.com/users/rehandalal/gists{/gist_id}", "html_url": "https://github.com/rehandalal", "subscriptions_url": "https://api.github.com/users/rehandalal/subscriptions", "avatar_url": "https://avatars2.githubusercontent.com/u/987136?v=4", "repos_url": "https://api.github.com/users/rehandalal/repos", "received_events_url": "https://api.github.com/users/rehandalal/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/rehandalal/starred{/owner}{/repo}", "site_admin": false, "login": "rehandalal", "type": "User", "id": 987136, "followers_url": "https://api.github.com/users/rehandalal/followers"}, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2017-05-31T23:21:10Z", "body_html": "<p>We found a recipe on staging that had no revisions (<code>latest_revision_id</code> was null). This caused issues with migrations, the recipe listing, etc. In general, the site assumes all recipes have a revision.</p>\n<p><a class=\"user-mention\" href=\"https://github.com/rehandalal\">@rehandalal</a> pointed out that the code that creates recipes does so by creating a new empty recipe, and then calling <code>recipe.revise</code> to create the first revision, and if <code>revise</code> fails, the recipe will still stick around. We should wrap this code in a database transaction so that the recipe is rolled back in case creating a revision fails for whatever reason.</p>", "id": 231158415, "title": "Use transaction when creating new recipes", "comments": 0, "state": "closed", "body": "We found a recipe on staging that had no revisions (`latest_revision_id` was null). This caused issues with migrations, the recipe listing, etc. In general, the site assumes all recipes have a revision.\r\n\r\n@rehandalal pointed out that the code that creates recipes does so by creating a new empty recipe, and then calling `recipe.revise` to create the first revision, and if `revise` fails, the recipe will still stick around. We should wrap this code in a database transaction so that the recipe is rolled back in case creating a revision fails for whatever reason.", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/779/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/779/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/779/comments", "html_url": "https://github.com/mozilla/normandy/issues/779", "updated_at": "2017-05-31T23:21:10Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/779", "created_at": "2017-05-24T20:16:10Z", "assignees": [{"following_url": "https://api.github.com/users/rehandalal/following{/other_user}", "events_url": "https://api.github.com/users/rehandalal/events{/privacy}", "organizations_url": "https://api.github.com/users/rehandalal/orgs", "url": "https://api.github.com/users/rehandalal", "gists_url": "https://api.github.com/users/rehandalal/gists{/gist_id}", "html_url": "https://github.com/rehandalal", "subscriptions_url": "https://api.github.com/users/rehandalal/subscriptions", "avatar_url": "https://avatars2.githubusercontent.com/u/987136?v=4", "repos_url": "https://api.github.com/users/rehandalal/repos", "received_events_url": "https://api.github.com/users/rehandalal/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/rehandalal/starred{/owner}{/repo}", "site_admin": false, "login": "rehandalal", "type": "User", "id": 987136, "followers_url": "https://api.github.com/users/rehandalal/followers"}]}