{"body_text": "There's a potential race condition in Heartbeat's event emitter, where we might not register events before the heartbeat prompt is shown. This fixes that by using a special event emitter for heartbeat that dispatches each event once, and will run callbacks immediately if the event they're hooked to has already run.\nAlso includes a fix for bug 1302791 because I discovered it while originally writing this patch.\nThis is marked WIP because it lacks tests and should probably be split into two commits, but some feedback on the chosen solution would be appreciated.\n@mythmon f?", "labels": [], "number": 296, "assignee": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2016-10-21T02:13:27Z", "body_html": "<p>There's a potential race condition in Heartbeat's event emitter, where we might not register events before the heartbeat prompt is shown. This fixes that by using a special event emitter for heartbeat that dispatches each event once, and will run callbacks immediately if the event they're hooked to has already run.</p>\n<p>Also includes a fix for <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1302791\" rel=\"nofollow\">bug 1302791</a> because I discovered it while originally writing this patch.</p>\n<p>This is marked WIP because it lacks tests and should probably be split into two commits, but some feedback on the chosen solution would be appreciated.</p>\n<p><a class=\"user-mention\" href=\"https://github.com/mythmon\">@mythmon</a> f?</p>", "id": 183772125, "title": "Fix heartbeat event stuff.", "pull_request": {"url": "https://api.github.com/repos/mozilla/normandy/pulls/296", "diff_url": "https://github.com/mozilla/normandy/pull/296.diff", "html_url": "https://github.com/mozilla/normandy/pull/296", "patch_url": "https://github.com/mozilla/normandy/pull/296.patch"}, "comments": 2, "state": "closed", "body": "There's a potential race condition in Heartbeat's event emitter, where we might not register events before the heartbeat prompt is shown. This fixes that by using a special event emitter for heartbeat that dispatches each event once, and will run callbacks immediately if the event they're hooked to has already run.\n\nAlso includes a fix for [bug 1302791](https://bugzilla.mozilla.org/show_bug.cgi?id=1302791) because I discovered it while originally writing this patch.\n\nThis is marked WIP because it lacks tests and should probably be split into two commits, but some feedback on the chosen solution would be appreciated.\n\n@mythmon f?\n", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/296/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/296/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/296/comments", "html_url": "https://github.com/mozilla/normandy/pull/296", "updated_at": "2016-10-21T02:13:27Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/296", "created_at": "2016-10-18T18:52:33Z", "assignees": [{"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}]}