{"original_position": 27, "diff_hunk": "@@ -0,0 +1,37 @@\n+-- vim:ft=lua\n+message_matcher = message_matcher .. \" && Fields[Type] == 'request.summary'\"\n+\n+s3_path_dimensions = {\n+\t{name=\"log\", source=\"Type\"},\n+\t{name=\"type\", source=\"Fields[Type]\"},\n+\t{name=\"date\", source=\"Fields[Date]\"},\n+\t{name=\"hour\", source=\"Fields[Hour]\"},\n+}\n+\n+parquet_schema = [=[\n+message Log {\n+    required int64 Timestamp;\n+    optional binary Type (UTF8);\n+    optional binary Hostname (UTF8);\n+    optional binary Logger (UTF8);\n+    optional binary EnvVersion (UTF8);\n+    optional int64 Severity;\n+    optional int64 Pid;\n+    optional binary fields_lang (UTF8);\n+    optional binary fields_method (UTF8);\n+    optional binary fields_path (UTF8);\n+    optional binary fields_rid (UTF8);\n+    optional binary fields_uid (UTF8);\n+    optional binary fields_user_agent_browser (UTF8);\n+    optional binary fields_user_agent_os (UTF8);\n+    optional binary fields_user_agent_version (UTF8);", "body_text": "you won't always get the raw agent, because that's PII, but for agents that fail to parse I can keep the agent.\nmozlog json is converted to heka/hindsight messages here:\nhttps://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/decoders/mozlog.lua\nand then fields are removed/transformed here:\nhttps://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/encoders/common.lua\nthe default config options are the ones in place unless configured in these files.", "in_reply_to_id": 99184190, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/472", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/99186737", "created_at": "2017-02-02T18:27:56Z", "author_association": "CONTRIBUTOR", "body": "you won't always get the raw agent, because that's PII, but for agents that fail to parse I can keep the agent.\r\n\r\nmozlog json is converted to heka/hindsight messages here:\r\nhttps://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/decoders/mozlog.lua\r\n\r\nand then fields are removed/transformed here:\r\nhttps://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/encoders/common.lua\r\n\r\nthe default config options are the ones in place unless configured in these files.", "updated_at": "2017-02-06T22:56:33Z", "html_url": "https://github.com/mozilla/normandy/pull/472#discussion_r99186737", "pull_request_review_id": 19855776, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/99186737"}, "html": {"href": "https://github.com/mozilla/normandy/pull/472#discussion_r99186737"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/472"}}, "commit_id": "0d8a9598c0acc6da4ba0c68101ac209d46cd7005", "user": {"following_url": "https://api.github.com/users/relud/following{/other_user}", "events_url": "https://api.github.com/users/relud/events{/privacy}", "organizations_url": "https://api.github.com/users/relud/orgs", "url": "https://api.github.com/users/relud", "gists_url": "https://api.github.com/users/relud/gists{/gist_id}", "html_url": "https://github.com/relud", "subscriptions_url": "https://api.github.com/users/relud/subscriptions", "avatar_url": "https://avatars0.githubusercontent.com/u/433717?v=4", "repos_url": "https://api.github.com/users/relud/repos", "received_events_url": "https://api.github.com/users/relud/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/relud/starred{/owner}{/repo}", "site_admin": false, "login": "relud", "type": "User", "id": 433717, "followers_url": "https://api.github.com/users/relud/followers"}, "position": 29, "path": "recipe-server/parquet_schemas/normandy.admin.docker.app/request.summary.cfg", "body_html": "<p>you won't always get the raw agent, because that's PII, but for agents that fail to parse I can keep the agent.</p>\n<p>mozlog json is converted to heka/hindsight messages here:<br>\n<a href=\"https://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/decoders/mozlog.lua\">https://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/decoders/mozlog.lua</a></p>\n<p>and then fields are removed/transformed here:<br>\n<a href=\"https://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/encoders/common.lua\">https://github.com/mozilla-services/cloudops-deployment/blob/parquet_rework/libs/puppet/modules/logging/files/hindsight/encoders/common.lua</a></p>\n<p>the default config options are the ones in place unless configured in these files.</p>", "original_commit_id": "a8beb1e3c3f4a88ee95d7f5c77f9934f45bad7a2", "id": 99186737}