{"original_position": 115, "diff_hunk": "@@ -51,88 +44,65 @@ export default class MultiPicker extends React.Component {\n       value,\n     } = this.props;\n \n-    const selectedOptions = options.filter(option =>\n-      value.indexOf(option.value) === -1);\n-\n-    let displayedOptions = [].concat(selectedOptions)\n-      .map(option => option.value)\n-      .map(val =>\n-        (!val ? null : { ...this.convertValueToObj(val) }))\n-      .filter(x => x);\n-\n     const {\n       filterText,\n     } = this.state;\n \n-    if (filterText) {\n-      displayedOptions = displayedOptions.filter(option =>\n-        JSON.stringify(option).indexOf(filterText) > -1);\n-    }\n+    let selectedOptions = options.filter(option => value.indexOf(option.value) === -1);\n \n-    return displayedOptions;\n-  }\n-\n-  handleApplyOption(event) {\n-    event.persist();\n-\n-    if (!this.availableRef) {\n-      return;\n-    }\n-\n-    const {\n-      value,\n-      onChange,\n-    } = this.props;\n-\n-    let selectedFilters = MultiPicker.getActiveSelectOptions(this.availableRef);\n+    if (filterText) {\n+      const searchText = filterText.toLowerCase();\n \n-    if (!selectedFilters || selectedFilters.length === 0) {\n-      selectedFilters = this.getDisplayedOptions();\n-      selectedFilters = selectedFilters.map(option => option.value);\n+      selectedOptions = selectedOptions.filter(option => {\n+        const searchValues = JSON.stringify(Object.values(option)).toLowerCase();", "body_text": "Stringifying the array of values and then searching may have unintended side effects:\n\nIt's not necessarily guaranteed that the extra text introduced by JSON-encoding the array won't affect string matching, like if we had values that had commas and quotes in them.\nIt extends text search to all of the fields, rather than only to fields we care about.\n\nIs there a reason to not simply search the individual values we want, instead of combining them into one big string to do a single search over?", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/595", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/106281237", "created_at": "2017-03-15T20:57:55Z", "author_association": "MEMBER", "body": "Stringifying the array of values and then searching may have unintended side effects:\r\n\r\n- It's not necessarily guaranteed that the extra text introduced by JSON-encoding the array won't affect string matching, like if we had values that had commas and quotes in them.\r\n- It extends text search to _all_ of the fields, rather than only to fields we care about.\r\n\r\nIs there a reason to not simply search the individual values we want, instead of combining them into one big string to do a single search over?", "updated_at": "2017-04-17T18:39:15Z", "html_url": "https://github.com/mozilla/normandy/pull/595#discussion_r106281237", "pull_request_review_id": 27192795, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/106281237"}, "html": {"href": "https://github.com/mozilla/normandy/pull/595#discussion_r106281237"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/595"}}, "commit_id": "4fa35e564b9c52cef07a720371a94f5cd0e1de76", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "position": null, "path": "recipe-server/client/control/components/MultiPicker.js", "body_html": "<p>Stringifying the array of values and then searching may have unintended side effects:</p>\n<ul>\n<li>It's not necessarily guaranteed that the extra text introduced by JSON-encoding the array won't affect string matching, like if we had values that had commas and quotes in them.</li>\n<li>It extends text search to <em>all</em> of the fields, rather than only to fields we care about.</li>\n</ul>\n<p>Is there a reason to not simply search the individual values we want, instead of combining them into one big string to do a single search over?</p>", "original_commit_id": "d86998b4c6ba6efa58e580ac84660a14920ac820", "id": 106281237}