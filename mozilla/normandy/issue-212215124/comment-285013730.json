{"body": "OK, so, I think I know what's going on with the unload stuff, at least, even if I don't understand `toSource()` being out of sync. The bootstrap.js code is just broken: \r\nThat is, this: https://github.com/mozilla/normandy/blob/master/recipe-client-addon/bootstrap.js#L93-L95\r\n\r\nEvaluate this in a JS console of choice:\r\n\r\n```js\r\nfor (const x in ['a', 'b']) { console.log(x) }\r\n```\r\n\r\nWe should be using `for of` rather than `for in`. That will remove the requirement to mess with these instructions as then we'll actually unload the right modules, rather than unloading `resource://shield-recipe-client/0`, `resource://shield-recipe-client/1`, `resource://shield-recipe-client/2`, ... (which are all no-ops, to be clear).", "body_text": "OK, so, I think I know what's going on with the unload stuff, at least, even if I don't understand toSource() being out of sync. The bootstrap.js code is just broken:\nThat is, this: https://github.com/mozilla/normandy/blob/master/recipe-client-addon/bootstrap.js#L93-L95\nEvaluate this in a JS console of choice:\nfor (const x in ['a', 'b']) { console.log(x) }\nWe should be using for of rather than for in. That will remove the requirement to mess with these instructions as then we'll actually unload the right modules, rather than unloading resource://shield-recipe-client/0, resource://shield-recipe-client/1, resource://shield-recipe-client/2, ... (which are all no-ops, to be clear).", "url": "https://api.github.com/repos/mozilla/normandy/issues/comments/285013730", "created_at": "2017-03-08T11:10:05Z", "author_association": "CONTRIBUTOR", "html_url": "https://github.com/mozilla/normandy/pull/578#issuecomment-285013730", "updated_at": "2017-03-08T11:11:24Z", "user": {"following_url": "https://api.github.com/users/gijsk/following{/other_user}", "events_url": "https://api.github.com/users/gijsk/events{/privacy}", "organizations_url": "https://api.github.com/users/gijsk/orgs", "url": "https://api.github.com/users/gijsk", "gists_url": "https://api.github.com/users/gijsk/gists{/gist_id}", "html_url": "https://github.com/gijsk", "subscriptions_url": "https://api.github.com/users/gijsk/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/375983?v=4", "repos_url": "https://api.github.com/users/gijsk/repos", "received_events_url": "https://api.github.com/users/gijsk/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/gijsk/starred{/owner}{/repo}", "site_admin": false, "login": "gijsk", "type": "User", "id": 375983, "followers_url": "https://api.github.com/users/gijsk/followers"}, "body_html": "<p>OK, so, I think I know what's going on with the unload stuff, at least, even if I don't understand <code>toSource()</code> being out of sync. The bootstrap.js code is just broken:<br>\nThat is, this: <a href=\"https://github.com/mozilla/normandy/blob/master/recipe-client-addon/bootstrap.js#L93-L95\">https://github.com/mozilla/normandy/blob/master/recipe-client-addon/bootstrap.js#L93-L95</a></p>\n<p>Evaluate this in a JS console of choice:</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-k\">for</span> (<span class=\"pl-k\">const</span> <span class=\"pl-c1\">x</span> <span class=\"pl-k\">in</span> [<span class=\"pl-s\"><span class=\"pl-pds\">'</span>a<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>b<span class=\"pl-pds\">'</span></span>]) { <span class=\"pl-en\">console</span>.<span class=\"pl-c1\">log</span>(x) }</pre></div>\n<p>We should be using <code>for of</code> rather than <code>for in</code>. That will remove the requirement to mess with these instructions as then we'll actually unload the right modules, rather than unloading <code>resource://shield-recipe-client/0</code>, <code>resource://shield-recipe-client/1</code>, <code>resource://shield-recipe-client/2</code>, ... (which are all no-ops, to be clear).</p>", "id": 285013730, "issue_url": "https://api.github.com/repos/mozilla/normandy/issues/578"}