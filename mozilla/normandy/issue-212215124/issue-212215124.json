{"body_text": "Long-term I'd like to do something like make NormandyApi a class, and use an instance of it during recipe runs (and the instance could then be discarded and GC'd to get rid of the index cache), but as a short-term fix, I added a method to clear the index cache that we can use in the mock-server testscases.\nI also added the test method to RecipeRunner to avoid piling up even more calls in the mock-server testcases. The unloading in particular helps get around an issue where running the mock-server testcases in the browser console, then updating the add-on without restarting, would leave the modules loaded in the browser console out-of-date.\nI didn't add tests for these changes because the testRun method is only supposed to be run manually for testing, and NormandyApi.clearIndexCache is hard to unit-test, and will become irrelevant with the aforementioned refactoring that I'll work on soon; it's just a stopgap for now. But feel free to call me out as wrong on this. :D", "labels": [], "number": 578, "assignee": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2017-03-13T23:53:16Z", "body_html": "<p>Long-term I'd like to do something like make <code>NormandyApi</code> a class, and use an instance of it during recipe runs (and the instance could then be discarded and GC'd to get rid of the index cache), but as a short-term fix, I added a method to clear the index cache that we can use in the mock-server testscases.</p>\n<p>I also added the test method to <code>RecipeRunner</code> to avoid piling up even <em>more</em> calls in the mock-server testcases. The unloading in particular helps get around an issue where running the mock-server testcases in the browser console, then updating the add-on without restarting, would leave the modules loaded in the browser console out-of-date.</p>\n<p>I didn't add tests for these changes because the <code>testRun</code> method is only supposed to be run manually for testing, and <code>NormandyApi.clearIndexCache</code> is hard to unit-test, and will become irrelevant with the aforementioned refactoring that I'll work on soon; it's just a stopgap for now. But feel free to call me out as wrong on this. :D</p>", "id": 212215124, "title": "Fix #575: Add method for clearing index cache and mock-server tests.", "pull_request": {"url": "https://api.github.com/repos/mozilla/normandy/pulls/578", "diff_url": "https://github.com/mozilla/normandy/pull/578.diff", "html_url": "https://github.com/mozilla/normandy/pull/578", "patch_url": "https://github.com/mozilla/normandy/pull/578.patch"}, "comments": 5, "state": "closed", "body": "Long-term I'd like to do something like make `NormandyApi` a class, and use an instance of it during recipe runs (and the instance could then be discarded and GC'd to get rid of the index cache), but as a short-term fix, I added a method to clear the index cache that we can use in the mock-server testscases.\r\n\r\nI also added the test method to `RecipeRunner` to avoid piling up even _more_ calls in the mock-server testcases. The unloading in particular helps get around an issue where running the mock-server testcases in the browser console, then updating the add-on without restarting, would leave the modules loaded in the browser console out-of-date.\r\n\r\nI didn't add tests for these changes because the `testRun` method is only supposed to be run manually for testing, and `NormandyApi.clearIndexCache` is hard to unit-test, and will become irrelevant with the aforementioned refactoring that I'll work on soon; it's just a stopgap for now. But feel free to call me out as wrong on this. :D", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/578/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/578/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/578/comments", "html_url": "https://github.com/mozilla/normandy/pull/578", "updated_at": "2017-03-13T23:53:18Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/578", "created_at": "2017-03-06T18:53:00Z", "assignees": [{"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}]}