{"original_position": 7, "diff_hunk": "@@ -148,11 +148,9 @@\n         let url = new URL(`/${testcase.dataset.name}/api/v1`, window.location);\n         testcase.querySelector('.url').textContent = url.href;\n         testcase.querySelector('.browser-code').value = (\n-          `Cu.import('resource://shield-recipe-client/lib/Storage.jsm');\\n` +\n-          `Storage.clearAllStorage();\\n` +\n-          `Services.prefs.setCharPref(\"extensions.shield-recipe-client.api_url\", \"${url.href}\");\\n` +\n+          `Cu.unload('resource://shield-recipe-client/lib/RecipeRunner.jsm');\\n` +", "body_text": "I'm afraid I don't understand what problem this is trying to solve. Can you clarify what steps currently show an issue here?\nAt any point, there's supposed to be only one copy of any given jsm loaded in any one process, keyed by the URL you're using for the load. My understanding is that all of this code only runs in the parent process, and so does the code that updates add-ons. It's not clear to me how calling Cu.unload here makes a difference compared to Cu.unload being called with the exact same URL from the add-on's uninstall code. Are we sure that that uninstall code is running?", "in_reply_to_id": 104525795, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/578", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/104635768", "created_at": "2017-03-07T10:33:09Z", "author_association": "CONTRIBUTOR", "body": "I'm afraid I don't understand what problem this is trying to solve. Can you clarify what steps currently show an issue here?\r\n\r\nAt any point, there's supposed to be only one copy of any given jsm loaded in any one process, keyed by the URL you're using for the load. My understanding is that all of this code only runs in the parent process, and so does the code that updates add-ons. It's not clear to me how calling `Cu.unload` here makes a difference compared to `Cu.unload` being called with the exact same URL from the add-on's uninstall code. Are we sure that that uninstall code is running?", "updated_at": "2017-03-13T19:18:26Z", "html_url": "https://github.com/mozilla/normandy/pull/578#discussion_r104635768", "pull_request_review_id": 25479238, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/104635768"}, "html": {"href": "https://github.com/mozilla/normandy/pull/578#discussion_r104635768"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/578"}}, "commit_id": "9fa06e32e48640d8ad5f91c6c01e366f1adc4248", "user": {"following_url": "https://api.github.com/users/gijsk/following{/other_user}", "events_url": "https://api.github.com/users/gijsk/events{/privacy}", "organizations_url": "https://api.github.com/users/gijsk/orgs", "url": "https://api.github.com/users/gijsk", "gists_url": "https://api.github.com/users/gijsk/gists{/gist_id}", "html_url": "https://github.com/gijsk", "subscriptions_url": "https://api.github.com/users/gijsk/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/375983?v=4", "repos_url": "https://api.github.com/users/gijsk/repos", "received_events_url": "https://api.github.com/users/gijsk/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/gijsk/starred{/owner}{/repo}", "site_admin": false, "login": "gijsk", "type": "User", "id": 375983, "followers_url": "https://api.github.com/users/gijsk/followers"}, "position": null, "path": "mock-recipe-server/api_index.html", "body_html": "<p>I'm afraid I don't understand what problem this is trying to solve. Can you clarify what steps currently show an issue here?</p>\n<p>At any point, there's supposed to be only one copy of any given jsm loaded in any one process, keyed by the URL you're using for the load. My understanding is that all of this code only runs in the parent process, and so does the code that updates add-ons. It's not clear to me how calling <code>Cu.unload</code> here makes a difference compared to <code>Cu.unload</code> being called with the exact same URL from the add-on's uninstall code. Are we sure that that uninstall code is running?</p>", "original_commit_id": "45491155b62a9bd4332b0a7ec52023eb62d7d79d", "id": 104635768}