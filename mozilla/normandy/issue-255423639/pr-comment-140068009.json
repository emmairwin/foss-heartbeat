{"original_position": 75, "diff_hunk": "@@ -1,29 +1,91 @@\n+import { Spin } from 'antd';\n+import autobind from 'autobind-decorator';\n import React from 'react';\n import PropTypes from 'prop-types';\n \n+@autobind\n export default class ShieldIdenticon extends React.PureComponent {\n   static propTypes = {\n     seed: PropTypes.string.isRequired,\n     size: PropTypes.number,\n     className: PropTypes.string,\n-  }\n+  };\n \n   static defaultProps = {\n     size: 64,\n     className: null,\n+  };\n+\n+  static loadWaitTime = 100; // ms\n+\n+  state = {\n+    isLoading: false,\n+  };\n+\n+  componentWillUnmount() {\n+    clearTimeout(this.loadTimer);\n+    if (this.imgInstance) {\n+      this.imgInstance.onload = () => {};\n+    }\n+  }\n+\n+  onImageMount(img) {\n+    if (!img) {\n+      return;\n+    }\n+\n+    this.imgInstance = img;\n+\n+    // If the image has already been loaded (via cache) then skip the loading UI logic.\n+    if (this.imgInstance.complete) {\n+      return;\n+    }\n+\n+    this.loadTimer = setTimeout(() => {\n+      // If the image has not loaded by now, display the loading spinner and hook\n+      // into the image's `onload` event.\n+      if (!this.imgInstance.complete) {\n+        this.showLoadingState();\n+      }\n+    }, ShieldIdenticon.loadWaitTime);\n+  }\n+\n+  showLoadingState() {\n+    this.setState({\n+      isLoading: true,\n+    });\n+\n+    this.imgInstance.onload = () => {\n+      this.setState({\n+        isLoading: false,\n+      });\n+    };\n   }\n \n   render() {\n     const { seed, size, className } = this.props;\n \n+    if (typeof seed === 'undefined') {\n+      return null;\n+    }\n+\n+    // In order to prevent the the page jumping while the image is loading, we'll\n+    // squish and hide it until it has loaded.\n+    const imgStyle = { height: 0, width: 0, position: 'absolute' };", "body_text": "I've clarified the comment - it was more specifically to hide the img tag's alt text that shows up if the image is not loaded immediately. Without this, the text Shield Identicon is placed on the page before the spinner shows up, and looks weird.\nre: page jumping, I've also changed styling to force the container to the same size when loading/displaying shields.", "in_reply_to_id": 139773097, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/1038", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/140068009", "created_at": "2017-09-20T19:24:25Z", "author_association": "CONTRIBUTOR", "body": "I've clarified the comment - it was more specifically to hide the img tag's `alt` text that shows up if the image is not loaded immediately. Without this, the text `Shield Identicon` is placed on the page before the spinner shows up, and looks weird.\r\n\r\nre: page jumping, I've also changed styling to force the container to the same size when loading/displaying shields.", "updated_at": "2017-09-25T20:10:33Z", "html_url": "https://github.com/mozilla/normandy/pull/1038#discussion_r140068009", "pull_request_review_id": 64088220, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/140068009"}, "html": {"href": "https://github.com/mozilla/normandy/pull/1038#discussion_r140068009"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/1038"}}, "commit_id": "58f13fafca6ae9b8bb32a1610d33a3d79aba7dfe", "user": {"following_url": "https://api.github.com/users/andymikulski/following{/other_user}", "events_url": "https://api.github.com/users/andymikulski/events{/privacy}", "organizations_url": "https://api.github.com/users/andymikulski/orgs", "url": "https://api.github.com/users/andymikulski", "gists_url": "https://api.github.com/users/andymikulski/gists{/gist_id}", "html_url": "https://github.com/andymikulski", "subscriptions_url": "https://api.github.com/users/andymikulski/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/2767162?v=4", "repos_url": "https://api.github.com/users/andymikulski/repos", "received_events_url": "https://api.github.com/users/andymikulski/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/andymikulski/starred{/owner}{/repo}", "site_admin": false, "login": "andymikulski", "type": "User", "id": 2767162, "followers_url": "https://api.github.com/users/andymikulski/followers"}, "position": null, "path": "recipe-server/client/control_new/components/common/ShieldIdenticon.js", "body_html": "<p>I've clarified the comment - it was more specifically to hide the img tag's <code>alt</code> text that shows up if the image is not loaded immediately. Without this, the text <code>Shield Identicon</code> is placed on the page before the spinner shows up, and looks weird.</p>\n<p>re: page jumping, I've also changed styling to force the container to the same size when loading/displaying shields.</p>", "original_commit_id": "ea6931f212723045859f9e75c7bc64063319a60f", "id": 140068009}