{"body": "I think that the earliest we can reasonably start running something like fetching code is after `sessionstore-windows-restored` (see https://developer.mozilla.org/en-US/docs/Observer_Notifications) - we'll need an observer like:\r\n\r\n```\r\nCu.import(\"resource://gre/modules/XPCOMUtils.jsm\");\r\nCu.import(\"resource://gre/modules/Services.jsm\");\r\n\r\nlet observer = {\r\n  observe: function(subject, topic, data)\r\n  {\r\n    Services.obs.removeObserver(\"sessionstore-windows-restored\", this);\r\n    // fetch and execute recipes\r\n  },\r\n  QueryInterface: XPCOMUtils.generateQI([\r\n    Components.interfaces.nsIObserver,\r\n    Components.interfaces.nsISupportsWeakReference\r\n  ])\r\n};\r\nServices.obs.addObserver(\"sessionstore-windows-restored\", observer, true);\r\n```\r\nSince there's already an update timer being used I suspect we can just trigger it to run when the observer notification fires. ", "body_text": "I think that the earliest we can reasonably start running something like fetching code is after sessionstore-windows-restored (see https://developer.mozilla.org/en-US/docs/Observer_Notifications) - we'll need an observer like:\nCu.import(\"resource://gre/modules/XPCOMUtils.jsm\");\nCu.import(\"resource://gre/modules/Services.jsm\");\n\nlet observer = {\n  observe: function(subject, topic, data)\n  {\n    Services.obs.removeObserver(\"sessionstore-windows-restored\", this);\n    // fetch and execute recipes\n  },\n  QueryInterface: XPCOMUtils.generateQI([\n    Components.interfaces.nsIObserver,\n    Components.interfaces.nsISupportsWeakReference\n  ])\n};\nServices.obs.addObserver(\"sessionstore-windows-restored\", observer, true);\n\nSince there's already an update timer being used I suspect we can just trigger it to run when the observer notification fires.", "url": "https://api.github.com/repos/mozilla/normandy/issues/comments/315481310", "created_at": "2017-07-14T22:18:32Z", "author_association": "MEMBER", "html_url": "https://github.com/mozilla/normandy/issues/889#issuecomment-315481310", "updated_at": "2017-07-14T22:18:32Z", "user": {"following_url": "https://api.github.com/users/rhelmer/following{/other_user}", "events_url": "https://api.github.com/users/rhelmer/events{/privacy}", "organizations_url": "https://api.github.com/users/rhelmer/orgs", "url": "https://api.github.com/users/rhelmer", "gists_url": "https://api.github.com/users/rhelmer/gists{/gist_id}", "html_url": "https://github.com/rhelmer", "subscriptions_url": "https://api.github.com/users/rhelmer/subscriptions", "avatar_url": "https://avatars0.githubusercontent.com/u/61412?v=4", "repos_url": "https://api.github.com/users/rhelmer/repos", "received_events_url": "https://api.github.com/users/rhelmer/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/rhelmer/starred{/owner}{/repo}", "site_admin": false, "login": "rhelmer", "type": "User", "id": 61412, "followers_url": "https://api.github.com/users/rhelmer/followers"}, "body_html": "<p>I think that the earliest we can reasonably start running something like fetching code is after <code>sessionstore-windows-restored</code> (see <a href=\"https://developer.mozilla.org/en-US/docs/Observer_Notifications\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Observer_Notifications</a>) - we'll need an observer like:</p>\n<pre><code>Cu.import(\"resource://gre/modules/XPCOMUtils.jsm\");\nCu.import(\"resource://gre/modules/Services.jsm\");\n\nlet observer = {\n  observe: function(subject, topic, data)\n  {\n    Services.obs.removeObserver(\"sessionstore-windows-restored\", this);\n    // fetch and execute recipes\n  },\n  QueryInterface: XPCOMUtils.generateQI([\n    Components.interfaces.nsIObserver,\n    Components.interfaces.nsISupportsWeakReference\n  ])\n};\nServices.obs.addObserver(\"sessionstore-windows-restored\", observer, true);\n</code></pre>\n<p>Since there's already an update timer being used I suspect we can just trigger it to run when the observer notification fires.</p>", "id": 315481310, "issue_url": "https://api.github.com/repos/mozilla/normandy/issues/889"}