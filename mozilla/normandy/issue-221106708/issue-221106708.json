{"body_text": "This test is currently failing with the below traceback. @Osmose, @rehandalal does this looks like a correct test? If so, we can start in on fixing it.\n_________ normandy/recipes/tests/test_api.py::test_full_approval_flow __________\nnormandy/recipes/tests/test_api.py:730: in test_full_approval_flow\n    assert res.json() == signed_data_1\nE   assert [{'recipe': {...'x5u': None}}] == [{'recipe': {'...'x5u': None}}]\nE     At index 0 diff: {'recipe': {'action': '\u0111PjUlwrrgnTAY', 'approval_request': None, 'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'arguments': {}, 'channels': [], 'countries': [], 'enabled': False, 'extra_filter_expression': 'counter == 0', 'filter_expression': 'counter == 0', 'id': 94, 'is_approved': True, 'last_updated': '2017-04-11T23:11:21.300314Z', 'latest_revision_id': 'c6c6e466e8c551c7ed8f4b3e021433164ea195d159d414e0dead92620b7a099a', 'locales': [], 'name': 'test recipe', 'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'}, 'signature': {'public_key': '', 'signature': '343230392a94cbf7f237eaf631240a6c506f4f23e40273c9be0529870c7b1bb3', 'timestamp': '2017-04-11T23:11:21.403831Z', 'x5u': None}} != {'recipe': {'action': '\u0111PjUlwrrgnTAY', 'approval_request': {'approved': True, 'approver': {'email': 'test73@example.com', 'first_name': '', 'id': 152, 'last_name': ''}, 'comment': 'r+', 'created': '2017-04-11T23:11:21.317127Z', 'creator': {'email': 'test72@example.com', 'first_name': '', 'id': 151, 'last_name': ''}, 'id': 30}, 'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'arguments': {}, 'channels': [], 'countries': [], 'enabled': False, 'extra_filter_expression': 'counter == 0', 'filter_expression': 'counter == 0', 'id': 94, 'is_approved': True, 'last_updated': '2017-04-11T23:11:21.300314Z', 'latest_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'locales': [], 'name': 'test recipe', 'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'}, 'signature': {'public_key': '', 'signature': '0d60a6d4776cfa6a6c4135d1c14d4dc552b9b1745228379bdfa0f94941773696', 'timestamp': '2017-04-11T23:11:21.336857Z', 'x5u': None}}\nE     Full diff:\nE     [{'recipe': {'action': '\u0111PjUlwrrgnTAY',\nE     -              'approval_request': None,\nE     ?                                  ^ ^\nE     +              'approval_request': {'approved': True,\nE     ?                                  ^^^^^^ ^^^^^^^^^\nE     +                                   'approver': {'email': 'test73@example.com',\nE     +                                                'first_name': '',\nE     +                                                'id': 152,\nE     +                                                'last_name': ''},\nE     +                                   'comment': 'r+',\nE     +                                   'created': '2017-04-11T23:11:21.317127Z',\nE     +                                   'creator': {'email': 'test72@example.com',\nE     +                                               'first_name': '',\nE     +                                               'id': 151,\nE     +                                               'last_name': ''},\nE     +                                   'id': 30},\nE     'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4',\nE     'arguments': {},\nE     'channels': [],\nE     'countries': [],\nE     'enabled': False,\nE     'extra_filter_expression': 'counter == 0',\nE     'filter_expression': 'counter == 0',\nE     'id': 94,\nE     'is_approved': True,\nE     'last_updated': '2017-04-11T23:11:21.300314Z',\nE     -              'latest_revision_id': 'c6c6e466e8c551c7ed8f4b3e021433164ea195d159d414e0dead92620b7a099a',\nE     +              'latest_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4',\nE     'locales': [],\nE     'name': 'test recipe',\nE     'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'},\nE     'signature': {'public_key': '',\nE     -                 'signature': '343230392a94cbf7f237eaf631240a6c506f4f23e40273c9be0529870c7b1bb3',\nE     +                 'signature': '0d60a6d4776cfa6a6c4135d1c14d4dc552b9b1745228379bdfa0f94941773696',\nE     -                 'timestamp': '2017-04-11T23:11:21.403831Z',\nE     ?                                                   --  ^^\nE     +                 'timestamp': '2017-04-11T23:11:21.336857Z',\nE     ?                                                    ++ ^^\nE     'x5u': None}}]\n----------------------------- Captured stderr call -----------------------------\nINFO 2017-04-11 23:11:21,294 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,297 normandy.recipes.models Creating new revision for recipe ID [94]\nINFO 2017-04-11 23:11:21,301 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,314 request.summary \nINFO 2017-04-11 23:11:21,318 request.summary \nINFO 2017-04-11 23:11:21,321 request.summary \nINFO 2017-04-11 23:11:21,326 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,339 request.summary \nINFO 2017-04-11 23:11:21,352 request.summary \nINFO 2017-04-11 23:11:21,367 request.summary \nINFO 2017-04-11 23:11:21,390 normandy.recipes.models Creating new revision for recipe ID [94]\nINFO 2017-04-11 23:11:21,395 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,410 request.summary \nINFO 2017-04-11 23:11:21,423 request.summary \nINFO 2017-04-11 23:11:21,436 request.summary \n!!!!!!!!!!!!!!!!!!!! Interrupted: stopping after 1 failures !!!!!!!!!!!!!!!!!!!!", "labels": [], "number": 682, "assignee": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2017-04-12T02:51:31Z", "body_html": "<p>This test is currently failing with the below traceback. <a class=\"user-mention\" href=\"https://github.com/osmose\">@Osmose</a>, <a class=\"user-mention\" href=\"https://github.com/rehandalal\">@rehandalal</a> does this looks like a correct test? If so, we can start in on fixing it.</p>\n<pre><code>_________ normandy/recipes/tests/test_api.py::test_full_approval_flow __________\nnormandy/recipes/tests/test_api.py:730: in test_full_approval_flow\n    assert res.json() == signed_data_1\nE   assert [{'recipe': {...'x5u': None}}] == [{'recipe': {'...'x5u': None}}]\nE     At index 0 diff: {'recipe': {'action': '\u0111PjUlwrrgnTAY', 'approval_request': None, 'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'arguments': {}, 'channels': [], 'countries': [], 'enabled': False, 'extra_filter_expression': 'counter == 0', 'filter_expression': 'counter == 0', 'id': 94, 'is_approved': True, 'last_updated': '2017-04-11T23:11:21.300314Z', 'latest_revision_id': 'c6c6e466e8c551c7ed8f4b3e021433164ea195d159d414e0dead92620b7a099a', 'locales': [], 'name': 'test recipe', 'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'}, 'signature': {'public_key': '', 'signature': '343230392a94cbf7f237eaf631240a6c506f4f23e40273c9be0529870c7b1bb3', 'timestamp': '2017-04-11T23:11:21.403831Z', 'x5u': None}} != {'recipe': {'action': '\u0111PjUlwrrgnTAY', 'approval_request': {'approved': True, 'approver': {'email': 'test73@example.com', 'first_name': '', 'id': 152, 'last_name': ''}, 'comment': 'r+', 'created': '2017-04-11T23:11:21.317127Z', 'creator': {'email': 'test72@example.com', 'first_name': '', 'id': 151, 'last_name': ''}, 'id': 30}, 'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'arguments': {}, 'channels': [], 'countries': [], 'enabled': False, 'extra_filter_expression': 'counter == 0', 'filter_expression': 'counter == 0', 'id': 94, 'is_approved': True, 'last_updated': '2017-04-11T23:11:21.300314Z', 'latest_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'locales': [], 'name': 'test recipe', 'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'}, 'signature': {'public_key': '', 'signature': '0d60a6d4776cfa6a6c4135d1c14d4dc552b9b1745228379bdfa0f94941773696', 'timestamp': '2017-04-11T23:11:21.336857Z', 'x5u': None}}\nE     Full diff:\nE     [{'recipe': {'action': '\u0111PjUlwrrgnTAY',\nE     -              'approval_request': None,\nE     ?                                  ^ ^\nE     +              'approval_request': {'approved': True,\nE     ?                                  ^^^^^^ ^^^^^^^^^\nE     +                                   'approver': {'email': 'test73@example.com',\nE     +                                                'first_name': '',\nE     +                                                'id': 152,\nE     +                                                'last_name': ''},\nE     +                                   'comment': 'r+',\nE     +                                   'created': '2017-04-11T23:11:21.317127Z',\nE     +                                   'creator': {'email': 'test72@example.com',\nE     +                                               'first_name': '',\nE     +                                               'id': 151,\nE     +                                               'last_name': ''},\nE     +                                   'id': 30},\nE     'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4',\nE     'arguments': {},\nE     'channels': [],\nE     'countries': [],\nE     'enabled': False,\nE     'extra_filter_expression': 'counter == 0',\nE     'filter_expression': 'counter == 0',\nE     'id': 94,\nE     'is_approved': True,\nE     'last_updated': '2017-04-11T23:11:21.300314Z',\nE     -              'latest_revision_id': 'c6c6e466e8c551c7ed8f4b3e021433164ea195d159d414e0dead92620b7a099a',\nE     +              'latest_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4',\nE     'locales': [],\nE     'name': 'test recipe',\nE     'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'},\nE     'signature': {'public_key': '',\nE     -                 'signature': '343230392a94cbf7f237eaf631240a6c506f4f23e40273c9be0529870c7b1bb3',\nE     +                 'signature': '0d60a6d4776cfa6a6c4135d1c14d4dc552b9b1745228379bdfa0f94941773696',\nE     -                 'timestamp': '2017-04-11T23:11:21.403831Z',\nE     ?                                                   --  ^^\nE     +                 'timestamp': '2017-04-11T23:11:21.336857Z',\nE     ?                                                    ++ ^^\nE     'x5u': None}}]\n----------------------------- Captured stderr call -----------------------------\nINFO 2017-04-11 23:11:21,294 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,297 normandy.recipes.models Creating new revision for recipe ID [94]\nINFO 2017-04-11 23:11:21,301 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,314 request.summary \nINFO 2017-04-11 23:11:21,318 request.summary \nINFO 2017-04-11 23:11:21,321 request.summary \nINFO 2017-04-11 23:11:21,326 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,339 request.summary \nINFO 2017-04-11 23:11:21,352 request.summary \nINFO 2017-04-11 23:11:21,367 request.summary \nINFO 2017-04-11 23:11:21,390 normandy.recipes.models Creating new revision for recipe ID [94]\nINFO 2017-04-11 23:11:21,395 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\nINFO 2017-04-11 23:11:21,410 request.summary \nINFO 2017-04-11 23:11:21,423 request.summary \nINFO 2017-04-11 23:11:21,436 request.summary \n!!!!!!!!!!!!!!!!!!!! Interrupted: stopping after 1 failures !!!!!!!!!!!!!!!!!!!!\n</code></pre>", "id": 221106708, "title": "recipe-server: Add test for signing consistency during approval.", "pull_request": {"url": "https://api.github.com/repos/mozilla/normandy/pulls/682", "diff_url": "https://github.com/mozilla/normandy/pull/682.diff", "html_url": "https://github.com/mozilla/normandy/pull/682", "patch_url": "https://github.com/mozilla/normandy/pull/682.patch"}, "comments": 5, "state": "closed", "body": "This test is currently failing with the below traceback. @Osmose, @rehandalal does this looks like a correct test? If so, we can start in on fixing it.\r\n\r\n```\r\n_________ normandy/recipes/tests/test_api.py::test_full_approval_flow __________\r\nnormandy/recipes/tests/test_api.py:730: in test_full_approval_flow\r\n    assert res.json() == signed_data_1\r\nE   assert [{'recipe': {...'x5u': None}}] == [{'recipe': {'...'x5u': None}}]\r\nE     At index 0 diff: {'recipe': {'action': '\u0111PjUlwrrgnTAY', 'approval_request': None, 'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'arguments': {}, 'channels': [], 'countries': [], 'enabled': False, 'extra_filter_expression': 'counter == 0', 'filter_expression': 'counter == 0', 'id': 94, 'is_approved': True, 'last_updated': '2017-04-11T23:11:21.300314Z', 'latest_revision_id': 'c6c6e466e8c551c7ed8f4b3e021433164ea195d159d414e0dead92620b7a099a', 'locales': [], 'name': 'test recipe', 'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'}, 'signature': {'public_key': '', 'signature': '343230392a94cbf7f237eaf631240a6c506f4f23e40273c9be0529870c7b1bb3', 'timestamp': '2017-04-11T23:11:21.403831Z', 'x5u': None}} != {'recipe': {'action': '\u0111PjUlwrrgnTAY', 'approval_request': {'approved': True, 'approver': {'email': 'test73@example.com', 'first_name': '', 'id': 152, 'last_name': ''}, 'comment': 'r+', 'created': '2017-04-11T23:11:21.317127Z', 'creator': {'email': 'test72@example.com', 'first_name': '', 'id': 151, 'last_name': ''}, 'id': 30}, 'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'arguments': {}, 'channels': [], 'countries': [], 'enabled': False, 'extra_filter_expression': 'counter == 0', 'filter_expression': 'counter == 0', 'id': 94, 'is_approved': True, 'last_updated': '2017-04-11T23:11:21.300314Z', 'latest_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4', 'locales': [], 'name': 'test recipe', 'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'}, 'signature': {'public_key': '', 'signature': '0d60a6d4776cfa6a6c4135d1c14d4dc552b9b1745228379bdfa0f94941773696', 'timestamp': '2017-04-11T23:11:21.336857Z', 'x5u': None}}\r\nE     Full diff:\r\nE     [{'recipe': {'action': '\u0111PjUlwrrgnTAY',\r\nE     -              'approval_request': None,\r\nE     ?                                  ^ ^\r\nE     +              'approval_request': {'approved': True,\r\nE     ?                                  ^^^^^^ ^^^^^^^^^\r\nE     +                                   'approver': {'email': 'test73@example.com',\r\nE     +                                                'first_name': '',\r\nE     +                                                'id': 152,\r\nE     +                                                'last_name': ''},\r\nE     +                                   'comment': 'r+',\r\nE     +                                   'created': '2017-04-11T23:11:21.317127Z',\r\nE     +                                   'creator': {'email': 'test72@example.com',\r\nE     +                                               'first_name': '',\r\nE     +                                               'id': 151,\r\nE     +                                               'last_name': ''},\r\nE     +                                   'id': 30},\r\nE     'approved_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4',\r\nE     'arguments': {},\r\nE     'channels': [],\r\nE     'countries': [],\r\nE     'enabled': False,\r\nE     'extra_filter_expression': 'counter == 0',\r\nE     'filter_expression': 'counter == 0',\r\nE     'id': 94,\r\nE     'is_approved': True,\r\nE     'last_updated': '2017-04-11T23:11:21.300314Z',\r\nE     -              'latest_revision_id': 'c6c6e466e8c551c7ed8f4b3e021433164ea195d159d414e0dead92620b7a099a',\r\nE     +              'latest_revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4',\r\nE     'locales': [],\r\nE     'name': 'test recipe',\r\nE     'revision_id': '4f415737bb0f7b350e546b1bd569917481ceb33f520f91749e42ea303aa2ddf4'},\r\nE     'signature': {'public_key': '',\r\nE     -                 'signature': '343230392a94cbf7f237eaf631240a6c506f4f23e40273c9be0529870c7b1bb3',\r\nE     +                 'signature': '0d60a6d4776cfa6a6c4135d1c14d4dc552b9b1745228379bdfa0f94941773696',\r\nE     -                 'timestamp': '2017-04-11T23:11:21.403831Z',\r\nE     ?                                                   --  ^^\r\nE     +                 'timestamp': '2017-04-11T23:11:21.336857Z',\r\nE     ?                                                    ++ ^^\r\nE     'x5u': None}}]\r\n----------------------------- Captured stderr call -----------------------------\r\nINFO 2017-04-11 23:11:21,294 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\r\nINFO 2017-04-11 23:11:21,297 normandy.recipes.models Creating new revision for recipe ID [94]\r\nINFO 2017-04-11 23:11:21,301 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\r\nINFO 2017-04-11 23:11:21,314 request.summary \r\nINFO 2017-04-11 23:11:21,318 request.summary \r\nINFO 2017-04-11 23:11:21,321 request.summary \r\nINFO 2017-04-11 23:11:21,326 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\r\nINFO 2017-04-11 23:11:21,339 request.summary \r\nINFO 2017-04-11 23:11:21,352 request.summary \r\nINFO 2017-04-11 23:11:21,367 request.summary \r\nINFO 2017-04-11 23:11:21,390 normandy.recipes.models Creating new revision for recipe ID [94]\r\nINFO 2017-04-11 23:11:21,395 normandy.recipes.models Requesting signatures for recipes with ids [94] from Autograph\r\nINFO 2017-04-11 23:11:21,410 request.summary \r\nINFO 2017-04-11 23:11:21,423 request.summary \r\nINFO 2017-04-11 23:11:21,436 request.summary \r\n!!!!!!!!!!!!!!!!!!!! Interrupted: stopping after 1 failures !!!!!!!!!!!!!!!!!!!!\r\n```", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/682/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/682/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/682/comments", "html_url": "https://github.com/mozilla/normandy/pull/682", "updated_at": "2017-04-12T07:31:52Z", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/682", "created_at": "2017-04-11T23:12:35Z", "assignees": [{"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}]}