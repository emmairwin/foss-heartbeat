{"original_position": 37, "diff_hunk": "@@ -10,35 +9,32 @@ Cu.import(\"resource://gre/modules/Services.jsm\");\n Cu.import(\"resource://gre/modules/Task.jsm\");\n Cu.import(\"resource://gre/modules/CanonicalJSON.jsm\");\n Cu.import(\"resource://shield-recipe-client/lib/LogManager.jsm\");\n-Cu.importGlobalProperties([\"fetch\"]); /* globals fetch */\n+Cu.importGlobalProperties([\"fetch\", \"URL\"]); /* globals fetch, URL */\n \n this.EXPORTED_SYMBOLS = [\"NormandyApi\"];\n \n const log = LogManager.getLogger(\"normandy-api\");\n const prefs = Services.prefs.getBranch(\"extensions.shield-recipe-client.\");\n \n this.NormandyApi = {\n-  apiCall(method, endpoint, data = {}) {\n+  apiCall(method, endpoint, data) {\n     const api_url = prefs.getCharPref(\"api_url\");\n-    let url = `${api_url}/${endpoint}`;\n+    const url = new URL(`${api_url}/${endpoint}`);\n     method = method.toLowerCase();\n \n-    if (method === \"get\") {\n-      if (data === {}) {\n-        const paramObj = new URLSearchParams();\n-        for (const key in data) {\n-          paramObj.append(key, data[key]);\n+    let body = undefined;\n+    if (data !== undefined) {\n+      if (method === \"get\") {\n+        for (const key of Object.keys(data)) {\n+          url.searchParams.set(key, data[key]);", "body_text": "Sadfaces that there's no batch-set API here...", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/555", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/103117778", "created_at": "2017-02-26T21:42:46Z", "author_association": "CONTRIBUTOR", "body": "Sadfaces that there's no batch-set API here...", "updated_at": "2017-02-27T21:20:56Z", "html_url": "https://github.com/mozilla/normandy/pull/555#discussion_r103117778", "pull_request_review_id": 23894281, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/103117778"}, "html": {"href": "https://github.com/mozilla/normandy/pull/555#discussion_r103117778"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/555"}}, "commit_id": "531628aad0265b5c9458a7862770a22cb1428ce5", "user": {"following_url": "https://api.github.com/users/gijsk/following{/other_user}", "events_url": "https://api.github.com/users/gijsk/events{/privacy}", "organizations_url": "https://api.github.com/users/gijsk/orgs", "url": "https://api.github.com/users/gijsk", "gists_url": "https://api.github.com/users/gijsk/gists{/gist_id}", "html_url": "https://github.com/gijsk", "subscriptions_url": "https://api.github.com/users/gijsk/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/375983?v=4", "repos_url": "https://api.github.com/users/gijsk/repos", "received_events_url": "https://api.github.com/users/gijsk/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/gijsk/starred{/owner}{/repo}", "site_admin": false, "login": "gijsk", "type": "User", "id": 375983, "followers_url": "https://api.github.com/users/gijsk/followers"}, "position": null, "path": "recipe-client-addon/lib/NormandyApi.jsm", "body_html": "<p>Sadfaces that there's no batch-set API here...</p>", "original_commit_id": "7c57fed8c06ab50e3516ff3911d90e36bfe32a0b", "id": 103117778}