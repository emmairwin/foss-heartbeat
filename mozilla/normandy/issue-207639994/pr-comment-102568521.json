{"original_position": 45, "diff_hunk": "@@ -0,0 +1,93 @@\n+#!/usr/bin/env python\n+import os\n+\n+import requests\n+from taskcluster import fromNow\n+from taskcluster.utils import stableSlugId, dumpJson\n+\n+tasks = [\n+    {\n+        'name': 'recipe-client-addon:test',\n+        'description': 'Test recipe-client-addon with gecko-dev',\n+        'command': 'normandy/recipe-client-addon/bin/tc/test.sh',\n+        'env': {\n+            'GECKO_DEV_URL': 'https://github.com/mozilla/gecko-dev',\n+        },\n+    },\n+    {\n+        'name': 'recipe-client-addon:make-xpi',\n+        'description': 'Build XPI for recipe-client-addon',\n+        'command': 'normandy/recipe-client-addon/bin/tc/make-xpi.sh',\n+        'dependencies': ['recipe-client-addon:test'],\n+    },\n+]\n+\n+\n+def main():\n+    _idMaker = stableSlugId()\n+\n+    def idMaker(name):\n+        return _idMaker(name).decode()\n+\n+    decisionTaskId = os.environ['TASK_ID']\n+\n+    with requests.Session() as session:\n+        for task in tasks:\n+            dependencies = [idMaker(name) for name in task.get('dependencies', [])]\n+            dependencies.append(decisionTaskId)\n+\n+            env = task.get('env', {})\n+            for key, val in os.environ.items():\n+                if key.startswith('GITHUB_'):\n+                    env.setdefault(key, val)\n+\n+            task_id = idMaker(task['name'])\n+            res = session.put(f'http://taskcluster/queue/v1/task/{task_id}', data=dumpJson({", "body_text": "I started by using the python taskcluster library, and after working through some issues related to using the local taskcluster proxy in taskcluster jobs, garndt suggested that I didn't really need to use the library. (specifically, changing the base server is undocumented in the python library).\nOverall, the library didn't give me much over just using requests directly, except a layer of obfuscation. I'm still using some useful things from it, like the JSON formatter and the ID generator. Overall I think this is a good balance.", "in_reply_to_id": 101852825, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/514", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/102568521", "created_at": "2017-02-22T20:49:07Z", "author_association": "MEMBER", "body": "I started by using the python taskcluster library, and after working through some issues related to using the local taskcluster proxy in taskcluster jobs, garndt suggested that I didn't really need to use the library. (specifically, changing the base server is undocumented in the python library).\r\n\r\nOverall, the library didn't give me much over just using requests directly, except a layer of obfuscation. I'm still using some useful things from it, like the JSON formatter and the ID generator. Overall I think this is a good balance.", "updated_at": "2017-02-22T22:33:32Z", "html_url": "https://github.com/mozilla/normandy/pull/514#discussion_r102568521", "pull_request_review_id": 23328579, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/102568521"}, "html": {"href": "https://github.com/mozilla/normandy/pull/514#discussion_r102568521"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/514"}}, "commit_id": "70c8f16f1f6dae1920dc0c69ba497c1a70db72f4", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": 47, "path": "ci/taskcluster/bin/decision.py", "body_html": "<p>I started by using the python taskcluster library, and after working through some issues related to using the local taskcluster proxy in taskcluster jobs, garndt suggested that I didn't really need to use the library. (specifically, changing the base server is undocumented in the python library).</p>\n<p>Overall, the library didn't give me much over just using requests directly, except a layer of obfuscation. I'm still using some useful things from it, like the JSON formatter and the ID generator. Overall I think this is a good balance.</p>", "original_commit_id": "9aebecda4af23261221c85a290520b002e45a649", "id": 102568521}