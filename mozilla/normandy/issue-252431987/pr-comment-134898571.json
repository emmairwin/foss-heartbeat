{"original_position": 29, "diff_hunk": "@@ -0,0 +1,54 @@\n+import json\n+import zipfile\n+\n+from rest_framework.fields import FileField\n+\n+\n+class ExtensionFileField(FileField):\n+    default_error_messages = {\n+        'not_a_zip': 'Extension file must be zip-formatted.',\n+        'not_signed': 'Extension file must be signed.',\n+        'no_id': 'Web extensions must have a manifest key \"applications.gecko.id\".',\n+        'bad_manifest': 'Web extension manifest is corrupt.',\n+    }\n+\n+    def to_internal_value(self, data):\n+        try:\n+            xpi_zip = zipfile.ZipFile(data)\n+        except zipfile.BadZipFile:\n+            self.fail('not_a_zip')\n+\n+        if self._is_webext(xpi_zip):\n+            self._has_webext_id(xpi_zip)\n+        self._is_signed(xpi_zip)\n+\n+        return super().to_internal_value(data)\n+\n+    def _is_webext(self, xpi_zip):\n+        files = xpi_zip.namelist()\n+        if 'manifest.json' not in files or 'bootstrap.json' in files:", "body_text": "Did you mean bootstrap.js? Should a test have caught this?", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/1001", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/134898571", "created_at": "2017-08-23T23:49:06Z", "author_association": "MEMBER", "body": "Did you mean `bootstrap.js`? Should a test have caught this?", "updated_at": "2017-08-30T22:20:27Z", "html_url": "https://github.com/mozilla/normandy/pull/1001#discussion_r134898571", "pull_request_review_id": 58246326, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/134898571"}, "html": {"href": "https://github.com/mozilla/normandy/pull/1001#discussion_r134898571"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/1001"}}, "commit_id": "32ac5594b8b055b5adfc17e1f2380416740d0be9", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "position": null, "path": "recipe-server/normandy/studies/api/v2/fields.py", "body_html": "<p>Did you mean <code>bootstrap.js</code>? Should a test have caught this?</p>", "original_commit_id": "f9a89abbfe2487d3db608f203540804d08127563", "id": 134898571}