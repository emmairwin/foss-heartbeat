{"original_position": 41, "diff_hunk": "@@ -49,8 +49,29 @@ this.NormandyApi = {\n     return this.apiCall(\"post\", endpoint, data);\n   },\n \n+  apiIndex() {\n+    if (!indexPromise) {\n+      indexPromise = this.get(prefs.getCharPref(\"api_url\")).then(res => res.json);\n+    }\n+    return indexPromise;\n+  },\n+\n+  makeApiUrl(endpoint) {\n+    let base = prefs.getCharPref(\"api_url\");\n+    // Remove trailing slash if present\n+    if (base.slice(-1) === \"/\") {\n+      base = base.slice(0, -1);\n+    }\n+    // Remove leading slash, if present\n+    if (endpoint[0] === \"/\") {\n+      endpoint = endpoint.slice(1);\n+    }\n+    return `${base}/${endpoint}`;\n+  },\n+\n   fetchRecipes: Task.async(function* (filters = {}) {\n-    const recipeResponse = yield this.get(\"recipe/signed/\", filters);\n+    const signedRecipeUrls = (yield this.apiIndex())[\"recipes-signed\"];\n+    const recipeResponse = yield this.get(signedRecipeUrls, filters, {enabled: true});", "body_text": "OK. For my second paragraph, I mostly meant that this line: https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-server/normandy/base/tests/test_api.py#L18 seems to use recipe-signed and this line: https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-client-addon/lib/NormandyApi.jsm#L73 seems to read out recipeS-signed (note extra s) for the key in a JSON structure. Now, I haven't checked the rest of the code in detail, so maybe I'm missing something and/or the recipeS-signed key (with lowercase s...) already exists pre-patch (... elsewhere?). But it looked odd, is all, esp. given there are no other hits for recipe-signed in the patch at all. :-)", "in_reply_to_id": 101016307, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/510", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/101272180", "created_at": "2017-02-15T13:07:34Z", "author_association": "CONTRIBUTOR", "body": "OK. For my second paragraph, I mostly meant that this line: https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-server/normandy/base/tests/test_api.py#L18 seems to use `recipe-signed` and this line: https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-client-addon/lib/NormandyApi.jsm#L73 seems to read out `recipeS-signed` (note extra s) for the key in a JSON structure. Now, I haven't checked the rest of the code in detail, so maybe I'm missing something and/or the `recipeS-signed` key (with lowercase s...) already exists pre-patch (... elsewhere?). But it looked odd, is all, esp. given there are no other hits for `recipe-signed` in the patch at all. :-)", "updated_at": "2017-02-23T22:37:10Z", "html_url": "https://github.com/mozilla/normandy/pull/510#discussion_r101272180", "pull_request_review_id": 21994086, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/101272180"}, "html": {"href": "https://github.com/mozilla/normandy/pull/510#discussion_r101272180"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/510"}}, "commit_id": "e83c63174a7ed48da636f574c05d9cbeb11abe04", "user": {"following_url": "https://api.github.com/users/gijsk/following{/other_user}", "events_url": "https://api.github.com/users/gijsk/events{/privacy}", "organizations_url": "https://api.github.com/users/gijsk/orgs", "url": "https://api.github.com/users/gijsk", "gists_url": "https://api.github.com/users/gijsk/gists{/gist_id}", "html_url": "https://github.com/gijsk", "subscriptions_url": "https://api.github.com/users/gijsk/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/375983?v=4", "repos_url": "https://api.github.com/users/gijsk/repos", "received_events_url": "https://api.github.com/users/gijsk/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/gijsk/starred{/owner}{/repo}", "site_admin": false, "login": "gijsk", "type": "User", "id": 375983, "followers_url": "https://api.github.com/users/gijsk/followers"}, "position": null, "path": "recipe-client-addon/lib/NormandyApi.jsm", "body_html": "<p>OK. For my second paragraph, I mostly meant that this line: <a href=\"https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-server/normandy/base/tests/test_api.py#L18\">https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-server/normandy/base/tests/test_api.py#L18</a> seems to use <code>recipe-signed</code> and this line: <a href=\"https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-client-addon/lib/NormandyApi.jsm#L73\">https://github.com/mythmon/normandy/blob/b3da82e51da205d0deea69eaa7024170eaba2e51/recipe-client-addon/lib/NormandyApi.jsm#L73</a> seems to read out <code>recipeS-signed</code> (note extra s) for the key in a JSON structure. Now, I haven't checked the rest of the code in detail, so maybe I'm missing something and/or the <code>recipeS-signed</code> key (with lowercase s...) already exists pre-patch (... elsewhere?). But it looked odd, is all, esp. given there are no other hits for <code>recipe-signed</code> in the patch at all. :-)</p>", "original_commit_id": "b3da82e51da205d0deea69eaa7024170eaba2e51", "id": 101272180}