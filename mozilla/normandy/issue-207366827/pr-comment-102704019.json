{"original_position": 22, "diff_hunk": "@@ -0,0 +1,90 @@\n+\"use strict\";\n+// Cu is defined in xpc_head.js\n+/* globals Cu */\n+\n+Cu.import(\"resource://gre/modules/Services.jsm\");\n+Cu.import(\"resource://gre/modules/Task.jsm\");\n+Cu.import(\"resource://testing-common/httpd.js\"); /* globals HttpServer */\n+Cu.import(\"resource://gre/modules/osfile.jsm\", this); /* globals OS, TextDecoder */\n+Cu.import(\"resource://shield-recipe-client/lib/NormandyApi.jsm\", this);\n+\n+function withServer(task) {\n+  return function* inner() {\n+    const server = makeMockApiServer();\n+    const serverUrl = `http://localhost:${server.identity.primaryPort}`;\n+    Services.prefs.setCharPref(\"extensions.shield-recipe-client.api_url\", `${serverUrl}/api/v1`);\n+    Services.prefs.setCharPref(\n+      \"security.content.signature.root_hash\",\n+      // Hash of the key that signs the normandy dev certificates\n+      \"4C:35:B1:C3:E3:12:D9:55:E7:78:ED:D0:A7:E7:8A:38:83:04:EF:01:BF:FA:03:29:B2:46:9F:3C:C5:EC:36:04\"\n+    );\n+    yield task(serverUrl);\n+    yield new Promise(resolve => server.stop(resolve));", "body_text": "Should we clear the prefs in a cleanup function?", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/510", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/102704019", "created_at": "2017-02-23T12:41:48Z", "author_association": "CONTRIBUTOR", "body": "Should we clear the prefs in a cleanup function?", "updated_at": "2017-02-23T22:37:10Z", "html_url": "https://github.com/mozilla/normandy/pull/510#discussion_r102704019", "pull_request_review_id": 23466575, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/102704019"}, "html": {"href": "https://github.com/mozilla/normandy/pull/510#discussion_r102704019"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/510"}}, "commit_id": "e83c63174a7ed48da636f574c05d9cbeb11abe04", "user": {"following_url": "https://api.github.com/users/gijsk/following{/other_user}", "events_url": "https://api.github.com/users/gijsk/events{/privacy}", "organizations_url": "https://api.github.com/users/gijsk/orgs", "url": "https://api.github.com/users/gijsk", "gists_url": "https://api.github.com/users/gijsk/gists{/gist_id}", "html_url": "https://github.com/gijsk", "subscriptions_url": "https://api.github.com/users/gijsk/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/375983?v=4", "repos_url": "https://api.github.com/users/gijsk/repos", "received_events_url": "https://api.github.com/users/gijsk/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/gijsk/starred{/owner}{/repo}", "site_admin": false, "login": "gijsk", "type": "User", "id": 375983, "followers_url": "https://api.github.com/users/gijsk/followers"}, "position": null, "path": "recipe-client-addon/test/unit/test_NormandyApi.js", "body_html": "<p>Should we clear the prefs in a cleanup function?</p>", "original_commit_id": "ea2c4ccc9c8d3e6c603edf5ece7bdb9608723090", "id": 102704019}