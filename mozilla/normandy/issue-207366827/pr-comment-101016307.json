{"original_position": 41, "diff_hunk": "@@ -49,8 +49,29 @@ this.NormandyApi = {\n     return this.apiCall(\"post\", endpoint, data);\n   },\n \n+  apiIndex() {\n+    if (!indexPromise) {\n+      indexPromise = this.get(prefs.getCharPref(\"api_url\")).then(res => res.json);\n+    }\n+    return indexPromise;\n+  },\n+\n+  makeApiUrl(endpoint) {\n+    let base = prefs.getCharPref(\"api_url\");\n+    // Remove trailing slash if present\n+    if (base.slice(-1) === \"/\") {\n+      base = base.slice(0, -1);\n+    }\n+    // Remove leading slash, if present\n+    if (endpoint[0] === \"/\") {\n+      endpoint = endpoint.slice(1);\n+    }\n+    return `${base}/${endpoint}`;\n+  },\n+\n   fetchRecipes: Task.async(function* (filters = {}) {\n-    const recipeResponse = yield this.get(\"recipe/signed/\", filters);\n+    const signedRecipeUrls = (yield this.apiIndex())[\"recipes-signed\"];\n+    const recipeResponse = yield this.get(signedRecipeUrls, filters, {enabled: true});", "body_text": "I'm a bit confused why 'signedRecipeUrls' implies it contains multiple URLs. get only allows you to fetch 1 at a time.\nAlso note that your test server returns something for recipe-signed but not recipes-signed, from a quick look, so can you clarify the desired naming here, and what exactly this is supposed to do?", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/510", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/101016307", "created_at": "2017-02-14T11:40:10Z", "author_association": "CONTRIBUTOR", "body": "I'm a bit confused why 'signedRecipeUrls' implies it contains multiple URLs. `get` only allows you to fetch 1 at a time. \r\n\r\nAlso note that your test server returns something for `recipe-signed` but not `recipes-signed`, from a quick look, so can you clarify the desired naming here, and what exactly this is supposed to do?", "updated_at": "2017-02-23T22:37:10Z", "html_url": "https://github.com/mozilla/normandy/pull/510#discussion_r101016307", "pull_request_review_id": 21733078, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/101016307"}, "html": {"href": "https://github.com/mozilla/normandy/pull/510#discussion_r101016307"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/510"}}, "commit_id": "e83c63174a7ed48da636f574c05d9cbeb11abe04", "user": {"following_url": "https://api.github.com/users/gijsk/following{/other_user}", "events_url": "https://api.github.com/users/gijsk/events{/privacy}", "organizations_url": "https://api.github.com/users/gijsk/orgs", "url": "https://api.github.com/users/gijsk", "gists_url": "https://api.github.com/users/gijsk/gists{/gist_id}", "html_url": "https://github.com/gijsk", "subscriptions_url": "https://api.github.com/users/gijsk/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/375983?v=4", "repos_url": "https://api.github.com/users/gijsk/repos", "received_events_url": "https://api.github.com/users/gijsk/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/gijsk/starred{/owner}{/repo}", "site_admin": false, "login": "gijsk", "type": "User", "id": 375983, "followers_url": "https://api.github.com/users/gijsk/followers"}, "position": null, "path": "recipe-client-addon/lib/NormandyApi.jsm", "body_html": "<p>I'm a bit confused why 'signedRecipeUrls' implies it contains multiple URLs. <code>get</code> only allows you to fetch 1 at a time.</p>\n<p>Also note that your test server returns something for <code>recipe-signed</code> but not <code>recipes-signed</code>, from a quick look, so can you clarify the desired naming here, and what exactly this is supposed to do?</p>", "original_commit_id": "b3da82e51da205d0deea69eaa7024170eaba2e51", "id": 101016307}