{"original_position": 41, "diff_hunk": "@@ -49,8 +49,29 @@ this.NormandyApi = {\n     return this.apiCall(\"post\", endpoint, data);\n   },\n \n+  apiIndex() {\n+    if (!indexPromise) {\n+      indexPromise = this.get(prefs.getCharPref(\"api_url\")).then(res => res.json);\n+    }\n+    return indexPromise;\n+  },\n+\n+  makeApiUrl(endpoint) {\n+    let base = prefs.getCharPref(\"api_url\");\n+    // Remove trailing slash if present\n+    if (base.slice(-1) === \"/\") {\n+      base = base.slice(0, -1);\n+    }\n+    // Remove leading slash, if present\n+    if (endpoint[0] === \"/\") {\n+      endpoint = endpoint.slice(1);\n+    }\n+    return `${base}/${endpoint}`;\n+  },\n+\n   fetchRecipes: Task.async(function* (filters = {}) {\n-    const recipeResponse = yield this.get(\"recipe/signed/\", filters);\n+    const signedRecipeUrls = (yield this.apiIndex())[\"recipes-signed\"];\n+    const recipeResponse = yield this.get(signedRecipeUrls, filters, {enabled: true});", "body_text": "The API endpoint /recipe/ is the listing page for all objects of type recipe. recipe/$id/ would  be an individual recipe. recipe/signed is a specialization of the listing view that also lists many recipes, and includes signatures.\nThe singular form of this would include an id or a slug specifying an individual object.\nThat being said, these names aren't right. It should be signedRecipesUrl and recipesResponse, most likely. I'll fix that.", "in_reply_to_id": 101016307, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/510", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/101129077", "created_at": "2017-02-14T20:00:41Z", "author_association": "MEMBER", "body": "The API endpoint `/recipe/` is the listing page for all objects of type `recipe`. `recipe/$id/` would  be an individual recipe. `recipe/signed` is a specialization of the listing view that also lists many recipes, and includes signatures.\r\n\r\nThe singular form of this would include an id or a slug specifying an individual object.\r\n\r\nThat being said, these names aren't right. It should be `signedRecipesUrl` and `recipesResponse`, most likely. I'll fix that.", "updated_at": "2017-02-23T22:37:10Z", "html_url": "https://github.com/mozilla/normandy/pull/510#discussion_r101129077", "pull_request_review_id": 21849706, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/101129077"}, "html": {"href": "https://github.com/mozilla/normandy/pull/510#discussion_r101129077"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/510"}}, "commit_id": "e83c63174a7ed48da636f574c05d9cbeb11abe04", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-client-addon/lib/NormandyApi.jsm", "body_html": "<p>The API endpoint <code>/recipe/</code> is the listing page for all objects of type <code>recipe</code>. <code>recipe/$id/</code> would  be an individual recipe. <code>recipe/signed</code> is a specialization of the listing view that also lists many recipes, and includes signatures.</p>\n<p>The singular form of this would include an id or a slug specifying an individual object.</p>\n<p>That being said, these names aren't right. It should be <code>signedRecipesUrl</code> and <code>recipesResponse</code>, most likely. I'll fix that.</p>", "original_commit_id": "b3da82e51da205d0deea69eaa7024170eaba2e51", "id": 101129077}