{"original_position": 109, "diff_hunk": "@@ -1,29 +1,103 @@\n-import { fromJS } from 'immutable';\n+import { List, Map, is } from 'immutable';\n \n import {\n-  EXTENSION_RECEIVE,\n+  SESSION_INFO_RECEIVE,\n+  SESSION_INFO_HISTORY_VIEW,\n } from 'control_new/state/action-types';\n-import extensionsReducer from 'control_new/state/app/extensions/reducers';\n+import sessionReducer from 'control_new/state/app/session/reducers';\n import {\n   INITIAL_STATE,\n-  ExtensionFactory,\n-} from 'control_new/tests/state/extensions';\n+} from 'control_new/tests/state/session';\n \n \n-describe('Extensions reducer', () => {\n-  const extension = ExtensionFactory.build();\n-\n+describe('Session reducer', () => {\n   it('should return initial state by default', () => {\n-    expect(extensionsReducer(undefined, { type: 'INITIAL' })).toEqual(INITIAL_STATE);\n+    expect(sessionReducer(undefined, { type: 'INITIAL' })).toEqual(INITIAL_STATE);\n+  });\n+\n+  it('should handle SESSION_INFO_RECEIVE', () => {\n+    expect(sessionReducer(undefined, {\n+      type: SESSION_INFO_RECEIVE,\n+      history: [1, 2, 3],\n+    })).toEqual({ history: new List([1, 2, 3]) });\n   });\n \n-  it('should handle EXTENSION_RECEIVE', () => {\n-    expect(extensionsReducer(undefined, {\n-      type: EXTENSION_RECEIVE,\n-      extension,\n-    })).toEqual({\n-      ...INITIAL_STATE,\n-      items: INITIAL_STATE.items.set(extension.id, fromJS(extension)),\n+  describe('SESSION_INFO_HISTORY_VIEW', () => {\n+    it('should add an item to the state history', () => {\n+      const url = 'mozilla.com';\n+      const caption = 'test';\n+      const fakeItem = new Map({ url, caption });\n+\n+      const result = sessionReducer(undefined, {\n+        type: SESSION_INFO_HISTORY_VIEW,\n+        item: fakeItem,\n+      });\n+\n+      expect(is(result.history, new List([fakeItem]))).toBe(true);\n+    });\n+\n+    it('should only have unique items in history', () => {\n+      const url = 'mozilla.com';\n+      const fakeItem = new Map({ url, caption: '1' });\n+      const fakeItem2 = new Map({ url, caption: '2' });\n+\n+      let result = sessionReducer(undefined, {\n+        type: SESSION_INFO_HISTORY_VIEW,\n+        item: fakeItem,\n+      });\n+\n+      expect(is(result.history, new List([fakeItem]))).toBe(true);\n+\n+      result = sessionReducer(result, {\n+        type: SESSION_INFO_HISTORY_VIEW,\n+        item: fakeItem,\n+      });\n+\n+      expect(is(result.history, new List([fakeItem]))).toBe(true);\n+\n+      result = sessionReducer(result, {\n+        type: SESSION_INFO_HISTORY_VIEW,\n+        item: fakeItem2,\n+      });\n+\n+      expect(is(result.history, new List([fakeItem2, fakeItem]))).toBe(true);\n+    });\n+\n+    it('should arrange order from latest to oldest', () => {\n+      const url = 'mozilla.com';\n+      const fakeItem = new Map({ url, caption: '1' });\n+      const fakeItem2 = new Map({ url, caption: '2' });\n+      const fakeItem3 = new Map({ url, caption: '3' });\n+\n+      let result = sessionReducer(undefined, {\n+        type: SESSION_INFO_HISTORY_VIEW,\n+        item: fakeItem,\n+      });\n+\n+      expect(is(result.history, new List([fakeItem]))).toBe(true);\n+\n+      result = sessionReducer(result, {\n+        type: SESSION_INFO_HISTORY_VIEW,\n+        item: fakeItem2,\n+      });\n+\n+      expect(is(result.history, new List([fakeItem2, fakeItem]))).toBe(true);\n+\n+      result = sessionReducer(result, {\n+        type: SESSION_INFO_HISTORY_VIEW,\n+        item: fakeItem3,\n+      });\n+\n+      expect(is(result.history, new List([fakeItem3, fakeItem2, fakeItem]))).toBe(true);\n+\n+", "body_text": "Nit: Extra blank line", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/997", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/134886650", "created_at": "2017-08-23T22:24:55Z", "author_association": "MEMBER", "body": "Nit: Extra blank line", "updated_at": "2017-09-05T16:01:36Z", "html_url": "https://github.com/mozilla/normandy/pull/997#discussion_r134886650", "pull_request_review_id": 58231637, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/134886650"}, "html": {"href": "https://github.com/mozilla/normandy/pull/997#discussion_r134886650"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/997"}}, "commit_id": "83a6701f1dcf13a5c29ad36cfbea0754a5e7ecef", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/client/control_new/tests/state/extensions/test_reducers.js", "body_html": "<p>Nit: Extra blank line</p>", "original_commit_id": "e855da6d6a48d911cdd1125cb397eca6e1c096da", "id": 134886650}