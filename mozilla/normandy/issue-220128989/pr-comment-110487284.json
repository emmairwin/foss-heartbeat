{"original_position": 42, "diff_hunk": "@@ -75,6 +92,20 @@ CleanupManager.addCleanupHandler(() => PreferenceExperiments.stopAllObservers())\n \n this.PreferenceExperiments = {\n   /**\n+   * Set the default preference value for active experiments that use the\n+   * default preference branch.\n+   */\n+  async init() {\n+    const store = await ensureStorage();\n+    for (const experiment of Object.values(store.data)) {\n+      const {expired, preferenceBranchType, preferenceName, preferenceValue} = experiment;\n+      if (!expired && preferenceBranchType === \"default\") {", "body_text": "It's super edge case-y: If we're doing a user pref experiment (and the pref doesn't have a default value already), and the experiment ends, the default will retain the experimental value for the rest of the session. This check prevents setting the default when unnecessary. Although the reason I added it in the first place was more that it made sense only to set the pref when necessary, rather than because I thought that edge case mattered.\nI'm fine with removing it, although I don't see the harm in keeping it.", "in_reply_to_id": 110402953, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/670", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/110487284", "created_at": "2017-04-07T21:32:59Z", "author_association": "MEMBER", "body": "It's super edge case-y: If we're doing a user pref experiment (and the pref doesn't have a default value already), and the experiment ends, the default will retain the experimental value for the rest of the session. This check prevents setting the default when unnecessary. Although the reason I added it in the first place was more that it made sense only to set the pref when necessary, rather than because I thought that edge case mattered.\r\n\r\nI'm fine with removing it, although I don't see the harm in keeping it.", "updated_at": "2017-04-12T17:17:01Z", "html_url": "https://github.com/mozilla/normandy/pull/670#discussion_r110487284", "pull_request_review_id": 31669326, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/110487284"}, "html": {"href": "https://github.com/mozilla/normandy/pull/670#discussion_r110487284"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/670"}}, "commit_id": "05a53dac8b1bbcf2a57c097190c1c7e5644f5f28", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "position": null, "path": "recipe-client-addon/lib/PreferenceExperiments.jsm", "body_html": "<p>It's super edge case-y: If we're doing a user pref experiment (and the pref doesn't have a default value already), and the experiment ends, the default will retain the experimental value for the rest of the session. This check prevents setting the default when unnecessary. Although the reason I added it in the first place was more that it made sense only to set the pref when necessary, rather than because I thought that edge case mattered.</p>\n<p>I'm fine with removing it, although I don't see the harm in keeping it.</p>", "original_commit_id": "98de402df6a46aef592a090407dae2cf4c6afe78", "id": 110487284}