{"body_text": "See bug 1379627.\n\nWhen a preference experiment starts, store the filter expression used to evaluate it.\nModify the client information we fetch during recipe runs (geolocation and current time) to be cached between runs/\nOn startup, before we modify preferences, re-evaluate the filter expression to ensure that it is still valid. If it is not, disable the experiment. If the filters use geolocation or current time, use the cached versions.\n\nDepending on when we do this, we should consider doing this for all experiments, not just preference experiments.", "labels": [{"url": "https://api.github.com/repos/mozilla/normandy/labels/P5", "color": "ffa32c", "default": false, "id": 821572175, "name": "P5"}, {"url": "https://api.github.com/repos/mozilla/normandy/labels/improvement", "color": "0e8a16", "default": false, "id": 821632615, "name": "improvement"}], "number": 881, "assignee": null, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2018-02-05T22:29:15Z", "body_html": "<p>See <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1379627\" rel=\"nofollow\">bug 1379627</a>.</p>\n<ul>\n<li>When a preference experiment starts, store the filter expression used to evaluate it.</li>\n<li>Modify the client information we fetch during recipe runs (geolocation and current time) to be cached between runs/</li>\n<li>On startup, before we modify preferences, re-evaluate the filter expression to ensure that it is still valid. If it is not, disable the experiment. If the filters use geolocation or current time, use the cached versions.</li>\n</ul>\n<p>Depending on when we do this, we should consider doing this for all experiments, not just preference experiments.</p>", "id": 242191541, "title": "Re-evaluate filter expressions before making preference changes on startup", "comments": 1, "state": "closed", "body": "See [bug 1379627](https://bugzilla.mozilla.org/show_bug.cgi?id=1379627).\r\n\r\n- When a preference experiment starts, store the filter expression used to evaluate it.\r\n- Modify the client information we fetch during recipe runs (geolocation and current time) to be cached between runs/\r\n- On startup, before we modify preferences, re-evaluate the filter expression to ensure that it is still valid. If it is not, disable the experiment. If the filters use geolocation or current time, use the cached versions.\r\n\r\nDepending on when we do this, we should consider doing this for all experiments, not just preference experiments.", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/881/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/881/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/881/comments", "html_url": "https://github.com/mozilla/normandy/issues/881", "updated_at": "2018-02-05T22:29:15Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/881", "created_at": "2017-07-11T21:37:45Z", "assignees": []}