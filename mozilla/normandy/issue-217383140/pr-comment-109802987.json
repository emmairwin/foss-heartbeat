{"original_position": 30, "diff_hunk": "@@ -4,26 +4,33 @@\n \n \"use strict\";\n \n-const {utils: Cu} = Components;\n+const {utils: Cu, classes: Cc, interfaces: Ci} = Components;\n Cu.import(\"resource://gre/modules/Services.jsm\");\n-Cu.import(\"resource://gre/modules/Timer.jsm\"); /* globals setTimeout */\n Cu.import(\"resource://shield-recipe-client/lib/LogManager.jsm\");\n Cu.import(\"resource://shield-recipe-client/lib/NormandyDriver.jsm\");\n Cu.import(\"resource://shield-recipe-client/lib/FilterExpressions.jsm\");\n Cu.import(\"resource://shield-recipe-client/lib/NormandyApi.jsm\");\n Cu.import(\"resource://shield-recipe-client/lib/SandboxManager.jsm\");\n Cu.import(\"resource://shield-recipe-client/lib/Storage.jsm\");\n Cu.import(\"resource://shield-recipe-client/lib/ClientEnvironment.jsm\");\n+Cu.import(\"resource://shield-recipe-client/lib/CleanupManager.jsm\");\n Cu.import(\"resource://gre/modules/XPCOMUtils.jsm\");\n Cu.importGlobalProperties([\"fetch\"]); /* globals fetch */\n \n XPCOMUtils.defineLazyModuleGetter(this, \"Preferences\", \"resource://gre/modules/Preferences.jsm\");\n-XPCOMUtils.defineLazyModuleGetter(this, \"Storage\", \"resource://shield-recipe-client/lib/Storage.jsm\");\n+XPCOMUtils.defineLazyModuleGetter(this, \"Storage\",\n+                                  \"resource://shield-recipe-client/lib/Storage.jsm\");\n+XPCOMUtils.defineLazyServiceGetter(this, \"timerManager\",\n+                                   \"@mozilla.org/updates/timer-manager;1\",\n+                                   \"nsIUpdateTimerManager\");\n \n this.EXPORTED_SYMBOLS = [\"RecipeRunner\"];\n \n+const PREF_BASE_NAME = \"extensions.shield-recipe-client.\";\n+const PREF_RUN_INTERVAL = PREF_BASE_NAME + \"run_interval_seconds\";", "body_text": "It's annoying that you have to do this - is it only used to add/remove the observer, since you can't set the default branch there?\nIf so you could instead add the observer using prefs.addObserver(), the args for that are https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPrefBranch#addObserver()\nFailing that I think a template literal would be more readable here, not really important though.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/641", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/109802987", "created_at": "2017-04-04T23:36:02Z", "author_association": "MEMBER", "body": "It's annoying that you have to do this - is it only used to add/remove the observer, since you can't set the default branch there?\r\n\r\nIf so you could instead add the observer using `prefs.addObserver()`, the args for that are https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPrefBranch#addObserver()\r\n\r\nFailing that I think a template literal would be more readable here, not really important though.", "updated_at": "2017-04-12T17:14:33Z", "html_url": "https://github.com/mozilla/normandy/pull/641#discussion_r109802987", "pull_request_review_id": 30928058, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/109802987"}, "html": {"href": "https://github.com/mozilla/normandy/pull/641#discussion_r109802987"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/641"}}, "commit_id": "03a7b3e238d9a956b4deb74246b94e438e3fb490", "user": {"following_url": "https://api.github.com/users/rhelmer/following{/other_user}", "events_url": "https://api.github.com/users/rhelmer/events{/privacy}", "organizations_url": "https://api.github.com/users/rhelmer/orgs", "url": "https://api.github.com/users/rhelmer", "gists_url": "https://api.github.com/users/rhelmer/gists{/gist_id}", "html_url": "https://github.com/rhelmer", "subscriptions_url": "https://api.github.com/users/rhelmer/subscriptions", "avatar_url": "https://avatars0.githubusercontent.com/u/61412?v=4", "repos_url": "https://api.github.com/users/rhelmer/repos", "received_events_url": "https://api.github.com/users/rhelmer/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/rhelmer/starred{/owner}{/repo}", "site_admin": false, "login": "rhelmer", "type": "User", "id": 61412, "followers_url": "https://api.github.com/users/rhelmer/followers"}, "position": null, "path": "recipe-client-addon/lib/RecipeRunner.jsm", "body_html": "<p>It's annoying that you have to do this - is it only used to add/remove the observer, since you can't set the default branch there?</p>\n<p>If so you could instead add the observer using <code>prefs.addObserver()</code>, the args for that are <a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPrefBranch#addObserver()\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIPrefBranch#addObserver()</a></p>\n<p>Failing that I think a template literal would be more readable here, not really important though.</p>", "original_commit_id": "f359d55b1cef344b577b92b67f5d326d83d4ca4c", "id": 109802987}