{"original_position": 30, "diff_hunk": "@@ -2,27 +2,44 @@ import uuid from 'node-uuid';\n \n import Mozilla from './uitour.js';\n \n+export const STORAGE_DURABILITY_KEY = '_storageDurability';\n+\n /**\n  * Storage class that uses window.localStorage as it's backing store.\n  */\n-class LocalStorage {\n+export class LocalStorage {\n   /**\n    * @param    {string} prefix Prefix to append to all incoming keys.\n    */\n   constructor(prefix) {\n     this.prefix = prefix;\n   }\n \n+  async isDurable() {\n+    const durabilityStatus = localStorage.getItem(STORAGE_DURABILITY_KEY);\n+    return (parseInt(durabilityStatus, 10) >= 2);\n+  }\n+\n   _makeKey(key) {\n     return `${this.prefix}-${key}`;\n   }\n \n   async getItem(key) {\n-    return localStorage.getItem(this._makeKey(key));\n+    const storageIsDurable = await this.isDurable();\n+    if (!storageIsDurable && !this.testing) {", "body_text": "I changed this to this.skipDurability, and made the driver pass it in based on the value of NormandyDriver::testing.", "in_reply_to_id": 86900793, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/313", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/87113841", "created_at": "2016-11-09T00:19:53Z", "author_association": "MEMBER", "body": "I changed this to `this.skipDurability`, and made the driver pass it in based on the value of `NormandyDriver::testing`.\n", "updated_at": "2016-11-09T00:35:26Z", "html_url": "https://github.com/mozilla/normandy/pull/313#discussion_r87113841", "pull_request_review_id": 7738985, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/87113841"}, "html": {"href": "https://github.com/mozilla/normandy/pull/313#discussion_r87113841"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/313"}}, "commit_id": "710bf7efa61187df4a4b9c69222967f3c14b6ed1", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "client/selfrepair/normandy_driver.js", "body_html": "<p>I changed this to <code>this.skipDurability</code>, and made the driver pass it in based on the value of <code>NormandyDriver::testing</code>.</p>", "original_commit_id": "3fce5a3816f9cf45adc0ebeba96fa40459d27a66", "id": 87113841}