{"original_position": 32, "diff_hunk": "@@ -17,9 +19,32 @@ Cu.importGlobalProperties([\"URL\"]); /* globals URL */\n \n this.EXPORTED_SYMBOLS = [\"Heartbeat\"];\n \n-const log = LogManager.getLogger(\"heartbeat\");\n const PREF_SURVEY_DURATION = \"browser.uitour.surveyDuration\";\n const NOTIFICATION_TIME = 3000;\n+const HEARTBEAT_CSS_URI = Services.io.newURI(\"resource://shield-recipe-client/skin/shared/Heartbeat.css\");\n+const HEARTBEAT_CSS_URI_OSX = Services.io.newURI(\"resource://shield-recipe-client/skin/osx/Heartbeat.css\");\n+\n+const log = LogManager.getLogger(\"heartbeat\");\n+const windowsWithInjectedCss = new WeakSet();\n+let anyWindowsWithInjectedCss = false;\n+\n+// Add cleanup handler for CSS injected into windows by Heartbeat\n+CleanupManager.addCleanupHandler(() => {\n+  if (anyWindowsWithInjectedCss) {\n+    const windowEnumerator = Services.wm.getEnumerator(\"navigator:browser\");\n+    while (windowEnumerator.hasMoreElements()) {\n+      const window = windowEnumerator.getNext();", "body_text": "I think it is a pretty minor improvement. If we had to do this more than once I'd consider it, but for now I think it is better this way.", "in_reply_to_id": 118343246, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/770", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/118354236", "created_at": "2017-05-24T20:17:59Z", "author_association": "MEMBER", "body": "I think it is a pretty minor improvement. If we had to do this more than once I'd consider it, but for now I think it is better this way.", "updated_at": "2017-06-12T17:33:37Z", "html_url": "https://github.com/mozilla/normandy/pull/770#discussion_r118354236", "pull_request_review_id": 40138958, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/118354236"}, "html": {"href": "https://github.com/mozilla/normandy/pull/770#discussion_r118354236"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/770"}}, "commit_id": "9e4f925414de43a057dc69bd308e1cdb3f796099", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": 32, "path": "recipe-client-addon/lib/Heartbeat.jsm", "body_html": "<p>I think it is a pretty minor improvement. If we had to do this more than once I'd consider it, but for now I think it is better this way.</p>", "original_commit_id": "aaba98f216e10008ab81caba1f4d920b5ab2ed17", "id": 118354236}