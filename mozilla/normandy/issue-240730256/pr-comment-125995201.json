{"original_position": 42, "diff_hunk": "@@ -0,0 +1,83 @@\n+/* This Source Code Form is subject to the terms of the Mozilla Public\n+ * License, v. 2.0. If a copy of the MPL was not distributed with this\n+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n+\n+\"use strict\";\n+\n+const {utils: Cu} = Components;\n+Cu.import(\"resource://gre/modules/XPCOMUtils.jsm\");\n+XPCOMUtils.defineLazyModuleGetter(this, \"IndexedDB\", \"resource://gre/modules/IndexedDB.jsm\");\n+\n+this.EXPORTED_SYMBOLS = [\"StudyStorage\"];\n+\n+const DB_OPTIONS = {\n+  namespace: \"shield-study-addons\",\n+  version: 1,\n+  storage: \"persistent\",\n+  schema: {\n+    name: { autoIncrement: false, unique: false },\n+    version: { autoIncrement: false, unique: false },\n+    description: { autoIncrement: false, unique: false },\n+    installDate: { autoIncrement: false, unique: false },\n+    studyEndDate: { autoIncrement: false, unique: false },\n+    addonId: { autoIncrement: false, unique: true },\n+    active: { autoIncrement: false, unique: false },\n+  },\n+};\n+\n+this.StudyStorage = {\n+  dbName: \"shield-studies\",\n+\n+  async reset(clearData) {\n+    if (this.database) {\n+      if (clearData) {\n+        await this.database.objectStore(this.dbName, \"readwrite\").clear();\n+      }\n+\n+      await this.database.close();\n+      this.database = null;\n+    }\n+  },\n+\n+  async getDatabase() {", "body_text": "How should we handle testing this function? We have a couple of tests that test getDatabase and check against StudyStorage.database. Should those be exported as their own object, something like StudyStorageInternals so they can be imported into the test suite, but still 'hidden' from the end devs?", "in_reply_to_id": 125742200, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/860", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/125995201", "created_at": "2017-07-06T19:33:39Z", "author_association": "CONTRIBUTOR", "body": "How should we handle testing this function? We have a couple of tests that test `getDatabase` and check against `StudyStorage.database`. Should those be exported as their own object, something like `StudyStorageInternals` so they can be imported into the test suite, but still 'hidden' from the end devs?", "updated_at": "2017-07-11T21:12:35Z", "html_url": "https://github.com/mozilla/normandy/pull/860#discussion_r125995201", "pull_request_review_id": 48440410, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/125995201"}, "html": {"href": "https://github.com/mozilla/normandy/pull/860#discussion_r125995201"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/860"}}, "commit_id": "f1440ec998aab5190ee6b3c661e89c7c45e49821", "user": {"following_url": "https://api.github.com/users/andymikulski/following{/other_user}", "events_url": "https://api.github.com/users/andymikulski/events{/privacy}", "organizations_url": "https://api.github.com/users/andymikulski/orgs", "url": "https://api.github.com/users/andymikulski", "gists_url": "https://api.github.com/users/andymikulski/gists{/gist_id}", "html_url": "https://github.com/andymikulski", "subscriptions_url": "https://api.github.com/users/andymikulski/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/2767162?v=4", "repos_url": "https://api.github.com/users/andymikulski/repos", "received_events_url": "https://api.github.com/users/andymikulski/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/andymikulski/starred{/owner}{/repo}", "site_admin": false, "login": "andymikulski", "type": "User", "id": 2767162, "followers_url": "https://api.github.com/users/andymikulski/followers"}, "position": null, "path": "recipe-client-addon/lib/StudyStorage.jsm", "body_html": "<p>How should we handle testing this function? We have a couple of tests that test <code>getDatabase</code> and check against <code>StudyStorage.database</code>. Should those be exported as their own object, something like <code>StudyStorageInternals</code> so they can be imported into the test suite, but still 'hidden' from the end devs?</p>", "original_commit_id": "f47651e23fb3c1decd5d86a4354e489dec32d446", "id": 125995201}