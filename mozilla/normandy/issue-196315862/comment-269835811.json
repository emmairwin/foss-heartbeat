{"body": "So here's where I'm at: https://github.com/Osmose/normandy-mock-server\r\n\r\nThe code's more or less ready in terms of being able to generate and upload the correct files to AWS. What I'm stuck on is making it work outside of my own computer, and specifically on CircleCI. Right now my main problem is that I can't find a way to extend normandy-compose's docker-compose config, because:\r\n\r\n1. If I combine the files using `-f` when running `docker-compose`, all the paths in the combined file will be relative to the \"base\" file. I _could_ get around this if I include this in the monorepo and just have the relative volume in the mock-server's config be something like `../mock-server` instead of `.`, which is fine, but sucks.\r\n2. If I try to [extend](https://docs.docker.com/compose/compose-file/#/extends) the `normandy` service, it fails because it has links defined. I could factor out the config to a base file in the normandy-compose repo, and have both the normandy-compose config and the mock-server config extend from that. Alternatively, I could just maintain two similar configs.\r\n\r\nAnother problem is where the upload to S3 should happen. Currently, I have a script that runs inside the `testgen` container that uploads to S3, but it seems like it'd be better to upload as part of Circle's deploy step, outside the container. The question then becomes: How do I generate the files in the container, and get them back out? Do we just drop them in the root of the mock-repo folder, which is a mounted volume, and pull them from there?\r\n\r\n@mythmon @rehandalal @andymikulski Any feedback on the questions and potential solutions above would be appreciated.", "body_text": "So here's where I'm at: https://github.com/Osmose/normandy-mock-server\nThe code's more or less ready in terms of being able to generate and upload the correct files to AWS. What I'm stuck on is making it work outside of my own computer, and specifically on CircleCI. Right now my main problem is that I can't find a way to extend normandy-compose's docker-compose config, because:\n\nIf I combine the files using -f when running docker-compose, all the paths in the combined file will be relative to the \"base\" file. I could get around this if I include this in the monorepo and just have the relative volume in the mock-server's config be something like ../mock-server instead of ., which is fine, but sucks.\nIf I try to extend the normandy service, it fails because it has links defined. I could factor out the config to a base file in the normandy-compose repo, and have both the normandy-compose config and the mock-server config extend from that. Alternatively, I could just maintain two similar configs.\n\nAnother problem is where the upload to S3 should happen. Currently, I have a script that runs inside the testgen container that uploads to S3, but it seems like it'd be better to upload as part of Circle's deploy step, outside the container. The question then becomes: How do I generate the files in the container, and get them back out? Do we just drop them in the root of the mock-repo folder, which is a mounted volume, and pull them from there?\n@mythmon @rehandalal @andymikulski Any feedback on the questions and potential solutions above would be appreciated.", "url": "https://api.github.com/repos/mozilla/normandy/issues/comments/269835811", "created_at": "2016-12-30T23:46:41Z", "author_association": "MEMBER", "html_url": "https://github.com/mozilla/normandy/issues/392#issuecomment-269835811", "updated_at": "2016-12-30T23:46:41Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "body_html": "<p>So here's where I'm at: <a href=\"https://github.com/Osmose/normandy-mock-server\">https://github.com/Osmose/normandy-mock-server</a></p>\n<p>The code's more or less ready in terms of being able to generate and upload the correct files to AWS. What I'm stuck on is making it work outside of my own computer, and specifically on CircleCI. Right now my main problem is that I can't find a way to extend normandy-compose's docker-compose config, because:</p>\n<ol>\n<li>If I combine the files using <code>-f</code> when running <code>docker-compose</code>, all the paths in the combined file will be relative to the \"base\" file. I <em>could</em> get around this if I include this in the monorepo and just have the relative volume in the mock-server's config be something like <code>../mock-server</code> instead of <code>.</code>, which is fine, but sucks.</li>\n<li>If I try to <a href=\"https://docs.docker.com/compose/compose-file/#/extends\" rel=\"nofollow\">extend</a> the <code>normandy</code> service, it fails because it has links defined. I could factor out the config to a base file in the normandy-compose repo, and have both the normandy-compose config and the mock-server config extend from that. Alternatively, I could just maintain two similar configs.</li>\n</ol>\n<p>Another problem is where the upload to S3 should happen. Currently, I have a script that runs inside the <code>testgen</code> container that uploads to S3, but it seems like it'd be better to upload as part of Circle's deploy step, outside the container. The question then becomes: How do I generate the files in the container, and get them back out? Do we just drop them in the root of the mock-repo folder, which is a mounted volume, and pull them from there?</p>\n<p><a class=\"user-mention\" href=\"https://github.com/mythmon\">@mythmon</a> <a class=\"user-mention\" href=\"https://github.com/rehandalal\">@rehandalal</a> <a class=\"user-mention\" href=\"https://github.com/andymikulski\">@andymikulski</a> Any feedback on the questions and potential solutions above would be appreciated.</p>", "id": 269835811, "issue_url": "https://api.github.com/repos/mozilla/normandy/issues/392"}