{"body_text": "When run with the generic ./mach test command, the xpcshell tests fail:\n$ ./bin/update-mozilla-central.sh ~/Projects/mozilla-unified && ( workon mozilla-unified && ./mach test browser/extensions/shield-recipe-client/test/unit )\nBuild configuration changed. Regenerating backend.\n 0:00.28 LOG: MainThread WARNING MOZ_NODE_PATH environment variable not set. Tests requiring http/2 will fail.\nError running mach:\n\n    ['test', 'browser/extensions/shield-recipe-client/test/unit']\n\nThe error occurred in code that was called by the mach command. This is either\na bug in the called code itself or in the way that mach is calling it.\n\nYou should consider filing a bug for this issue.\n\nIf filing a bug, please include the full output of mach, including this error\nmessage.\n\nThe details of the failure are as follows:\n\nAttributeError: 'NoneType' object has no attribute 'startswith'\n\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/mach_commands.py\", line 343, in test\n    test_objects=tests, **kwargs)\n  File \"/Users/mkelly/Projects/mozilla-unified/python/mach/mach/registrar.py\", line 123, in dispatch\n    return self._run_command_handler(handler, context=context, **kwargs)\n  File \"/Users/mkelly/Projects/mozilla-unified/python/mach/mach/registrar.py\", line 90, in _run_command_handler\n    result = fn(**kwargs)\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 269, in run_xpcshell_test\n    return xpcshell.run_test(**params)\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 61, in run_test\n    return self.run_suite(**kwargs)\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 47, in run_suite\n    return self._run_xpcshell_harness(**kwargs)\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 137, in _run_xpcshell_harness\n    result = xpcshell.runTests(**filtered_args)\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py\", line 1274, in runTests\n    self.buildTestList(test_tags, testPaths)\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py\", line 874, in buildTestList\n    self.alltests = map(normalize, mp.active_tests(filters=filters, **mozinfo.info))\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py\", line 837, in normalizeTest\n    test_object['manifest'] = os.path.relpath(test_object['manifest'], root)\n  File \"/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py\", line 430, in relpath\n    start_list = [x for x in abspath(start).split(sep) if x]\n  File \"/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py\", line 360, in abspath\n    if not isabs(path):\n  File \"/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py\", line 54, in isabs\n    return s.startswith('/')\nIf you try to run them with ./mach xpcshell-test, they run and pass without an issue.", "labels": [], "number": 824, "assignee": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2017-06-22T22:08:11Z", "body_html": "<p>When run with the generic <code>./mach test</code> command, the xpcshell tests fail:</p>\n<div class=\"highlight highlight-source-shell\"><pre>$ ./bin/update-mozilla-central.sh <span class=\"pl-k\">~</span>/Projects/mozilla-unified <span class=\"pl-k\">&amp;&amp;</span> ( workon mozilla-unified <span class=\"pl-k\">&amp;&amp;</span> ./mach <span class=\"pl-c1\">test</span> browser/extensions/shield-recipe-client/test/unit )\nBuild configuration changed. Regenerating backend.\n 0:00.28 LOG: MainThread WARNING MOZ_NODE_PATH environment variable not set. Tests requiring http/2 will fail.\nError running mach:\n\n    [<span class=\"pl-s\"><span class=\"pl-pds\">'</span>test<span class=\"pl-pds\">'</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>browser/extensions/shield-recipe-client/test/unit<span class=\"pl-pds\">'</span></span>]\n\nThe error occurred <span class=\"pl-k\">in</span> code that was called by the mach command. This is either\na bug <span class=\"pl-k\">in</span> the called code itself or <span class=\"pl-k\">in</span> the way that mach is calling it.\n\nYou should consider filing a bug <span class=\"pl-k\">for</span> this issue.\n\nIf filing a bug, please include the full output of mach, including this error\nmessage.\n\nThe details of the failure are as follows:\n\nAttributeError: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>NoneType<span class=\"pl-pds\">'</span></span> object has no attribute <span class=\"pl-s\"><span class=\"pl-pds\">'</span>startswith<span class=\"pl-pds\">'</span></span>\n\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/mach_commands.py<span class=\"pl-pds\">\"</span></span>, line 343, <span class=\"pl-k\">in</span> <span class=\"pl-c1\">test</span>\n    test_objects=tests, <span class=\"pl-k\">**</span>kwargs)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/python/mach/mach/registrar.py<span class=\"pl-pds\">\"</span></span>, line 123, <span class=\"pl-k\">in</span> dispatch\n    <span class=\"pl-k\">return</span> self._run_command_handler(handler, context=context, <span class=\"pl-k\">**</span>kwargs)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/python/mach/mach/registrar.py<span class=\"pl-pds\">\"</span></span>, line 90, <span class=\"pl-k\">in</span> _run_command_handler\n    result = fn(<span class=\"pl-k\">**</span>kwargs)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py<span class=\"pl-pds\">\"</span></span>, line 269, <span class=\"pl-k\">in</span> run_xpcshell_test\n    <span class=\"pl-k\">return</span> xpcshell.run_test(<span class=\"pl-k\">**</span>params)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py<span class=\"pl-pds\">\"</span></span>, line 61, <span class=\"pl-k\">in</span> run_test\n    <span class=\"pl-k\">return</span> self.run_suite(<span class=\"pl-k\">**</span>kwargs)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py<span class=\"pl-pds\">\"</span></span>, line 47, <span class=\"pl-k\">in</span> run_suite\n    <span class=\"pl-k\">return</span> self._run_xpcshell_harness(<span class=\"pl-k\">**</span>kwargs)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py<span class=\"pl-pds\">\"</span></span>, line 137, <span class=\"pl-k\">in</span> _run_xpcshell_harness\n    result = xpcshell.runTests(<span class=\"pl-k\">**</span>filtered_args)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py<span class=\"pl-pds\">\"</span></span>, line 1274, <span class=\"pl-k\">in</span> runTests\n    self.buildTestList(test_tags, testPaths)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py<span class=\"pl-pds\">\"</span></span>, line 874, <span class=\"pl-k\">in</span> buildTestList\n    self.alltests = map(normalize, mp.active_tests(filters=filters, <span class=\"pl-k\">**</span>mozinfo.info))\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py<span class=\"pl-pds\">\"</span></span>, line 837, <span class=\"pl-k\">in</span> normalizeTest\n    test_object[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>manifest<span class=\"pl-pds\">'</span></span>] = os.path.relpath(test_object[<span class=\"pl-s\"><span class=\"pl-pds\">'</span>manifest<span class=\"pl-pds\">'</span></span>], root)\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py<span class=\"pl-pds\">\"</span></span>, line 430, <span class=\"pl-k\">in</span> relpath\n    start_list = [x <span class=\"pl-k\">for</span> <span class=\"pl-smi\">x</span> <span class=\"pl-k\">in</span> abspath(start).split(sep) <span class=\"pl-k\">if</span> x]\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py<span class=\"pl-pds\">\"</span></span>, line 360, <span class=\"pl-k\">in</span> abspath\n    <span class=\"pl-k\">if</span> not isabs(path):\n  File <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py<span class=\"pl-pds\">\"</span></span>, line 54, <span class=\"pl-k\">in</span> isabs\n    <span class=\"pl-k\">return</span> s.startswith(<span class=\"pl-s\"><span class=\"pl-pds\">'</span>/<span class=\"pl-pds\">'</span></span>)</pre></div>\n<p>If you try to run them with <code>./mach xpcshell-test</code>, they run and pass without an issue.</p>", "id": 237647232, "title": "./mach test on the xpcshell tests fails, but ./mach xpcshell-test doesn't", "comments": 1, "state": "closed", "body": "When run with the generic `./mach test` command, the xpcshell tests fail:\r\n\r\n```sh\r\n$ ./bin/update-mozilla-central.sh ~/Projects/mozilla-unified && ( workon mozilla-unified && ./mach test browser/extensions/shield-recipe-client/test/unit )\r\nBuild configuration changed. Regenerating backend.\r\n 0:00.28 LOG: MainThread WARNING MOZ_NODE_PATH environment variable not set. Tests requiring http/2 will fail.\r\nError running mach:\r\n\r\n    ['test', 'browser/extensions/shield-recipe-client/test/unit']\r\n\r\nThe error occurred in code that was called by the mach command. This is either\r\na bug in the called code itself or in the way that mach is calling it.\r\n\r\nYou should consider filing a bug for this issue.\r\n\r\nIf filing a bug, please include the full output of mach, including this error\r\nmessage.\r\n\r\nThe details of the failure are as follows:\r\n\r\nAttributeError: 'NoneType' object has no attribute 'startswith'\r\n\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/mach_commands.py\", line 343, in test\r\n    test_objects=tests, **kwargs)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/python/mach/mach/registrar.py\", line 123, in dispatch\r\n    return self._run_command_handler(handler, context=context, **kwargs)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/python/mach/mach/registrar.py\", line 90, in _run_command_handler\r\n    result = fn(**kwargs)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 269, in run_xpcshell_test\r\n    return xpcshell.run_test(**params)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 61, in run_test\r\n    return self.run_suite(**kwargs)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 47, in run_suite\r\n    return self._run_xpcshell_harness(**kwargs)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/mach_commands.py\", line 137, in _run_xpcshell_harness\r\n    result = xpcshell.runTests(**filtered_args)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py\", line 1274, in runTests\r\n    self.buildTestList(test_tags, testPaths)\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py\", line 874, in buildTestList\r\n    self.alltests = map(normalize, mp.active_tests(filters=filters, **mozinfo.info))\r\n  File \"/Users/mkelly/Projects/mozilla-unified/testing/xpcshell/runxpcshelltests.py\", line 837, in normalizeTest\r\n    test_object['manifest'] = os.path.relpath(test_object['manifest'], root)\r\n  File \"/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py\", line 430, in relpath\r\n    start_list = [x for x in abspath(start).split(sep) if x]\r\n  File \"/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py\", line 360, in abspath\r\n    if not isabs(path):\r\n  File \"/Users/mkelly/.virtualenvs/mozilla-unified/lib/python2.7/posixpath.py\", line 54, in isabs\r\n    return s.startswith('/')\r\n```\r\n\r\nIf you try to run them with `./mach xpcshell-test`, they run and pass without an issue.", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/824/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/824/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/824/comments", "html_url": "https://github.com/mozilla/normandy/issues/824", "updated_at": "2017-06-22T22:08:11Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/824", "created_at": "2017-06-21T19:57:45Z", "assignees": [{"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}]}