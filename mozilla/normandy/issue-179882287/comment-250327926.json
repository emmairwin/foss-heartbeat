{"body": "I've found the issue.\n\nIn Firefox 43.0.1 in my local tests, the request to `/api/v1/action/:id/` is made with the header `Accept: text/html`. In Firefox 52 (my local nightly), the request is made with the correct header `Accept: application/json`. It seems that the default content type for XHR changed between 43 and 52. When an `Accept: text/html` is sent, the server correctly responded with an HTML page containing the API response, instead of the JSON response the client expects.\n\nThis wasn't an issue until recently. Before we deployed v18 (on 9/26 at 16:06 PDT), we had Nginx forcing the Accept header to be `application/json` because of [bug 1293469](https://bugzilla.mozilla.org/show_bug.cgi?id=1293469). We ignored what the client sent, so Firefox's default behavior didn't matter.\n\nThe fix for this is pretty easy. We need to fix the api call to load action data to send the proper headers. That happens in [fetchAction](https://github.com/mozilla/normandy/blob/master/client/selfrepair/self_repair_runner.js#L42-L58), which does not set any extra headers on the request. For comparison, in [fetchRecipes](https://github.com/mozilla/normandy/blob/master/client/selfrepair/self_repair_runner.js#L75-L85), the header is correctly added.\n", "body_text": "I've found the issue.\nIn Firefox 43.0.1 in my local tests, the request to /api/v1/action/:id/ is made with the header Accept: text/html. In Firefox 52 (my local nightly), the request is made with the correct header Accept: application/json. It seems that the default content type for XHR changed between 43 and 52. When an Accept: text/html is sent, the server correctly responded with an HTML page containing the API response, instead of the JSON response the client expects.\nThis wasn't an issue until recently. Before we deployed v18 (on 9/26 at 16:06 PDT), we had Nginx forcing the Accept header to be application/json because of bug 1293469. We ignored what the client sent, so Firefox's default behavior didn't matter.\nThe fix for this is pretty easy. We need to fix the api call to load action data to send the proper headers. That happens in fetchAction, which does not set any extra headers on the request. For comparison, in fetchRecipes, the header is correctly added.", "url": "https://api.github.com/repos/mozilla/normandy/issues/comments/250327926", "created_at": "2016-09-28T23:10:19Z", "author_association": "MEMBER", "html_url": "https://github.com/mozilla/normandy/issues/277#issuecomment-250327926", "updated_at": "2016-09-28T23:32:22Z", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "body_html": "<p>I've found the issue.</p>\n<p>In Firefox 43.0.1 in my local tests, the request to <code>/api/v1/action/:id/</code> is made with the header <code>Accept: text/html</code>. In Firefox 52 (my local nightly), the request is made with the correct header <code>Accept: application/json</code>. It seems that the default content type for XHR changed between 43 and 52. When an <code>Accept: text/html</code> is sent, the server correctly responded with an HTML page containing the API response, instead of the JSON response the client expects.</p>\n<p>This wasn't an issue until recently. Before we deployed v18 (on 9/26 at 16:06 PDT), we had Nginx forcing the Accept header to be <code>application/json</code> because of <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=1293469\" rel=\"nofollow\">bug 1293469</a>. We ignored what the client sent, so Firefox's default behavior didn't matter.</p>\n<p>The fix for this is pretty easy. We need to fix the api call to load action data to send the proper headers. That happens in <a href=\"https://github.com/mozilla/normandy/blob/master/client/selfrepair/self_repair_runner.js#L42-L58\">fetchAction</a>, which does not set any extra headers on the request. For comparison, in <a href=\"https://github.com/mozilla/normandy/blob/master/client/selfrepair/self_repair_runner.js#L75-L85\">fetchRecipes</a>, the header is correctly added.</p>", "id": 250327926, "issue_url": "https://api.github.com/repos/mozilla/normandy/issues/277"}