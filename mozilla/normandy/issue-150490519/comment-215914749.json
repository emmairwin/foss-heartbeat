{"body": "Updated. I've split the change into two commits as suggested; one adds the `filter_expression` field, while the other one adds the rest of the functionality and removes the older filter fields.\n\nAfter thinking about it, I decided that I'm not a fan of treating empty as true on the server side, as it makes it difficult to detect when a user has forgotten to add a filter expression. So instead, I've made the migration default all existing recipes to have `true` as their filter expression, and set `blank=False` on the filter expression field. This way, existing recipes get a default value that isn't invalid, but new recipes will throw a validation error if the user forgets to add a filter expression.\n\nI also tweaked some things in the self-repair page:\n- The JEXL context had no way to access the user's locale. I included it in `normandy.client`.\n- As suggested, it now removes all newlines in a filter expression.\n", "body_text": "Updated. I've split the change into two commits as suggested; one adds the filter_expression field, while the other one adds the rest of the functionality and removes the older filter fields.\nAfter thinking about it, I decided that I'm not a fan of treating empty as true on the server side, as it makes it difficult to detect when a user has forgotten to add a filter expression. So instead, I've made the migration default all existing recipes to have true as their filter expression, and set blank=False on the filter expression field. This way, existing recipes get a default value that isn't invalid, but new recipes will throw a validation error if the user forgets to add a filter expression.\nI also tweaked some things in the self-repair page:\n\nThe JEXL context had no way to access the user's locale. I included it in normandy.client.\nAs suggested, it now removes all newlines in a filter expression.", "url": "https://api.github.com/repos/mozilla/normandy/issues/comments/215914749", "created_at": "2016-04-30T00:31:57Z", "author_association": "MEMBER", "html_url": "https://github.com/mozilla/normandy/pull/114#issuecomment-215914749", "updated_at": "2016-04-30T00:31:57Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "body_html": "<p>Updated. I've split the change into two commits as suggested; one adds the <code>filter_expression</code> field, while the other one adds the rest of the functionality and removes the older filter fields.</p>\n<p>After thinking about it, I decided that I'm not a fan of treating empty as true on the server side, as it makes it difficult to detect when a user has forgotten to add a filter expression. So instead, I've made the migration default all existing recipes to have <code>true</code> as their filter expression, and set <code>blank=False</code> on the filter expression field. This way, existing recipes get a default value that isn't invalid, but new recipes will throw a validation error if the user forgets to add a filter expression.</p>\n<p>I also tweaked some things in the self-repair page:</p>\n<ul>\n<li>The JEXL context had no way to access the user's locale. I included it in <code>normandy.client</code>.</li>\n<li>As suggested, it now removes all newlines in a filter expression.</li>\n</ul>", "id": 215914749, "issue_url": "https://api.github.com/repos/mozilla/normandy/issues/114"}