{"original_position": 17, "diff_hunk": "@@ -6,8 +6,34 @@ export default class ShieldStudyAction extends Action {\n     this.storage = normandy.createStorage(recipe.id);\n   }\n \n+  setHasBeenShown() {\n+    this.storage.setItem('studyHasBeenShown', true);\n+  }\n+\n+  async getHasBeenShown() {\n+    const hasBeenShown = await this.storage.getItem('studyHasBeenShown');\n+    return hasBeenShown;\n+  }\n+\n   async execute() {\n+    const storageIsDurable = await this.storage.isDurable();\n+\n+    if (!storageIsDurable && !this.normandy.testing) {\n+      throw new Error('Storage durability unconfirmed');", "body_text": "I think this logic should probably go in the driver, instead of the action. The driver can reject any calls to setItem and return null from any calls to getItem until durability has been verified. (or should getItem reject too?). I don't think we want to duplicate this logic in every action that uses storage.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/291", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/84152789", "created_at": "2016-10-19T19:52:08Z", "author_association": "MEMBER", "body": "I think this logic should probably go in the driver, instead of the action. The driver can reject any calls to `setItem` and return `null` from any calls to `getItem` until durability has been verified. (or should `getItem` reject too?). I don't think we want to duplicate this logic in every action that uses storage.\n", "updated_at": "2016-11-03T23:10:01Z", "html_url": "https://github.com/mozilla/normandy/pull/291#discussion_r84152789", "pull_request_review_id": 4947157, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/84152789"}, "html": {"href": "https://github.com/mozilla/normandy/pull/291#discussion_r84152789"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/291"}}, "commit_id": "f905b2547d3135fff8e4e9a69edcfae9c9892a91", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "client/actions/shield-study/index.js", "body_html": "<p>I think this logic should probably go in the driver, instead of the action. The driver can reject any calls to <code>setItem</code> and return <code>null</code> from any calls to <code>getItem</code> until durability has been verified. (or should <code>getItem</code> reject too?). I don't think we want to duplicate this logic in every action that uses storage.</p>", "original_commit_id": "1c04fda867875e5e03787678ff27f009b930e3aa", "id": 84152789}