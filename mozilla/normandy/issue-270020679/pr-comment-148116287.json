{"original_position": 30, "diff_hunk": "@@ -0,0 +1,45 @@\n+import { message } from 'antd';\n+\n+import APIClient from 'control/utils/api';\n+\n+\n+export const ERR_MESSAGES = {\n+  FORM_VALIDATION: 'Please correct the form items highlighted below.',\n+  NO_INTERNET: 'Check your internet connection and try again.',\n+  SERVER_FAILED: 'The server failed to respond. Please try again.',\n+};\n+\n+// String to search for to determine if a fetch failed. Unlikely to change.\n+const fetchFailureMessage = 'Failed to fetch';\n+\n+const defaultMethods = {\n+  checkUserOnline: () => navigator.onLine,\n+  notifyUser: errMsg => message.error(errMsg),\n+};\n+\n+export default function handleError(context = 'Error!', error, methodOverrides = {}) {\n+  const methods = { ...defaultMethods, ...methodOverrides };\n+  let errMsg = '';\n+\n+  if (error) {\n+    if (!methods.checkUserOnline()) {\n+      errMsg = ERR_MESSAGES.NO_INTERNET;\n+    } else if (error.message.indexOf(fetchFailureMessage) > -1) {\n+      errMsg = ERR_MESSAGES.SERVER_FAILED;\n+    } else if (error instanceof APIClient.APIError && error.data) {\n+      errMsg = ERR_MESSAGES.FORM_VALIDATION;", "body_text": "This isn't really accurate. You are pretty much ignoring the actual error from the server and assuming any time that the server responded with an error is a form validation error. I would like this to be much surer of itself before giving the form validation error message. It would be preferable to give uglier but more information dense answers instead of hiding details.\nAn example of this is a permission error. If you create a new user and don't give them any permissions, creating a recipe returns HTTP 403 and the body {\"detail\":\"You do not have permission to perform this action.\"}. Compare to a form validation error: HTTP 400 with the body {\"name\":[\"This field may not be blank.\"]}.\nI think checking HTTP status codes is a necessary part of error handling that we don't do. A smaller change would be at least exposing the detail field if it exists.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/1121", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/148116287", "created_at": "2017-10-31T20:21:53Z", "author_association": "MEMBER", "body": "This isn't really accurate. You are pretty much ignoring the actual error from the server and assuming any time that the server responded with an error is a form validation error. I would like this to be much surer of itself before giving the form validation error message. It would be preferable to give uglier but more information dense answers instead of hiding details.\r\n\r\nAn example of this is a permission error. If you create a new user and don't give them any permissions, creating a recipe returns HTTP 403 and the body `{\"detail\":\"You do not have permission to perform this action.\"}`. Compare to a form validation error: HTTP 400 with the body `{\"name\":[\"This field may not be blank.\"]}`. \r\n\r\nI think checking HTTP status codes is a necessary part of error handling that we don't do. A smaller change would be at least exposing the `detail` field if it exists.", "updated_at": "2017-11-15T14:54:27Z", "html_url": "https://github.com/mozilla/normandy/pull/1121#discussion_r148116287", "pull_request_review_id": 73251179, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/148116287"}, "html": {"href": "https://github.com/mozilla/normandy/pull/1121#discussion_r148116287"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/1121"}}, "commit_id": "8609b4ed0cb5a04f83a1a220e61d83c26534ce79", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/client/control/utils/handleError.js", "body_html": "<p>This isn't really accurate. You are pretty much ignoring the actual error from the server and assuming any time that the server responded with an error is a form validation error. I would like this to be much surer of itself before giving the form validation error message. It would be preferable to give uglier but more information dense answers instead of hiding details.</p>\n<p>An example of this is a permission error. If you create a new user and don't give them any permissions, creating a recipe returns HTTP 403 and the body <code>{\"detail\":\"You do not have permission to perform this action.\"}</code>. Compare to a form validation error: HTTP 400 with the body <code>{\"name\":[\"This field may not be blank.\"]}</code>.</p>\n<p>I think checking HTTP status codes is a necessary part of error handling that we don't do. A smaller change would be at least exposing the <code>detail</code> field if it exists.</p>", "original_commit_id": "613f558d9628344debe4fcc25a45d482f92a7ccc", "id": 148116287}