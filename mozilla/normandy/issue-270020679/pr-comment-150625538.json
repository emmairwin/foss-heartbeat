{"original_position": 39, "diff_hunk": "@@ -0,0 +1,84 @@\n+import { message as AntMessage } from 'antd';\n+\n+import APIClient from 'control/utils/api';\n+import { ValidationError } from 'control/utils/forms';\n+\n+\n+export const ERR_MESSAGES = {\n+  FORM_VALIDATION: 'Please correct the form items highlighted below.',\n+  NO_INTERNET: 'Check your internet connection and try again.',\n+  SERVER_FAILED: 'The server failed to respond. Please try again.',\n+  NOT_LOGGED_IN: 'No active user session found, try logging in again.',\n+  NO_PERMISSION: 'You do not have permission to perform that action.',\n+};\n+\n+// Search strings used to determine various types responses.\n+const checkFetchFailure = ({ message = '' }) =>\n+  message.indexOf('Failed to fetch') !== -1 || message.indexOf('NetworkError') !== -1;\n+\n+const checkLoginFailure = ({ message = '' }) => message.indexOf('credentials were not provided') > -1;\n+const checkAPIFailure = error => error instanceof APIClient.APIError;\n+const checkValidationFailure = error => error instanceof ValidationError;\n+\n+const msgDisplayTime = 8; // seconds\n+\n+const defaultMethods = {\n+  checkUserOnline: () => navigator.onLine,\n+  notifyUser: errMsg => AntMessage.error(errMsg, msgDisplayTime),\n+};\n+\n+const handleAPIError = error => {\n+  let message = '';\n+\n+  switch (error.data.status) {\n+    case 400: // Bad Request\n+      message = ERR_MESSAGES.FORM_VALIDATION;\n+      break;\n+\n+    case 403: // Forbidden\n+      message = checkLoginFailure(error) ? ERR_MESSAGES.NOT_LOGGED_IN : ERR_MESSAGES.NO_PERMISSION;", "body_text": "Technically 403 only applies to a user that is logged in but not authorized to perform an action, whereas 401 is for users that aren't logged in.\nWe don't do this correctly in dev environments, and server 403 in all situations, which isn't good. I imagine we might serve 401s in prod some times though. We should probably include case 401: here as well.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/1121", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/150625538", "created_at": "2017-11-13T18:32:45Z", "author_association": "MEMBER", "body": "Technically 403 only applies to a user that is logged in but not authorized to perform an action, whereas 401 is for users that aren't logged in.\r\n\r\nWe don't do this correctly in dev environments, and server 403 in all situations, which isn't good. I imagine we might serve 401s in prod some times though. We should probably include `case 401:` here as well. ", "updated_at": "2017-11-15T14:54:27Z", "html_url": "https://github.com/mozilla/normandy/pull/1121#discussion_r150625538", "pull_request_review_id": 76203391, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/150625538"}, "html": {"href": "https://github.com/mozilla/normandy/pull/1121#discussion_r150625538"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/1121"}}, "commit_id": "8609b4ed0cb5a04f83a1a220e61d83c26534ce79", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/client/control/utils/handleError.js", "body_html": "<p>Technically 403 only applies to a user that is logged in but not authorized to perform an action, whereas 401 is for users that aren't logged in.</p>\n<p>We don't do this correctly in dev environments, and server 403 in all situations, which isn't good. I imagine we might serve 401s in prod some times though. We should probably include <code>case 401:</code> here as well.</p>", "original_commit_id": "d60636323039b830af757dff52391f92041dfa6b", "id": 150625538}