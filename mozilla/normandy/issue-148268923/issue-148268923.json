{"body_text": "RevisionMiddleware automatically creates revisions when things\nchange. However, viewing the revert page in the admin interface\ntriggers a revert (in order to generate the preview data before\nactually reverting) within a transaction, and then rolls back the\ntransaction. But, as far as I can tell, django-reversion doesn't\nhandle transaction rollback and saves the revision from the revert\nanyway.\nRemoving the middleware fixes this, but we still have to manually\ntrigger revision creation outside the admin. This commit adds a\nViewSet mixin that triggers revision creation for DRF views.\n@mythmon r?", "labels": [], "number": 109, "assignee": null, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2016-04-14T21:21:10Z", "body_html": "<p>RevisionMiddleware automatically creates revisions when things<br>\nchange. However, viewing the revert page in the admin interface<br>\ntriggers a revert (in order to generate the preview data before<br>\nactually reverting) within a transaction, and then rolls back the<br>\ntransaction. But, as far as I can tell, django-reversion doesn't<br>\nhandle transaction rollback and saves the revision from the revert<br>\nanyway.</p>\n<p>Removing the middleware fixes this, but we still have to manually<br>\ntrigger revision creation outside the admin. This commit adds a<br>\nViewSet mixin that triggers revision creation for DRF views.</p>\n<p><a class=\"user-mention\" href=\"https://github.com/mythmon\">@mythmon</a> r?</p>", "id": 148268923, "title": "[fix bug 1262617] Replace RevisionMiddleware with decorators.", "pull_request": {"url": "https://api.github.com/repos/mozilla/normandy/pulls/109", "diff_url": "https://github.com/mozilla/normandy/pull/109.diff", "html_url": "https://github.com/mozilla/normandy/pull/109", "patch_url": "https://github.com/mozilla/normandy/pull/109.patch"}, "comments": 1, "state": "closed", "body": "RevisionMiddleware automatically creates revisions when things\nchange. However, viewing the revert page in the admin interface\ntriggers a revert (in order to generate the preview data before\nactually reverting) within a transaction, and then rolls back the\ntransaction. But, as far as I can tell, django-reversion doesn't\nhandle transaction rollback and saves the revision from the revert\nanyway.\n\nRemoving the middleware fixes this, but we still have to manually\ntrigger revision creation outside the admin. This commit adds a\nViewSet mixin that triggers revision creation for DRF views.\n\n@mythmon r?\n", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/109/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/109/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/109/comments", "html_url": "https://github.com/mozilla/normandy/pull/109", "updated_at": "2016-04-14T21:21:12Z", "user": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/109", "created_at": "2016-04-14T07:00:40Z", "assignees": []}