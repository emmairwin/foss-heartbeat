{"body_text": "We are now using OIDC authentication on stage, and soon on prod. This introduced an error in recipe previews, because when we fetched actions (and other things), we did not include credentials (cookies), which meant that those requests got redirected to the auth0.\nThe fix for this is easy: include credentials in fetch for those requests.\nThe verification is harder: I rigged up the compose nginx to fake OIDC login, by requiring HTTP basic auth, and passing that as a Remote-User header. Now whatever is put in the HTTP basic auth prompt will be the user you get logged in, including creating a new user.\nTo test this: use compose. With only the first commit, the error from stage is reproduced (preview doesn't work). With both commits, it is fixed.\n@relud can you r? the nginx changes here?", "labels": [], "number": 596, "assignee": {"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2017-03-08T02:16:48Z", "body_html": "<p>We are now using OIDC authentication on stage, and soon on prod. This introduced an error in recipe previews, because when we fetched actions (and other things), we did not include credentials (cookies), which meant that those requests got redirected to the auth0.</p>\n<p>The fix for this is easy: include credentials in fetch for those requests.</p>\n<p>The verification is harder: I rigged up the compose nginx to fake OIDC login, by requiring HTTP basic auth, and passing that as a <code>Remote-User</code> header. Now whatever is put in the HTTP basic auth prompt will be the user you get logged in, including creating a new user.</p>\n<p>To test this: use compose. With only the first commit, the error from stage is reproduced (preview doesn't work). With both commits, it is fixed.</p>\n<p><a class=\"user-mention\" href=\"https://github.com/relud\">@relud</a> can you r? the nginx changes here?</p>", "id": 212597523, "title": "Fix recipe preview by including credentials in self-repair fetch", "pull_request": {"url": "https://api.github.com/repos/mozilla/normandy/pulls/596", "diff_url": "https://github.com/mozilla/normandy/pull/596.diff", "html_url": "https://github.com/mozilla/normandy/pull/596", "patch_url": "https://github.com/mozilla/normandy/pull/596.patch"}, "comments": 1, "state": "closed", "body": "We are now using OIDC authentication on stage, and soon on prod. This introduced an error in recipe previews, because when we fetched actions (and other things), we did not include credentials (cookies), which meant that those requests got redirected to the auth0.\r\n\r\nThe fix for this is easy: include credentials in fetch for those requests.\r\n\r\nThe verification is harder: I rigged up the compose nginx to fake OIDC login, by requiring HTTP basic auth, and passing that as a `Remote-User` header. Now whatever is put in the HTTP basic auth prompt will be the user you get logged in, including creating a new user.\r\n\r\nTo test this: use compose. With only the first commit, the error from stage is reproduced (preview doesn't work). With both commits, it is fixed.\r\n\r\n@relud can you r? the nginx changes here?", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/596/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/596/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/596/comments", "html_url": "https://github.com/mozilla/normandy/pull/596", "updated_at": "2017-03-08T02:16:51Z", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/596", "created_at": "2017-03-08T00:00:51Z", "assignees": [{"following_url": "https://api.github.com/users/Osmose/following{/other_user}", "events_url": "https://api.github.com/users/Osmose/events{/privacy}", "organizations_url": "https://api.github.com/users/Osmose/orgs", "url": "https://api.github.com/users/Osmose", "gists_url": "https://api.github.com/users/Osmose/gists{/gist_id}", "html_url": "https://github.com/Osmose", "subscriptions_url": "https://api.github.com/users/Osmose/subscriptions", "avatar_url": "https://avatars1.githubusercontent.com/u/193106?v=4", "repos_url": "https://api.github.com/users/Osmose/repos", "received_events_url": "https://api.github.com/users/Osmose/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/Osmose/starred{/owner}{/repo}", "site_admin": false, "login": "Osmose", "type": "User", "id": 193106, "followers_url": "https://api.github.com/users/Osmose/followers"}]}