{"original_position": 16, "diff_hunk": "@@ -22,10 +23,8 @@ add_task(withDriver(Assert, async function installXpi(driver) {\n   is(addonId, \"normandydriver@example.com\", \"Expected test addon was installed\");\n   isnot(addonId, null, \"Addon install was successful\");\n \n-  // Installing kicks off an asychronous process which tries to read the manifest.json\n-  // to startup the addon. Note that onInstallEnded is triggered too early\n-  // which is why we need this delay.\n-  await new Promise(resolve => SimpleTest.executeSoon(resolve));\n+  // Wait until the add-on is fully started up to uninstall it.\n+  await AddonTestUtils.promiseWebExtensionStartup(\"normandydriver@example.com\");", "body_text": "It's best to create the promise before you install/start the extension, so you don't risk adding the startup listener after startup is complete.", "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/825", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/123393796", "created_at": "2017-06-21T23:55:51Z", "author_association": "NONE", "body": "It's best to create the promise before you install/start the extension, so you don't risk adding the startup listener after startup is complete.", "updated_at": "2017-06-22T00:00:06Z", "html_url": "https://github.com/mozilla/normandy/pull/825#discussion_r123393796", "pull_request_review_id": 45592657, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/123393796"}, "html": {"href": "https://github.com/mozilla/normandy/pull/825#discussion_r123393796"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/825"}}, "commit_id": "38d79a7d3872144d18d9ecf2fe25fb9484e742ce", "user": {"following_url": "https://api.github.com/users/kmaglione/following{/other_user}", "events_url": "https://api.github.com/users/kmaglione/events{/privacy}", "organizations_url": "https://api.github.com/users/kmaglione/orgs", "url": "https://api.github.com/users/kmaglione", "gists_url": "https://api.github.com/users/kmaglione/gists{/gist_id}", "html_url": "https://github.com/kmaglione", "subscriptions_url": "https://api.github.com/users/kmaglione/subscriptions", "avatar_url": "https://avatars2.githubusercontent.com/u/125842?v=4", "repos_url": "https://api.github.com/users/kmaglione/repos", "received_events_url": "https://api.github.com/users/kmaglione/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/kmaglione/starred{/owner}{/repo}", "site_admin": false, "login": "kmaglione", "type": "User", "id": 125842, "followers_url": "https://api.github.com/users/kmaglione/followers"}, "position": null, "path": "recipe-client-addon/test/browser/browser_NormandyDriver.js", "body_html": "<p>It's best to create the promise before you install/start the extension, so you don't risk adding the startup listener after startup is complete.</p>", "original_commit_id": "598a166a94f12bc180c4186a9067b4056901c58b", "id": 123393796}