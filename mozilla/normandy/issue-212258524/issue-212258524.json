{"body_text": "This would kill our servers if this hit general release. We should fix that before the system add-on gets any significant deployment.\nI suspect this is related to #570, in that the signed endpoint works because it doesn't have caching, and the unsigned endpoint get cached, and so doesn't work.\nThese are the headers I get from prod now:\n>>> http -ph GET https://self-repair.mozilla.org/api/v1/recipe/                                                      ~\nHTTP/1.1 200 OK\nAllow: GET, POST, HEAD, OPTIONS\nCache-Control: public, max-age=30\nConnection: keep-alive\nContent-Encoding: gzip\nContent-Length: 14337\nContent-Type: application/json\nDate: Mon, 06 Mar 2017 21:38:09 GMT\nPublic-Key-Pins: max-age=300; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\"; pin-sha256=\"sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis=\";\nVary: Accept\nX-Cached: MISS\nX-Frame-Options: DENY\nstrict-transport-security: max-age=31536000; includeSubDomains\nx-content-type-options: nosniff\nx-xss-protection: 1; mode=block\n\n>>> http -ph GET https://self-repair.mozilla.org/api/v1/recipe/signed/                                               ~\nHTTP/1.1 200 OK\nAllow: GET, HEAD, OPTIONS\nConnection: keep-alive\nContent-Encoding: gzip\nContent-Length: 2438\nContent-Type: application/json\nDate: Mon, 06 Mar 2017 21:38:12 GMT\nPublic-Key-Pins: max-age=300; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\"; pin-sha256=\"sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis=\";\nVary: Accept\nX-Cached: MISS\nX-Frame-Options: DENY\nstrict-transport-security: max-age=31536000; includeSubDomains\nx-content-type-options: nosniff\nx-xss-protection: 1; mode=block", "labels": [], "number": 580, "assignee": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "repository_url": "https://api.github.com/repos/mozilla/normandy", "closed_at": "2017-03-07T18:51:10Z", "body_html": "<p>This would kill our servers if this hit general release. We should fix that before the system add-on gets any significant deployment.</p>\n<p>I suspect this is related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load issue title\" data-id=\"211258550\" data-permission-text=\"Issue title is private\" data-url=\"https://github.com/mozilla/normandy/issues/570\" href=\"https://github.com/mozilla/normandy/pull/570\">#570</a>, in that the signed endpoint works because it doesn't have caching, and the unsigned endpoint get cached, and so doesn't work.</p>\n<p>These are the headers I get from prod now:</p>\n<pre><code>&gt;&gt;&gt; http -ph GET https://self-repair.mozilla.org/api/v1/recipe/                                                      ~\nHTTP/1.1 200 OK\nAllow: GET, POST, HEAD, OPTIONS\nCache-Control: public, max-age=30\nConnection: keep-alive\nContent-Encoding: gzip\nContent-Length: 14337\nContent-Type: application/json\nDate: Mon, 06 Mar 2017 21:38:09 GMT\nPublic-Key-Pins: max-age=300; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\"; pin-sha256=\"sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis=\";\nVary: Accept\nX-Cached: MISS\nX-Frame-Options: DENY\nstrict-transport-security: max-age=31536000; includeSubDomains\nx-content-type-options: nosniff\nx-xss-protection: 1; mode=block\n\n&gt;&gt;&gt; http -ph GET https://self-repair.mozilla.org/api/v1/recipe/signed/                                               ~\nHTTP/1.1 200 OK\nAllow: GET, HEAD, OPTIONS\nConnection: keep-alive\nContent-Encoding: gzip\nContent-Length: 2438\nContent-Type: application/json\nDate: Mon, 06 Mar 2017 21:38:12 GMT\nPublic-Key-Pins: max-age=300; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\"; pin-sha256=\"sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis=\";\nVary: Accept\nX-Cached: MISS\nX-Frame-Options: DENY\nstrict-transport-security: max-age=31536000; includeSubDomains\nx-content-type-options: nosniff\nx-xss-protection: 1; mode=block\n</code></pre>", "id": 212258524, "title": "Signed recipe API endpoint doesn't have cache headers", "comments": 0, "state": "closed", "body": "This would kill our servers if this hit general release. We should fix that before the system add-on gets any significant deployment.\r\n\r\nI suspect this is related to #570, in that the signed endpoint works because it doesn't have caching, and the unsigned endpoint get cached, and so doesn't work.\r\n\r\nThese are the headers I get from prod now:\r\n\r\n```\r\n>>> http -ph GET https://self-repair.mozilla.org/api/v1/recipe/                                                      ~\r\nHTTP/1.1 200 OK\r\nAllow: GET, POST, HEAD, OPTIONS\r\nCache-Control: public, max-age=30\r\nConnection: keep-alive\r\nContent-Encoding: gzip\r\nContent-Length: 14337\r\nContent-Type: application/json\r\nDate: Mon, 06 Mar 2017 21:38:09 GMT\r\nPublic-Key-Pins: max-age=300; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\"; pin-sha256=\"sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis=\";\r\nVary: Accept\r\nX-Cached: MISS\r\nX-Frame-Options: DENY\r\nstrict-transport-security: max-age=31536000; includeSubDomains\r\nx-content-type-options: nosniff\r\nx-xss-protection: 1; mode=block\r\n\r\n>>> http -ph GET https://self-repair.mozilla.org/api/v1/recipe/signed/                                               ~\r\nHTTP/1.1 200 OK\r\nAllow: GET, HEAD, OPTIONS\r\nConnection: keep-alive\r\nContent-Encoding: gzip\r\nContent-Length: 2438\r\nContent-Type: application/json\r\nDate: Mon, 06 Mar 2017 21:38:12 GMT\r\nPublic-Key-Pins: max-age=300; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; pin-sha256=\"r/mIkG3eEpVdm+u/ko/cwxzOMo1bk4TyHIlByibiA5E=\"; pin-sha256=\"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\"; pin-sha256=\"sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis=\";\r\nVary: Accept\r\nX-Cached: MISS\r\nX-Frame-Options: DENY\r\nstrict-transport-security: max-age=31536000; includeSubDomains\r\nx-content-type-options: nosniff\r\nx-xss-protection: 1; mode=block\r\n```", "events_url": "https://api.github.com/repos/mozilla/normandy/issues/580/events", "labels_url": "https://api.github.com/repos/mozilla/normandy/issues/580/labels{/name}", "author_association": "MEMBER", "comments_url": "https://api.github.com/repos/mozilla/normandy/issues/580/comments", "html_url": "https://github.com/mozilla/normandy/issues/580", "updated_at": "2017-03-07T18:51:10Z", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "milestone": null, "locked": false, "url": "https://api.github.com/repos/mozilla/normandy/issues/580", "created_at": "2017-03-06T21:40:56Z", "assignees": [{"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}]}