{"original_position": 34, "diff_hunk": "@@ -38,23 +38,30 @@ function history(state = new Map(), action) {\n   }\n }\n \n+const formatRecipe = recipe =>\n+  recipe\n+    .set('action_id', recipe.getIn(['action', 'id'], null))\n+    .set('latest_revision_id', recipe.getIn(['latest_revision', 'id'], null))\n+    .set('approved_revision_id', recipe.getIn(['approved_revision', 'id'], null))\n+    .remove('action')\n+    .remove('latest_revision')\n+    .remove('approved_revision');\n \n function items(state = new Map(), action) {\n-  let recipe;\n-\n   switch (action.type) {\n     case RECIPE_RECEIVE: {\n-      recipe = fromJS(action.recipe);\n+      const recipe = fromJS(action.recipe);\n+      return state.set(action.recipe.id, formatRecipe(recipe));\n+    }\n \n-      recipe = recipe\n-        .set('action_id', recipe.getIn(['action', 'id'], null))\n-        .set('latest_revision_id', recipe.getIn(['latest_revision', 'id'], null))\n-        .set('approved_revision_id', recipe.getIn(['approved_revision', 'id'], null))\n-        .remove('action')\n-        .remove('latest_revision')\n-        .remove('approved_revision');\n+    case RECIPE_PAGE_RECEIVE: {\n+      const recipes = fromJS(action.recipes.results);\n \n-      return state.set(action.recipe.id, recipe);\n+      return state.withMutations(mutState => {", "body_text": "This is what I had in mind. What do you find harder to read about it?\nApplying this only to the formatRecipe and formatRevision functions would have some of the performance  benefits, but wrapping the entire reducer transaction in withMutation (like done here) is better.", "in_reply_to_id": 139513793, "pull_request_url": "https://api.github.com/repos/mozilla/normandy/pulls/1042", "url": "https://api.github.com/repos/mozilla/normandy/pulls/comments/139519904", "created_at": "2017-09-18T19:40:37Z", "author_association": "MEMBER", "body": "This is what I had in mind. What do you find harder to read about it?\r\n\r\nApplying this only to the `formatRecipe` and `formatRevision` functions would have some of the performance  benefits, but wrapping the entire reducer transaction in `withMutation` (like done here) is better.", "updated_at": "2017-09-20T23:45:07Z", "html_url": "https://github.com/mozilla/normandy/pull/1042#discussion_r139519904", "pull_request_review_id": 63464010, "_links": {"self": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/comments/139519904"}, "html": {"href": "https://github.com/mozilla/normandy/pull/1042#discussion_r139519904"}, "pull_request": {"href": "https://api.github.com/repos/mozilla/normandy/pulls/1042"}}, "commit_id": "f3e7b3506bfed1dcafe170547c418c50c328feb4", "user": {"following_url": "https://api.github.com/users/mythmon/following{/other_user}", "events_url": "https://api.github.com/users/mythmon/events{/privacy}", "organizations_url": "https://api.github.com/users/mythmon/orgs", "url": "https://api.github.com/users/mythmon", "gists_url": "https://api.github.com/users/mythmon/gists{/gist_id}", "html_url": "https://github.com/mythmon", "subscriptions_url": "https://api.github.com/users/mythmon/subscriptions", "avatar_url": "https://avatars3.githubusercontent.com/u/305049?v=4", "repos_url": "https://api.github.com/users/mythmon/repos", "received_events_url": "https://api.github.com/users/mythmon/received_events", "gravatar_id": "", "starred_url": "https://api.github.com/users/mythmon/starred{/owner}{/repo}", "site_admin": false, "login": "mythmon", "type": "User", "id": 305049, "followers_url": "https://api.github.com/users/mythmon/followers"}, "position": null, "path": "recipe-server/client/control_new/state/app/recipes/reducers.js", "body_html": "<p>This is what I had in mind. What do you find harder to read about it?</p>\n<p>Applying this only to the <code>formatRecipe</code> and <code>formatRevision</code> functions would have some of the performance  benefits, but wrapping the entire reducer transaction in <code>withMutation</code> (like done here) is better.</p>", "original_commit_id": "bed7b0272ea014dce98347c765b5e0eb75b3704d", "id": 139519904}